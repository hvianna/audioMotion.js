/*! For license information please see audioMotion.js.LICENSE.txt */
(()=>{var e,t={6965:(e,t,a)=>{"use strict";var n=a(4015);const o="/music",s=!!window.showDirectoryPicker,i="Click to open a new root folder",r="No music found on server and no browser support for File System API",l=40,c="loading",d="local",u="server";let f,p,h,m,b,g=[],v=/.*/,k=[],y=!1,w=!1,x=!1;function L(e,t){m.innerHTML="",b.innerHTML="",b.style.backgroundImage="";const a=(e,t)=>{const a=document.createElement("li"),n=e.name||e;a.dataset.type=null!==n.match(/\.(m3u|m3u8)$/)&&"file"==t?"list":t,a.dataset.path=n,a.dataset.subs=+!!e.subs,a.innerText=n,a.handle=e.handle,a.dirHandle=e.dirHandle,a.subs=e.subs,b.append(a)},n=e=>b.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e?`, url('${e}')`:"");if(0==k.length&&(m.innerHTML=r),g.forEach((({dir:e},t)=>{m.innerHTML+=`<li data-depth="${g.length-t-1}">${e}</li> ${"/"==e?"":"/"} `;let a=0;for(;m.getBoundingClientRect().height>l&&a<m.children.length-1;)m.children[a].innerText="..",a++})),k.forEach((e=>{b.innerHTML+=`<li data-type="mount" ${w&&!f?'class="full-panel"':""} data-path="${e}">[ ${e} ]</li>`})),g.length>1&&(b.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e){const{cover:t,dirs:o,files:s}=e;o&&o.forEach((e=>a(e,"dir"))),s&&s.forEach((e=>a(e,"file"))),t&&t.handle?t.handle.getFile().then((e=>n(URL.createObjectURL(e)))):n(t?C(t.name):"")}b.scrollTop=t||0}async function S(e,t){let a,n=e&&"string"!=typeof e?e:null,o=f,s=[...g];const i=m.parentElement;if(n&&(e=n.name),e)if(".."==e){a=g.pop();const e=g[g.length-1];e&&e.handle&&(n=e.handle)}else g.push({dir:e,scrollTop:b.scrollTop,handle:n});i.classList.add(c),i.classList.toggle(d,w),i.classList.toggle(u,x&&!w),f&&n&&(f=n);const r=await T(C(),f);return i.classList.remove(c),!1!==r?(L(r,t||a&&a.scrollTop),h&&h(g),!0):(g=s,f=o,!1)}function E(e){return e.replace(/[#%&]/g,(e=>({"#":"%23","%":"%25","&":"%26"}[e])))}function C(e){let t="";return g.forEach((({dir:e})=>{t+=e+("/"==e?"":"/")})),e&&(t+=e),t=E(t),x&&"/"==t[0]&&(t=t.slice(1)),t}function $(e="li"){let t=[];return b.querySelectorAll(e).forEach((e=>{const{path:a,type:n}=e.dataset,{handle:o,dirHandle:s,subs:i}=e;["file","list"].includes(n)&&t.push({file:C(a),handle:o,dirHandle:s,subs:i,type:n})})),t}async function T(e,t){let a;try{if(s&&t instanceof FileSystemDirectoryHandle){a=[];for await(const[e,n]of t.entries())a.push({name:e,handle:n,dirHandle:t})}else{const t=await fetch(e);a=!!t.ok&&await t.text()}}catch(e){a=!1}return!1!==a&&function(e,t){const a=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,n=/\.vtt$/i;let o=[],i=[],r=[],l=[];const c=(e,t)=>{const n=new RegExp(`${t}.*${a.source}`,"i");return e.find((e=>(e.name||e).match(n)))};if(Array.isArray(e)&&s)for(const t of e){const{name:e,handle:s,dirHandle:c}=t;s instanceof FileSystemDirectoryHandle?o.push(t):s instanceof FileSystemFileHandle&&(e.match(a)?r.push(t):e.match(n)&&l.push(t),e.match(v)&&i.push(t))}else for(const{url:t,file:s}of _(e)){const e={name:s};"/"==t.slice(-1)?o.push(e):(s.match(a)?r.push(e):s.match(n)&&l.push(e),s.match(v)&&i.push(e))}for(const e of l){const{name:a,handle:n}=e,[,o,,s]=a.match(/(.*?)(\.([a-z]{0,3}))?\.vtt$/i)||[],r=i.find((e=>e.name.startsWith(o)));r&&(r.subs={src:t?t+a:C(a),lang:s,handle:n})}const d=c(r,"cover")||c(r,"folder")||c(r,"front")||r[0],u=new Intl.Collator,f=(e,t)=>u.compare(e.name,t.name);return{cover:d,dirs:o.sort(f),files:i.sort(f)}}(a,e)}async function A(e){const t=[...g],a=e.split("/");let n=t[t.length-1].handle;for(;a.length>1;){const e=a.shift();if(".."==e)t.pop(),n=t[t.length-1].handle;else{try{n=await n.getDirectoryHandle(e)}catch(e){return{}}t.push({handle:n})}}const o=a.shift(),s=n;try{n=await n.getFileHandle(o)}catch(e){n=void 0}return{handle:n,dirHandle:s}}function _(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const[,t,n]=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i),o="/"==t.slice(-1),s=t.slice(t.lastIndexOf("/",o?t.length-2:void 0)+1),i=decodeURIComponent(s.slice(0,o?-1:void 0));o&&n.match(/^(parent directory|\.\.)/i)||a.push({url:s,file:i})}return a}async function O(e){const t=e&&e[e.length-1],a=f,n=[...g];g=e,t&&t.handle&&(f=t.handle);const o=!!e&&await S();return o||(f=a,g=n,w||g.length?w&&!f&&L():S(k[0])),o}var I=a(6015),P=(a(6216),a(7783)),M=a(246),R=a(4596),D=a.n(R);M.Ay.mount(new M.cR);const H=location.origin+location.pathname,F="25.7-beta.7",B="backgrounds/",N=4,q=2e3,j=-1,U="0",z="1",G="2",W="3",K="4",V="0",Y="1",J="2",X="0",Z="1",Q="2",ee="3",te="6",ae="7",ne="8",oe={album:"",artist:"",codec:"",cover:"",duration:"",file:"",quality:"",title:""},se="compact",ie="fit-video",re="warning",le="dual-combined",ce="single",de="gradient",ue="bar-index",fe="bar-level",pe=20,he=["mp3","flac","m4a","aac","ogg","wav"],me=["jpg","jpeg","webp","avif","png","gif","bmp"],be=["m3u","m3u8"],ge=["mkv","mpg","webm","mp4","avi","mov"],ve="local",ke="bgDir",ye="custom-grads",we="custom-preset",xe="disabled-bgfit",Le="disabled-gradients",Se="disabled-properties",Ee="display-options",Ce="force-filesystem",$e="general-settings",Te="last-config",Ae="last-dir",_e="last-version",Oe="peak-settings",Ie="playlists",Pe="playqueue",Me="sensitivity-presets",Re="subtitles-settings",De="pl_",He="11",Fe="0",Be="10",Ne="101",qe="close",je="open",Ue=0,ze=2,Ge="default",We="last",Ke="No description",Ve="0",Ye="1",Je="2",Xe="3",Ze="alpha",Qe="nobg",et="bands",tt="imgfit",at="colormode",nt="gradient",ot="leds",st="lumi",it="mode",rt="outline",lt="peaks",ct="presets",dt="radial",ut="reflex",ft="round",pt="split",ht="bark",mt="log",bt=0,gt=2,vt="config.json",kt={defaultAccessMode:ve,enableLocalAccess:!0,frontPanel:je},yt="shadow",wt="white",xt="subs-bg-",Lt="subs-color-",St="bottom",Et="center",Ct="show",$t="D",Tt=812,At=document.querySelector.bind(document),_t=document.querySelectorAll.bind(document),Ot=At("#alpha_bars"),It=At("#analyzer"),Pt=At("#ansi_bands"),Mt=At("#auto_hide"),Rt=At("#background"),Dt=At("#band_count"),Ht=At("#bar_space"),Ft=At("#bg_img_dim"),Bt=At("#bg_img_fit"),Nt=At("#bg_location"),qt=At("#bg_max_items"),jt=At("#channel_layout"),Ut=At("#color_mode"),zt=At("#bg_container"),Gt=At("#debug"),Wt=At("#bg_dim"),Kt=At("#end_timeout"),Vt=At("#fft_size"),Yt=At("#fill_alpha"),Jt=At("#fps"),Xt=At("#freq_scale"),Zt=At("#fs_height"),Qt=At("#gradient"),ea=At("#gradientRight"),ta=At("#gravity"),aa=At("#info_timeout"),na=At("#invert_volume"),oa=At("#led_display"),sa=At("#linear_amplitude"),ia=At("#line_width"),ra=At("#link_grads"),la=At("#lo_res"),ca=At("#lumi_bars"),da=At("#max_fps"),ua=At("#files_panel"),fa=At("#mirror"),pa=At("#mode"),ha=At("#mute"),ma=At("#no_dim_subs"),ba=At("#no_dim_video"),ga=At("#no_shadow"),va=At("#outline"),ka=At("#osd"),ya=At("#osd_font_size"),wa=At("#panel_selection"),xa=At("#peak_fade"),La=At("#peak_hold"),Sa=At("#pip_ratio"),Ea=At("#playlists"),Ca=At("#presets"),$a=At("#radial"),Ta=At("#radius"),Aa=At("#random_mode"),_a=At("#freq_max"),Oa=At("#freq_min"),Ia=At("#reduce_subs"),Pa=At("#reduce_video"),Ma=At("#reflex"),Ra=At("#repeat"),Da=At("#round_bars"),Ha=At("#save_dir"),Fa=At("#save_queue"),Ba=At("#scaleX"),Na=At("#scaleY"),qa=At("#sensitivity"),ja=At("#show_count"),Ua=At("#show_cover"),za=At("#show_peaks"),Ga=At("#show_song"),Wa=At("#show_subs"),Ka=At("#smoothing"),Va=At("#song_duration"),Ya=At("#current_time"),Ja=At("#progress"),Xa=At("#source"),Za=At("#spin"),Qa=At("#split_grad"),en=At("#subs_background"),tn=At("#subs_color"),an=At("#subs_position"),nn=At("#subs_position_audio"),on=At("#enable_surround"),sn=At("#toggle_panel"),rn=At("#track_timeout"),ln=At("#video"),cn=At("#video_fill"),dn=At("#volume"),un=At("#warp"),fn=At("#weighting"),pn=[{key:"demo",name:"Demo (random)",options:{randomMode:6}},{key:"bands",name:"Octave Bands",options:{alphaBars:0,ansiBands:0,background:G,barSpace:.25,bgImageDim:.3,bgImageFit:X,channelLayout:ce,colorMode:de,freqMax:2e4,freqMin:25,freqScale:mt,gradient:"rainbow",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"2",outlineBars:0,radial:0,randomMode:0,reflex:Ye,roundBars:0,showPeaks:1,showScaleX:gt,showScaleY:bt,showSong:1,splitGrad:0,weighting:$t}},{key:"ledbars",name:"Classic LED bars",options:{alphaBars:0,ansiBands:1,background:G,barSpace:.25,bgImageDim:.3,bgImageFit:Z,channelLayout:ce,colorMode:de,freqMax:2e4,freqMin:25,freqScale:mt,gradient:"classic",ledDisplay:1,linearAmpl:1,lumiBars:0,outlineBars:0,mirror:0,mode:"6",radial:0,randomMode:0,reflex:Ve,roundBars:0,showPeaks:1,showScaleX:1,showScaleY:bt,showSong:1,splitGrad:0,weighting:$t}},{key:"dual",name:"Dual-channel combined Graph, Bark frequency scale",options:{ansiBands:0,background:G,bgImageDim:.3,bgImageFit:Z,channelLayout:le,colorMode:de,fillAlpha:.3,freqMax:2e4,freqMin:20,freqScale:ht,gradient:"cool",gradientRight:"dusk",linearAmpl:1,lineWidth:1.5,linkGrads:0,mirror:0,mode:Ne,radial:0,randomMode:0,reflex:Ve,showPeaks:Ue,showScaleX:bt,showScaleY:bt,showSong:1,splitGrad:0,weighting:$t}},{key:"radial",name:"Radial Color by Level",options:{alphaBars:1,ansiBands:0,background:G,barSpace:.1,bgImageDim:.3,bgImageFit:ee,channelLayout:ce,colorMode:fe,freqMax:2e4,freqMin:20,freqScale:mt,gradient:"prism",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"5",outlineBars:0,radial:1,radius:.35,randomMode:0,showPeaks:1,showScaleX:1,showScaleY:bt,showSong:1,spin:1,splitGrad:0,weighting:$t}},{key:"round",name:"Round Bars reflex",options:{alphaBars:0,background:G,barSpace:.25,bgImageDim:.3,bgImageFit:ae,channelLayout:ce,colorMode:ue,freqMax:2e4,freqMin:20,freqScale:mt,gradient:"apple",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"3",outlineBars:0,radial:0,randomMode:0,reflex:Je,roundBars:1,showPeaks:Ue,showScaleX:bt,showScaleY:bt,showSong:1,splitGrad:0,weighting:$t}},{key:We,name:"Last session",options:{}},{key:Ge,name:"Restore defaults",options:{alphaBars:0,ansiBands:0,background:U,bandCount:"6",barSpace:.1,bgImageDim:.5,bgImageFit:Z,channelLayout:ce,colorMode:de,fftSize:8192,fillAlpha:.1,freqMax:2e4,freqMin:20,freqScale:mt,gradient:"prism",gradientRight:"prism",ledDisplay:0,linearAmpl:0,lineWidth:2,linkGrads:0,loRes:0,lumiBars:0,micSource:0,mirror:0,mode:Fe,mute:0,noShadow:1,outlineBars:0,radial:0,radius:.35,randomMode:0,reflex:Ve,repeat:0,roundBars:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:bt,showSong:1,showSubtitles:1,smoothing:.7,spin:2,splitGrad:0,volume:1,weighting:""}}],hn={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",colorStops:["#f00",{color:"#ff0",level:.85,pos:.6},{color:"#0f0",level:.475}],disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",colorStops:["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],disabled:!1},prism_old:{name:"Prism (legacy)",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"],disabled:!0},rainbow:{name:"Rainbow",dir:"h",colorStops:["#817","#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b","#639"],disabled:!1},rainbow_old:{name:"Rainbow (legacy)",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 47% )","hsl( 240, 100%, 58% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"],disabled:!0},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},mn=[[He,"Bars"],[Fe,"FFT"],[Be,"Graph"]],bn=[[ce,"Single"],[le,"Comb"],["dual-horizontal","Horiz"],["dual-vertical","Vert"]],gn=[{value:ct,text:"User Presets",disabled:!0},{value:Ze,text:"Alpha",disabled:!1},{value:it,text:"Analyzer Mode",disabled:!1},{value:Qe,text:"Background",disabled:!1},{value:tt,text:"BG Image Fit",disabled:!1},{value:et,text:"Band Count",disabled:!1},{value:at,text:"Color Mode",disabled:!1},{value:nt,text:"Gradients",disabled:!1},{value:ot,text:"LEDs",disabled:!1},{value:st,text:"Lumi",disabled:!1},{value:rt,text:"Outline",disabled:!1},{value:lt,text:"Peaks",disabled:!1},{value:dt,text:"Radial",disabled:!1},{value:ut,text:"Reflex",disabled:!1},{value:ft,text:"Round",disabled:!1},{value:pt,text:"Split",disabled:!1}],vn=[{min:-70,max:-20,boost:1},{min:-85,max:-25,boost:1.6},{min:-100,max:-30,boost:2.4}],kn=[Kt,aa,ya,ja,Ua,rn],yn={info:5,track:10,end:10,covers:!0,count:!0,osdFontSize:"1"},wn=[{value:X,text:"Adjust",disabled:!1},{value:Z,text:"Center",disabled:!1},{value:ee,text:"Pulse",disabled:!1},{value:Q,text:"Repeat",disabled:!1},{value:te,text:"Warp",disabled:!1},{value:ae,text:"Warp Drive",disabled:!1},{value:ne,text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],xn=[Mt,Nt,qt,Zt,na,da,Sa,Ha,Fa,on],Ln={autoHide:!1,bgLocation:Y,bgMaxItems:100,fsHeight:100,invertVol:!1,maxFPS:60,pipRatio:2.35,saveDir:!0,saveQueue:!0,surround:!1},Sn=[[30,"30"],[60,"60"],[0,"unlimited"]],En=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]],Cn=[ta,xa,La],$n={gravity:3.8,peakFade:750,peakHold:500},Tn=[ma,ba,Ia,Pa,en,tn,an,nn,cn],An={background:yt,color:wt,noDimVideo:!0,noDimSubs:!0,posAudio:"top",position:St,reduceOnSubs:!1,reduceOnVideo:!0,videoFill:!0},_n=[{value:"files_panel",text:"Media"},{value:"settings",text:"Settings"},{value:"advanced",text:"Advanced"},{value:"console",text:"Console"}];let On,In,Pn,Mn,Rn,Dn,Hn,Fn,Bn,Nn,qn,jn,Un,zn,Gn,Wn,Kn,Vn,Yn,Jn,Xn,Zn,Qn,eo,to,ao,no,oo,so,io=[],ro=[],lo=[],co={},uo=null,fo={},po=!1,ho=0,mo=[],bo=!1,go=!1,vo=0;const ko=ka.getContext("2d"),yo=new Image,wo=document.createElement("video"),xo=e=>"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,2)),Lo=e=>Math.round(100*e)/100,So=(e,t="")=>(e+"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g,t),Eo=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},Co=e=>{let t="";if(Mo(e)){const a=e.querySelector(":checked ~ label");a&&(t=a.textContent)}else t=e[e.selectedIndex].text;return t},$o=e=>{let t=e.value;return e==Dt?t=9-t:Mo(e)?t=e.elements[e.dataset.prop].value:e.className.includes("switch")&&(t=e.dataset.active||0),""+t},To=e=>({alphaBars:$o(Ot),ansiBands:$o(Pt),background:$o(Rt),bandCount:$o(Dt),barSpace:$o(Ht),bgImageDim:$o(Ft),bgImageFit:$o(Bt),channelLayout:$o(jt),colorMode:$o(Ut),fftSize:$o(Vt),fillAlpha:$o(Yt),freqMax:$o(_a),freqMin:$o(Oa),freqScale:$o(Xt),gradient:$o(Qt),gradientRight:$o(ea),ledDisplay:$o(oa),linearAmpl:$o(sa),lineWidth:$o(ia),linkGrads:$o(ra),loRes:$o(la),lumiBars:$o(ca),mirror:$o(fa),mode:$o(pa),noShadow:$o(ga),outlineBars:$o(va),radial:$o($a),radius:$o(Ta),randomMode:$o(Aa),reflex:$o(Ma),repeat:$o(Ra),roundBars:$o(Da),sensitivity:$o(qa),showFPS:$o(Jt),showPeaks:$o(za),showScaleX:$o(Ba),showScaleY:$o(Na),showSong:$o(Ga),showSubtitles:$o(Wa),smoothing:$o(Ka),spin:$o(Za),splitGrad:$o(Qa),weighting:$o(fn)}),Ao=e=>{const t=+e==e?e:pn.findIndex((t=>t.key==e));return t<0||t>pn.length-1?-1:t},_o=e=>{const t=Ao(e);return-1==t?{}:pn[t].options},Oo=e=>{const t=Ao(e);return-1!=t&&pn[t].name},Io=()=>{const e=$o(jt)!=ce&&!Bo(ra);return`Gradient${e?"s":""}: ${hn[Qt.value].name+(e?" / "+hn[ea.value].name:"")}`},Po=e=>e&&e.startsWith("blob:"),Mo=e=>"FORM"==e.tagName&&null!=e.dataset.prop,Ro=e=>e.startsWith("http")&&!e.startsWith(H),Do=e=>!e||"object"!=typeof e||!Object.keys(e).length,Ho=e=>zt.classList.contains("pip"),Fo=(e=io[In])=>e&&e.currentTime>0&&!e.paused&&!e.ended,Bo=e=>!!+$o(e),No=e=>"number"!=e.type||+e.value>=+e.min&&+e.value<=+e.max,qo=(e=io[In])=>ge.includes(zo(e.dataset.file).extension),jo=e=>"string"==typeof e?e.replace(/\\/g,"/"):e,Uo=e=>Bo(e)?"ON":"OFF",zo=e=>{if("string"!=typeof e)return{};const t=jo(e),a=t.lastIndexOf("/")+1,n=t.slice(0,a),o=t.slice(a),s=o.lastIndexOf("."),i=s>=0?o.slice(0,s):o,r=s>=0?o.slice(s+1).toLowerCase():"";return{path:n,fileName:o,baseName:i,extension:r}},Go=e=>{const t=/\s*\([0-9]{4}\)/;let a=(e=e.replace(/_/g," ")).match(t);a&&(a=a[0].trim(),e=e.replace(t,"").trim());const[,,n,o,,s,i]=e.match(/(^(-?\d+)([,\.\-\s]))?((.*?)\s+-\s+)?(.*)/);return{album:a,artist:s,title:i,duration:","==o?Yo(n):""}},Wo=e=>Fn.children.length,Ko=(e=2)=>Math.random()*e|0,Vo=e=>{Un?(0,P.hZ)(Ae,e):Wn&&Gs(Ae,e)},Yo=(e,t)=>{if(Math.abs(e)==1/0||"-1"===e)return"LIVE";let a="",n="",o="";return e<0&&(e=-e,n="-"),(e>=3600||t)&&(o=(e/3600|0)+":",e%=3600,a="0"),o+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),n+o},Jo=(e,t)=>{if(e==ha)gi(t);else if(e==Xa)ai(t);else if(e==dn)ii(t);else if(e==Dt)e.value=9-t;else if(Mo(e)){const a=e.querySelector(`[value="${t}"]`);a&&(a.checked=!0)}else e.classList.contains("switch")?e.dataset.active=+t:(e.value=t,-1==e.selectedIndex&&(e.selectedIndex=0));ki(e)},Xo=(e,t,a,n=1)=>{e.min=t,e.max=a,e.step=n},Zo=(e,t)=>{void 0===t&&(t=!!e.style.display),e.style.display=t?"":"none"},Qo=async e=>new Promise(((t,a)=>{e.onerror=()=>{e.onerror=e.onloadeddata=null,a()},e.onloadeddata=()=>{e.onerror=e.onloadeddata=null,ds("onLoadedData",{mediaEl:e.id.slice(-1)}),t()}}));function es(e,t=!1){const a=e.map((e=>ns(e,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${Wo()<q?"":". Queue is full!"}`;D().alert({text:a,time:5}),ui(!0)}))}function ts(e,t){const a=t.dataset,n=e.dataset,{album:o,artist:s,picture:i,title:r,year:l}=e.common||{},{bitrate:c,bitsPerSample:d,codec:u,codecProfile:f,container:p,duration:h,lossless:m,numberOfChannels:b,sampleRate:g}=e.format||{};if(n)Object.assign(a,n);else{a.artist=s||a.artist,a.title=r||a.title,a.album=o?o+(l?" ("+l+")":""):a.album,a.codec=u||p?(u||p)+" ("+b+"ch)":a.codec;const e=g?Math.round(g/1e3)+"kHz":"";if(a.quality=m||!c?(d?d+"bits":"")+(e&&d?" / ":"")+e:Math.round(c/1e3)+"kbps"+(f?" "+f:"")+(e?" / ":"")+e,a.duration=h?Yo(h):"",i&&i.length){const e=new Blob([i[0].data],{type:i[0].format});a.cover=URL.createObjectURL(e)}}t==io[In]&&Js()}function as(e,t){return new Promise((a=>{if(Wo()>=q)return void a(0);const{fileName:n,baseName:o,extension:s}=zo(function(e){return e.replace(/%2[356]/g,(e=>({"%23":"#","%25":"%","%26":"&"}[e])))}(e.file)),i=jo(e.file),r=document.createElement("li"),l=r.dataset;Object.assign(l,oe),t||(t=Go(o)),l.album=t.album||"",l.artist=t.artist||"",l.title=t.title||n||i.slice(i.lastIndexOf("//")+2),l.duration=t.duration||"",l.codec=t.codec||s.toUpperCase(),l.file=i,r.handle=e.handle,r.dirHandle=e.dirHandle,r.subs=e.subs,Fn.appendChild(r),!he.includes(s)&&s||(l.retrieve=1,qs()),1!=Wo()||Fo()?(Bn>Wo()-3&&Ss(j),a(1)):Ss(0).then((()=>a(1)))}))}function ns(e,t=!1){let a;return a=be.includes(zo(e.file).extension)?ws(e):as(e),a.then((e=>{t&&!Fo()&&e>0&&_s(Wo()-e)})),a}function os(e){const t=+Zt.value;(1==e&&t<+Zt.max||-1==e&&t>+Zt.min)&&(Zt.value=t+Zt.step*e,ti(Zt)),Ys(`Analyzer height: ${Zt.value}%`)}function ss(e){let t=Lo((+dn.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),ii(t),Ys("Volume: "+20*t),vi()}function is(e=In){const t=e instanceof HTMLMediaElement?e:io[e],a=t.dataset;vs(t,null),Es(t),Object.assign(a,oe),t.load(),e==In&&Js()}function rs(e=On){const t=e.pixelRatio,a=ka.height=zt.clientHeight*t,n=ka.width=zt.clientWidth*t;Kn=Math.max(12,Math.min(n,a)/[24,17,13.5][+ya.value]),Vn=3*Kn,Yn=n/2,Jn=n-Kn,Xn=1.4*Kn,Zn=1.8*Xn,ao=n/3-Kn,Qn=a-4*Kn,eo=a-2.8*Kn,to=a-1.6*Kn,no=n-8*Kn,oo=`bold ${.7*Kn}px sans-serif`,so=`bold ${Kn}px sans-serif`}function ls(e,t,a){const n=At("#console-content"),o=new Date,s=o.toLocaleTimeString([],{hour12:!1})+"."+String(o.getMilliseconds()).padStart(3,"0");a&&(n.innerHTML="",Pn.classList.remove(re)),t&&Pn&&Pn.classList.add(re),e&&(n.innerHTML+=`<div ${t?'class="error"':""}>${s} &gt; ${e}</div>`),n.scrollTop=n.scrollHeight}function cs(e,t){const a=Mo(e)?e.elements[e.dataset.prop]:e.options;let n=(Mo(e)?Array.from(a).findIndex((e=>e.checked)):e.selectedIndex)+(t?-1:1);n<0?n=a.length-1:n>=a.length&&(n=0),Mo(e)?a[n].checked=!0:e.selectedIndex=n,ti(e)}function ds(e,t){if(Gt.checked){if("object"==typeof e&&(t=e,e=""),t){e+=(e?", ":"")+"{ ";let a=0;for(const[n,o]of Object.entries(t))e+=(a?", ":"")+n+": "+o,a++;e+=" }"}ls(e)}}function us(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function fs(e,t){const a=document.createElement("a");a.setAttribute("href",xo(e)),a.setAttribute("download",`${t}.json`),a.click()}function ps(e,t){if(Do(zn[e]))return;const a=`User Preset #${e+1}`,n=zn[e].name?"<br>"+zn[e].name:"";t?(zn[e]={},Gs(we,zn),D().alert({text:`Deleted ${a}`}),Rs()):D().confirm({text:`Do you really want to DELETE ${a}?${n}<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{ps(e,!0)},cancelCallback:()=>{D().alert({text:"Canceled!"})}})}function hs(e=1){const t=io[In];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),Ys(1),t.currentTime=a}"m"==po&&Ks("m",e)}function ms(){return clearTimeout(Mn),!!po&&(po=!1,!0)}async function bs(){Ho()&&await document.exitPictureInPicture(),On.toggleFullscreen(),document.activeElement.blur()}function gs(e){if(e.altKey||e.ctrlKey||e.metaKey)return;const t=e.shiftKey;if("F1"==e.code&&!t)return location.href="#help",void e.preventDefault();if("BODY"==e.target.tagName){if("keydown"==e.type)switch(e.code){case"ArrowUp":t?os(1):ss(1);break;case"ArrowDown":t?os(-1):ss(-1);break;case"ArrowLeft":po?(Ys("Rewind",1),hs(-1)):Ks("k",-1);break;case"ArrowRight":po?(Ys("Fast forward",1),hs()):Ks("k");break;default:return}else if(e.code.match(/^(Digit|Numpad)[0-9]$/)){const a=e.code.slice(-1)-1;if(-1==a)t||(Hs(!0),ti(Aa,!1));else if(t){const e=To();e.randomMode=0,Ws(a,e)}else xs(a)}else switch(e.code){case"Delete":case"Backspace":Fn.querySelectorAll(".selected").forEach((e=>{js(e),e.remove()}));const e=Eo(Fn.querySelector(".current"));void 0!==e?Bn=e:Bn>Wo()-1?Bn=Wo()-1:Bn--,Wo()?Ss(j):(is(Dn),Fo()||is()),ui(!0);break;case"Space":Ys(Fo()?"Pause":"Play",1),Ts();break;case"ArrowLeft":case"KeyJ":ms()||t||(Ys("Previous track",1),ci(!0));break;case"KeyG":cs(Qt,t),Ys(Io());break;case"ArrowRight":case"KeyK":ms()||t||(Ys("Next track",1),ci());break;case"KeyA":cs(Aa,t),Ys("Randomize: "+Co(Aa)),ti(Aa);break;case"KeyB":cs(t?Bt:Rt);const a=Rt.value[0];Ys("Background: "+Co(Rt)+(a>1&&a<7?` (${Co(Bt)})`:""));break;case"KeyC":$a.click(),Ys("Radial "+Uo($a));break;case"KeyD":hi();break;case"KeyE":Wo()>0&&(li(),Ys("Shuffle"));break;case"KeyF":bs();break;case"KeyH":Jt.click();break;case"KeyI":Ga.click(),Ys("Song info display "+Uo(Ga));break;case"KeyL":oa.click(),Ys("LED effect "+Uo(oa));break;case"KeyM":case"KeyV":cs(pa,t),Ys("Mode: "+Co(pa));break;case"KeyN":cs(qa,t),Ys(Co(qa).toUpperCase()+" sensitivity");break;case"KeyO":la.click(),Ys((Bo(la)?"LOW":"HIGH")+" Resolution");break;case"KeyP":cs(za,t),Ys("Peaks "+Co(za));break;case"KeyR":Ra.click(),Ys("Queue repeat "+Uo(Ra));break;case"KeyS":const n=["None","Frequencies","Musical Notes",,"Level"],o=function(e){e=-2*e+1;let t=+$o(Ba)+(+$o(Na)<<2)+e;return t<0?t=6:3==t?t+=e:t>6&&(t=0),Jo(Ba,3&t),Jo(Na,t>>2),ti([Ba,Na]),t}(t);Ys("Scale labels: "+(o<5?n[o]:n[o-4]+" + "+n[4]));break;case"KeyT":ga.click(),Ys((Bo(ga)?"Flat":"Shadowed")+" text mode");break;case"KeyU":ca.click(),Ys("Luminance bars "+Uo(ca));break;case"KeyX":cs(Ma,t),Ys("Reflex: "+Co(Ma));break;default:return}e.preventDefault()}}function vs(e,t){const a=e.src||"";Po(a)&&URL.revokeObjectURL(a),t?e.src=t:e.removeAttribute("src"),Qs()}async function ks(e,t,a){const n=URL.createObjectURL(e);vs(t,n);try{await Qo(t),a&&t.play()}catch(e){}return n}function ys(e){return JSON.parse(localStorage.getItem(e))}function ws(e){let t=jo(e.file);return new Promise((async a=>{let n=[];const o=e=>{Promise.all(n).then((t=>{const n=t.reduce(((e,t)=>e+t),0);a(n),e&&ui(!0)}))},s=async e=>{let a,s;t=zo(t).path;for(let o of e.split(/[\r\n]+/))if("#"!=o.charAt(0)&&""!=o.trim()){let e,i;if(o=jo(o),s||(s=zo(o).baseName),!Ro(o)){if(Un&&(({handle:e,dirHandle:i}=await A(o)),!e)){ls(`Cannot resolve file handle for ${o}`,!0),s="";continue}o=E(o),":"!=o[1]&&"/"!=o[0]&&(o=t+o)}n.push(as({file:o,handle:e,dirHandle:i},{...Go(s),...a?{album:a}:{}})),s=""}else o.startsWith("#EXTINF")?s=o.slice(8):o.startsWith("#EXTALB")&&(a=o.slice(8));o()};if(t)if("string"==typeof t&&be.includes(zo(t).extension))e.handle?e.handle.getFile().then((e=>e.text())).then(s).catch((e=>{ls(e,!0),a(0)})):fetch(t).then((e=>e.ok?e.text():(ls(`Fetch returned error code ${e.status} for URI ${t}`,!0),""))).then(s).catch((e=>{ls(e,!0),a(0)}));else{const e=await(0,P.Jt)(!0===t?Pe:De+t);Array.isArray(e)?(e.forEach((e=>{const{file:t,handle:a,dirHandle:o,subs:s,content:i}=e;n.push(as({file:t,handle:a,dirHandle:o,...a&&!o?{subs:s}:{}},i))})),o(e!=Pe)):(!0!==t&&ls(`Unrecognized playlist file: ${t}`,!0),a(0))}else a(-1)}))}function xs(e,t=!0,a,n){const o=+e==e,s="object"==typeof e,i=s?e:o?zn[e].options:_o(e),r=_o(Ge);Do(i)||(t&&!s&&ls("Loading "+(o?"User Preset #"+(+e+1):"'"+Oo(e)+"' preset")),e==Ge&&delete i.volume,void 0!==i.stereo&&(i.channelLayout=bn[+i.stereo][0]),1.5==i.barSpace&&(i.barSpace=1),+i.fadePeaks&&+i.showPeaks&&(i.showPeaks=ze),i.mode==Ne&&(i.mode=Be),[Fe,He,Be].includes(i.mode)||(i.bandCount=i.mode,i.mode=He),+i.noteLabels&&+i.showScaleX&&(i.showScaleX=gt),_t("[data-prop]").forEach((e=>{const t=e.dataset.prop,o=void 0!==i[t]?i[t]:a?r[t]:void 0;void 0===o||e==Aa&&n||Jo(e,o)})),On.setOptions({alphaBars:Bo(Ot),ansiBands:+$o(Pt),colorMode:$o(Ut),fftSize:$o(Vt),fillAlpha:$o(Yt),frequencyScale:$o(Xt),ledBars:Bo(oa),linearAmplitude:+$o(sa),lineWidth:$o(ia),loRes:Bo(la),lumiBars:Bo(ca),maxFPS:$o(da),maxFreq:$o(_a),minFreq:$o(Oa),mirror:$o(fa),outlineBars:Bo(va),peakFadeTime:$o(xa),peakHoldTime:$o(La),radial:Bo($a),radius:$o(Ta),roundBars:Bo(Da),showFPS:Bo(Jt),showScaleY:+$o(Na),smoothing:$o(Ka),spinSpeed:$o(Za),splitGradient:Bo(Qa),weightingFilter:$o(fn)}),ti([Rt,Bt,Ft,jt,za,ta,ra,qa,Ma,Qt,ea,...n?[]:[Aa],Ht,Wa,Ba,pa]),"demo"==e&&Hs(!0),t&&D().alert({text:"Settings loaded!"}))}async function Ls(e){us(Ea);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,Ea.options[Ea.options.length]=t;let a=await(0,P.Jt)(Ie);const n=ys(Ie);if(n){for(const e of Object.keys(n)){const t=De+e,o=ys(t);let s=[];for(const e of o)s.push({file:e});await(0,P.hZ)(t,s),Fs(t),a[e]=n[e]}await(0,P.hZ)(Ie,a),Fs(Ie)}if(a){const t=Object.keys(a),n=new Intl.Collator;t.sort(((e,t)=>n.compare(a[e],a[t])));for(const n of t){const t=new Option(a[n],n);n==e&&(t.selected=!0),Ea.options[Ea.options.length]=t}}}async function Ss(e,t){const a=e!==j,n=a?e:Bn<Wo()-1?Bn+1:0,o=a?In:Dn,s=io[o],i=Fn.children[n];ds("loadSong start",{mediaEl:o,n:e,index:n}),a||ni();let r=!1;if(i){if(a&&(Bn=n),ts(i,s),Es(s,i),i.handle)try{await i.handle.requestPermission();const e=await i.handle.getFile();await ks(e,s,t),r=!0}catch(e){ls(`Error loading ${i.dataset.file}`,!0),is(s)}else{vs(s,i.dataset.file);try{await Qo(s),a&&t&&s.play(),r=!0}catch(e){}}r&&(a?(bi(),Ss(j)):s.load()),i.classList.toggle("error",!r)}return a||(go=!1),ds("loadSong end",{mediaEl:o,success:r}),r}async function Es(e,t){const a=e.querySelector("track");Po(a.src)&&URL.revokeObjectURL(a.src);let{subs:n}=t||{};if(t&&!n&&Bo(Wa)&&!Ro(t.dataset.file)){const{path:e,baseName:a}=zo(t.dataset.file);let o;if(!t.dirHandle&&t.handle||(o=await T(e,t.dirHandle)),o){const e=o.files.find((e=>e.name.startsWith(a)));e&&e.subs&&(n=e.subs,t.subs=n)}}if(n){const{src:e,lang:t,handle:o}=n;a.srclang=t||navigator.language,o?o.getFile().then((e=>a.src=URL.createObjectURL(e))).catch((e=>{})):a.src=e}else a.removeAttribute("src"),a.removeAttribute("srclang")}function Cs(e){e?(uo.name+=" (copy)",uo.key=""):uo={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:""},Bs(),Zo(At("#btn-delete-gradient"),!1),Zo(At("#btn-save-gradient"),!0),Zo(At("#btn-export-gradient"),!1),Zo(At("#btn-save-gradient-copy"),!1),location.href="#gradient-editor"}function $s(e){if(ds("playNextSong",{play:e,playlistPos:Bn,skipping:go}),go||Xa.checked||Bn>Wo()-1)return!0;if(go=!0,Bn<Wo()-1)Bn++;else{if(!Bo(Ra))return go=!1,!1;Bn=0}return e|=Fo(),[In,Dn]=[Dn,In],Qs(),Js(),e&&io[In].src?io[In].play().then((()=>Ss(j))).catch((e=>{ds({err:e}),e.code!=pe&&(ls(e,!0),Ss(j),$s(!0))})):Ss(j),bi(),!0}function Ts(e){Xa.checked||(Fo()&&!e?(io[In].pause(),Ho()&&wo.pause()):io[In].play().catch((e=>{e.code!=pe&&(ls(e,!0),$s(!0))})))}function As(){let e=!0;return Fo()?io[In].currentTime>2?io[In].currentTime=0:Bn>0?_s(Bn-1):e=!1:e=Ss(Bn-1),e}function _s(e){Ss(e,!0)}function Os(){let e=[{value:G,text:"Album cover"},{value:z,text:"Black"},{value:U,text:"Gradient default"}];const t=e.length,a=ro.length,n=lo.length;e=[...e,...ro.map(((e,t)=>({value:W+e.name,text:"ðŸ–¼ï¸ "+e.name,idx:t}))),...lo.map(((e,t)=>({value:K+e.name,text:"ðŸŽ¬ "+e.name,idx:t})))].slice(0,t+ +qt.value),n&&e.splice(t,0,{value:K,text:"Random video"}),a&&e.splice(t,0,{value:W,text:"Random image"}),Ds(Rt,e)}function Is(e,t,a){a||(a=e.dataset.prop);const n=!Array.isArray(t[0]);for(const o of n?t.filter((e=>!e.disabled)):t){const t=o.text||o[1],n=o.value||o[0],s=a+"-"+n,i=document.createElement("input"),r=document.createElement("label");i.name=a,i.id=s,i.type="radio",i.value=n,r.htmlFor=s,r.innerText=t,e.append(i,r)}}function Ps(){const e=At("#enabled_gradients"),t=Object.keys(hn),a=new Intl.Collator;t.sort(((e,t)=>a.compare(hn[e].name,hn[t].name))),us(e),t.forEach((t=>{e.innerHTML+=`<label>\n\t\t\t\t<input type="checkbox" class="enabledGradient" data-grad="${t}" ${hn[t].disabled?"":"checked"}>\n\t\t\t\t${hn[t].name}<a href="#" data-grad="${t}" class="grad-edit-link">Edit</a>\n\t\t\t</label>`})),_t(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(hn).reduce(((e,t)=>e+!hn[t].disabled),0)<2)return D().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;hn[e.dataset.grad].disabled=!e.checked,Ms(),zs(Le)}))})),_t(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{var t;e.preventDefault(),function(e){if(!hn[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=(e,t,a)=>{const n=t*Math.min(a,1-a),o=(t,o=(t+e/30)%12)=>a-n*Math.max(Math.min(o-3,9-o,1),-1);let s="#";for(const e of[0,8,4])s+=Math.round(255*o(e)).toString(16).padStart(2,"0");return s},a=e=>e.match(/\(\s+(.*),\s+(.*?)%?,\s+(.*?)%?\s+\)/).slice(1),n=hn[e],o={...n};o.colorStops=[];for(const e of n.colorStops){if(e.color.startsWith("rgb")){const{color:t}=e;e.color="#";for(const n of a(t))e.color+=(+n).toString(16).padStart(2,"0")}else if(e.color.startsWith("hsl")){const[n,o,s]=a(e.color);e.color=t(n,o/100,s/100)}else if(4==e.color.length){const[t,a,n,o]=e.color;e.color="#"+a+a+n+n+o+o}o.colorStops.push({...e})}uo=o}(t=e.target.getAttribute("data-grad")),Bs(),Zo(At("#btn-delete-gradient"),!!hn[t].key),Zo(At("#btn-save-gradient"),!!hn[t].key),Zo(At("#btn-export-gradient"),!0),Zo(At("#btn-save-gradient-copy"),!0),location.href="#gradient-editor"}))}))}function Ms(){const e=Object.keys(hn),t=new Intl.Collator;e.sort(((e,a)=>t.compare(hn[e].name,hn[a].name)));for(const t of[Qt,ea]){let a=t.value;us(t);for(const a of e)hn[a].disabled||(t.options[t.options.length]=new Option(hn[a].name,a));""!==a&&(t.value=a,ti(t))}}function Rs(){const e=(e,t)=>{const a=document.createElement("optgroup");a.label=e;for(const[e,n]of t)a.appendChild(new Option(n,e));Ca.appendChild(a)};us(Ca),Ca.appendChild(new Option("Select a preset to load",""));const t=zn.map(((e,t)=>[t,e.name?`[${t+1}] ${e.name}`:""])).filter((([e,t])=>!!t));t.length&&e("User Presets",t),e("Built-in Presets",pn.filter((e=>![We,Ge].includes(e.key))).map((e=>[e.key,e.name])))}function Ds(e,t){const a=e.value;Array.isArray(t)||(t=[t]),us(e);for(const a of t.filter((e=>e&&!e.disabled))){const t=new Option(a.text||a[1],a.value||a[0]);null===a[0]&&(t.disabled=!0),void 0!==a.idx&&(t.idx=a.idx),e[e.options.length]=t}""!==a&&(e.value=a,-1==e.selectedIndex&&(e.selectedIndex=0),ti(e))}function Hs(e=Xa.checked){if(!Fo()&&!e)return;const t=e=>!gn.find((t=>t.value==e)).disabled,a=(e,t=()=>!0)=>{let a=9;do{if(Mo(e)){const t=e.elements[e.dataset.prop];t[Ko(t.length)].checked=!0}else if(void 0!==e.dataset.active)e.dataset.active=Ko();else if(e.step){const{min:t,max:a,step:n}=e,o=Ko((a-t)/n+1)*n+ +t;Jo(e,(10*o|0)/10)}else e.selectedIndex=Ko(e.options.length)}while(!t($o(e))&&a--);ti(e)};if(t(ct)){const e=zn.map(((e,t)=>Do(e)?null:t)).filter((e=>null!==e)),t=e.length;t&&xs(e[Ko(t)],!1,!1,!0)}if(t(it)&&a(pa),t(Ze)&&a(Ot),t(Qe)&&a(Rt),t(et)&&a(Dt),t(tt)&&a(Bt),t(at)&&a(Ut),t(lt)&&a(za),t(ot)&&a(oa),t(st)&&a(ca,(e=>!+e||!On.overlay||!Bo(oa))),t(rt)&&a(va),t(ut)&&a(Ma,(e=>e!=Je||!Bo(oa))),t(dt)&&a($a),t(ft)&&a(Da),t(pt)&&a(Qa),t(nt))for(const e of[Qt,...Bo(ra)?[]:[ea]])a(e)}function Fs(e){localStorage.removeItem(e)}function Bs(){if(null==uo)throw new Error("Current gradient must be set before editing gradient");const e=At("#grad-color-table");us(e),At("#new-gradient-name").value=uo.name,At("#new-gradient-horizontal").checked="h"===uo.dir;const t=At("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),uo.colorStops.forEach(((e,t)=>{!function(e,t){const a=At("#grad-color-table"),n=At("#grad-row-template").cloneNode(!0),o=n.querySelector(".grad-color-picker"),s=n.querySelector(".grad-color-value"),i=n.querySelector(".grad-color-stop"),r=n.querySelector(".grad-add-stop"),l=n.querySelector(".grad-remove-stop");o.value=t.color,s.value=t.color,i.value=t.pos,o.addEventListener("input",(t=>{s.value=t.target.value,uo.colorStops[e].color=o.value})),s.addEventListener("input",(t=>{o.value=t.target.value,uo.colorStops[e].color=o.value})),i.addEventListener("input",(t=>{uo.colorStops[e].pos=parseFloat(t.target.value)})),r.addEventListener("click",(()=>{uo.colorStops.splice(e+1,0,{pos:(()=>{if(e===uo.colorStops.length-1){const e=uo.colorStops[uo.colorStops.length-1].pos;return uo.colorStops[uo.colorStops.length-1].pos=(uo.colorStops[uo.colorStops.length-2].pos+e)/2,e}return(uo.colorStops[e].pos+uo.colorStops[e+1].pos)/2})(),color:"#111111"}),Bs()})),2===uo.colorStops.length?l.setAttribute("disabled","true"):l.addEventListener("click",(()=>{uo.colorStops.splice(e,1),Bs()})),n.removeAttribute("id"),a.appendChild(n)}(t,uo.colorStops[t])})),At("#new-gradient-bkgd").value=uo.bgColor}async function Ns(){const e=Nt.value,t=new RegExp("\\.("+me.join("|")+")$","i"),a=new RegExp("\\.("+ge.join("|")+")$","i");if(ro=[],lo=[],e==Y)try{const e=await fetch(B),n=await e.text();for(const{url:e,file:o}of _(n)){const n=zo(o).baseName;t.test(o)?ro.push({name:n,url:B+e}):a.test(o)&&lo.push({name:n,url:B+e})}}catch(e){}else if(e==J){const e=await(0,P.Jt)(ke);try{if(e)for await(const[n,o]of e.entries())if(o instanceof FileSystemFileHandle){const e=t.test(n),s=a.test(n);if(e||s){const t=await o.getFile(),a=URL.createObjectURL(t);e?ro.push({name:n,url:a}):lo.push({name:n,url:a})}}}catch(e){}}if(e!=V){const e=ro.length,t=lo.length;ls("Found "+(e+t==0?"no media":e+" image files and "+t+" video")+" files in the backgrounds folder")}Os()}async function qs(){if(vo>=N)return;const e=Array.from(Fn.children).find((e=>e.dataset.retrieve));if(e){let t=e.dataset.file,a=!1;vo++,delete e.dataset.retrieve;e:{if(e.handle)try{if("granted"!=await e.handle.requestPermission())break e;t=URL.createObjectURL(await e.handle.getFile()),a=!0}catch(e){break e}try{const a=await I.WC(t,{skipPostHeaders:!0});a&&(ts(a,e),fi(e),a.common.picture&&a.common.picture.length||async function(e){const{path:t}=zo(e.dataset.file),{dirHandle:a}=e;if(!Wn||Ro(t))return"";if(void 0!==fo[t])return fo[t];{if(e.handle&&!a)return"";let n="";try{const e=await T(t,a);if(e&&e.cover){const{handle:a,name:o}=e.cover;if(a){const e=await a.getFile();n=URL.createObjectURL(e)}else n=t+o}}catch(e){}return fo[t]=n,n}}(e).then((t=>{e.dataset.cover=t,fi(e)})))}catch(e){}a&&URL.revokeObjectURL(t)}vo--,qs()}}function js(e){const t=e.dataset.cover;Po(t)&&URL.revokeObjectURL(t)}function Us(e){if(null!==uo){if(!uo.key||e){let t=e&&uo.key||So(uo.name);uo.key=t;let a=1;for(;Object.keys(hn).some((e=>e===uo.key))&&a<1e3;)uo.key=`${t}-${a}`,a++;for(a=1;Object.keys(hn).some((e=>hn[e].name===uo.name))&&a<1e3;)uo.name+=` (${a})`,a++}hn[uo.key]=uo,On.registerGradient(uo.key,uo),Ms(),Ps(),zs(ye),uo=null,location.href="#config"}}function zs(e){const t=e=>e.map((({value:e,disabled:t})=>({value:e,disabled:t})));if(e&&e!=xe||Gs(xe,t(wn)),e&&e!=Le||Gs(Le,Object.keys(hn).map((e=>({value:e,disabled:hn[e].disabled})))),!e||e==ye){const e={};Object.keys(hn).filter((e=>hn[e].key)).forEach((t=>e[t]=hn[t])),Gs(ye,e)}if(e&&e!=Se||Gs(Se,t(gn)),!e||e==Me){let e=[];for(const t of[0,1,2])e.push({min:At(`.min-db[data-preset="${t}"]`).value,max:At(`.max-db[data-preset="${t}"]`).value,boost:At(`.linear-boost[data-preset="${t}"]`).value});Gs(Me,e)}if(!e||e==Ee){const e={info:aa.value,track:rn.value,end:Kt.value,covers:Ua.checked,count:ja.checked,osdFontSize:ya.value};Gs(Ee,e)}if(!e||e==$e){const e={autoHide:Mt.checked,bgLocation:Nt.value,bgMaxItems:qt.value,fsHeight:Zt.value,invertVol:na.checked,maxFPS:da.value,pipRatio:Sa.value,saveDir:Ha.checked,saveQueue:Fa.checked,surround:on.checked};Gs($e,e)}if(!e||e==Oe){const e={gravity:ta.value,peakFade:xa.value,peakHold:La.value};Gs(Oe,e)}if(!e||e==Re){const e={background:en.value,color:tn.value,noDimSubs:ma.checked,noDimVideo:ba.checked,position:an.value,posAudio:nn.value,reduceOnSubs:Ia.checked,reduceOnVideo:Pa.checked,videoFill:cn.checked};Gs(Re,e)}}function Gs(e,t){localStorage.setItem(e,JSON.stringify(t))}function Ws(e,t,a,n){const o=`User Preset #${e+1}`,s=zn[e].name||"",i=On.isFullscreen;if(!Do(zn[e])&&!n&&bo!==e)return void(i?(Ys(`Overwrite ${o} - Press again to confirm!`,5),bo=e,setTimeout((()=>{bo===e&&(bo=!1)}),5e3)):D().confirm({text:`Do you really want to overwrite ${o}?<br>${s}`,submitText:"Overwrite",submitCallback:()=>{Ws(e,t,a,!0)},cancelCallback:()=>{D().alert({text:"Canceled!"})}}));if(bo=!1,!a||!`${a}`.trim()){if(!i)return void D().input({text:"Give this preset a name or short description",submitText:"Save",value:s,maxlength:40,submitCallback:a=>{Ws(e,t,a.trim()||Ke,!0)},cancelCallback:()=>{D().alert({text:"Save canceled!"})}});a=""}a==Ke&&(a=""),zn[e]={name:a,options:t},Gs(we,zn);const r=`Saved to ${o}`;i?Ys(r,5):D().alert({text:r}),Rs()}function Ks(e,t=1){Mn=setTimeout((()=>{po=e,hs(t)}),200)}function Vs(e){document.documentElement.style.setProperty("--background-image",e?`url('${e.replace(/['()]/g,"\\$&")}')`:"none")}function Ys(e,t=2,a=-1){if(e){const n=performance.now(),o=n+1e3*t;e==+e?(co.info=e,co.startTime=n,co.endTime=Math.max(o,co.endTime||0),co.fade=t==1/0?0:t/3*a):(co.msg=e,2==co.info&&(co.info=1),co.msgTimer=o)}else co={endTime:0,msgTimer:0}}function Js(){yo.src=io[In].dataset.cover,Rt.value==G&&Vs(yo.src)}function Xs(e){Mt.checked=e.autoHide,Nt.value=e.bgLocation,qt.value=e.bgMaxItems,Zt.value=e.fsHeight,na.checked=e.invertVol,da.value=e.maxFPS,Sa.value=e.pipRatio,Ha.checked=e.saveDir,Fa.checked=e.saveQueue,on.checked=e.surround}function Zs(e){aa.value=e.info,rn.value=e.track,Kt.value=e.end,ya.value=e.osdFontSize,Ua.checked=e.covers,ja.checked=e.count}function Qs(){const e=Rt.value[0],t=Bo(Wa)&&!!io[In].querySelector("track").src,a=qo(),n=a||t||e!=U&&e!=z,o=Pa.checked&&a||Ia.checked&&t;for(const e of io)Zo(e,(a||t)&&e==io[In]);return On.overlay=n,On.showBgColor=!a&&e==U,zt.style.backgroundImage=a?"none":"var(--background-image)",Zo(ln,e==K&&!a),Zo(Wt,!(a&&ba.checked||t&&ma.checked)),It.classList.toggle(se,o),zt.classList.toggle(se,o),n}function ei(e){ta.value=e.gravity,xa.value=e.peakFade,La.value=e.peakHold}function ti(e,t=!0){Array.isArray(e)||(e=[e]);const a=()=>Zo(ea,$o(jt)!=ce&&!Bo(ra));for(const n of e){switch(n){case Ot:On.alphaBars=Bo(Ot);break;case Pt:On.ansiBands=+$o(Pt);break;case Mt:pi(!0);break;case Rt:const e=Rt.value[0],o=Rt[Rt.selectedIndex].idx,s=Qs();if(e==K){Vs();const e=lo[void 0===o?Ko(lo.length):o].url;try{decodeURIComponent(ln.src).endsWith(decodeURIComponent(e))||(ln.src=e)}catch(t){ln.src=e}}else s&&![U,z].includes(e)?Vs(e==G?yo.src:ro[void 0===o?Ko(ro.length):o].url):Vs();break;case Dt:Jo(pa,$o(Dt)),ti(pa,!1);break;case Ht:const i=$o(Ht);On.barSpace=On.isLumiBars||1==i?1.5:i;break;case Bt:const r=Bt.value,l=r==te||r==ae||r==ne;zt.classList.toggle("repeat",r==Q),zt.classList.toggle("cover",r==X||l),zt.style.backgroundSize="",Zo(un,l),un.classList.toggle("rotating",r==ne),un.classList.toggle("paused",r==te);break;case Ft:Wt.style.background=`rgba(0,0,0,${1-Ft.value})`;break;case Nt:Nt.value==J?window.showDirectoryPicker({startIn:"pictures"}).then((e=>{(0,P.hZ)(ke,e)})).catch((e=>{Nt.value=V,(0,P.yH)(ke)})).finally((()=>Ns())):((0,P.yH)(ke),Ns());break;case qt:Os();break;case jt:On.channelLayout=$o(jt),a();break;case Ut:On.colorMode=$o(Ut);break;case Yt:On.fillAlpha=Yt.value;break;case Vt:On.fftSize=$o(Vt),ls("FFT size is "+On.fftSize+" samples");break;case Jt:On.showFPS=Bo(Jt);break;case Xt:On.frequencyScale=$o(Xt);break;case Zt:It.style.height=`${Zt.value}%`;break;case Qt:case ea:""===n.value&&(n.selectedIndex=0),Bo(ra)?On.gradient=Qt.value=ea.value=n.value:On[n==Qt?"gradientLeft":"gradientRight"]=n.value;break;case oa:On.ledBars=Bo(oa);break;case sa:On.linearAmplitude=+$o(sa);break;case ia:On.lineWidth=ia.value;break;case ra:a(),Bo(ra)&&ti(Qt,!1);break;case la:On.loRes=Bo(la);break;case ca:On.lumiBars=Bo(ca),ti(Ht,!1);break;case da:On.maxFPS=da.value;break;case fa:On.mirror=$o(fa);break;case pa:const c=$o(pa);On.mode=c==He?$o(Dt):c,ti(Ht,!1);break;case ha:gi();break;case ma:case ba:Qs();break;case ya:rs();break;case va:On.outlineBars=Bo(va);break;case ta:On.gravity=ta.value;break;case xa:On.peakFadeTime=xa.value;break;case La:On.peakHoldTime=La.value;break;case Sa:Ho()&&(On.width=On.height*Sa.value);break;case $a:On.radial=Bo($a),ti(Ht,!1);break;case Ta:On.radius=$o(Ta);break;case Aa:const d=Aa.value;Nn&&(Nn=clearInterval(Nn)),d>1&&(Nn=setInterval(Hs,2500*d));break;case Oa:case _a:for(;+_a.value<=+Oa.value;)_a.selectedIndex++;On.setFreqRange(Oa.value,_a.value);break;case Ia:case Pa:Qs();break;case Ma:switch($o(Ma)){case Xe:On.reflexRatio=.25,On.reflexAlpha=.2;break;case Ye:On.reflexRatio=.4,On.reflexAlpha=.2;break;case Je:On.reflexRatio=.5,On.reflexAlpha=1;break;default:On.reflexRatio=0}break;case Da:On.roundBars=Bo(Da);break;case Ha:Ha.checked?Vo(g):((0,P.yH)(Ae),Fs(Ae));break;case Fa:Fa.checked?ui(!0):(0,P.yH)(Pe);break;case Ba:On.showScaleX=$o(Ba)!=bt,On.noteLabels=$o(Ba)==gt;break;case Na:On.showScaleY=+$o(Na);break;case qa:const u=$o(qa);On.setSensitivity(At(`.min-db[data-preset="${u}"]`).value,At(`.max-db[data-preset="${u}"]`).value),On.linearBoost=At(`.linear-boost[data-preset="${u}"]`).value;break;case za:On.showPeaks=$o(za)!=Ue,On.fadePeaks=$o(za)==ze;break;case Wa:ni();break;case Ka:On.smoothing=Ka.value,ls("smoothingTimeConstant is "+On.smoothing);break;case Xa:const f=Xa.checked;t=!1,ai(f,(e=>{f&&e?(Gn=ha.checked,gi(!0)):f||gi(!!Gn),vi()}));break;case Za:On.spinSpeed=Za.value;break;case Qa:On.splitGradient=Bo(Qa);break;case en:case tn:zt.className=zt.className.replace(new RegExp(`(${xt}|${Lt})\\S*`,"gi"),""),zt.classList.add(xt+en.value,Lt+tn.value);break;case nn:case an:si();break;case on:mi();break;case cn:zt.classList.toggle(ie,!cn.checked);break;case fn:On.weightingFilter=$o(fn)}t&&(xn.includes(n)?zs($e):kn.includes(n)?zs(Ee):Cn.includes(n)?zs(Oe):Tn.includes(n)?zs(Re):vi())}}async function ai(e,t){Xa.checked=e,e?navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{Rn=On.audioCtx.createMediaStreamSource(e),Fo()&&io[In].pause(),On.connectInput(Rn),ls("Audio source set to microphone")})).catch((e=>{ls(`Could not change audio source - ${e}`,!0),Xa.checked=!1})).finally((()=>{t&&t(Xa.checked)})):(ls("Cannot access user microphone",!0),Xa.checked=!1,t&&t(!1)):(Rn&&(On.disconnectInput(Rn),Rn.mediaStream.getTracks()[0].stop(),Rn=null),ls("Audio source set to built-in player"),t&&t(!0))}function ni(){for(const e of io)e.textTracks[0].mode="hidden",Bo(Wa)&&(e.textTracks[0].mode="showing");Qs()}function oi(e){ma.checked=e.noDimSubs,ba.checked=e.noDimVideo,Ia.checked=e.reduceOnSubs,Pa.checked=e.reduceOnVideo,en.value=e.background,tn.value=e.color,an.value=e.position,nn.value=e.posAudio,cn.checked=e.videoFill}function si(e){const t=e?[e.target]:_t("track");for(const e of t){let t,a,n=!1;switch((qo(e.parentElement)?an:nn).value){case St:t="end",a=95;break;case Et:t="center",a=50;break;default:t="start",a=1,n=!0}for(const o of e.track.cues)o.line=a,o.snapToLines=n,o.lineAlign=t}}function ii(e){dn.dataset.value=e,On.volume=e**2.5,dn.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function ri(){let e;zt.addEventListener("mouseenter",(()=>{Mt.checked&&!On.isFullscreen&&(e=setTimeout((()=>pi(!1)),500))})),zt.addEventListener("mouseleave",(()=>clearTimeout(e))),sn.addEventListener("click",(()=>pi())),zt.addEventListener("transitionend",(()=>{if(zt.style.height)for(const e of _n)Zo(At(`#${e.value}`),!1);document.body.style.overflowY=window.innerHeight<Tt?"scroll":""}));const t=wa.panel;let a;t.forEach((e=>{e.addEventListener("click",(a=>{t.forEach((e=>At(`#${e.value}`).classList.toggle("active",e==a.target))),pi(!0),"console"==e.value&&(Pn.classList.remove(re),ls())}))})),At(`#panel-${_n[0].value}`).checked=!0,ua.classList.add("active"),At("#console-clear").addEventListener("click",(()=>ls("Console cleared.",!1,!0))),At("#console-copy").addEventListener("click",(()=>{let e="";for(const t of _t("#console-content div"))e+=t.innerText+"\n";navigator.clipboard&&navigator.clipboard.writeText(e).then((()=>ls("Console messages copied to clipboard"))).catch((e=>ls(e,!0)))})),Gt.addEventListener("click",(()=>ls("Debug "+(Gt.checked?"enabled":"disabled")))),_t(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,ti(e)}))})),_t("[data-prop]").forEach((e=>{Mo(e)?e.elements[e.dataset.prop].forEach((t=>{t.addEventListener("click",(()=>ti(e)))})):e.addEventListener("input",(()=>{ti(e),ki(e)}))})),dn.addEventListener("wheel",(e=>{e.preventDefault(),a||(a=setTimeout((()=>a=!1),50),ss(Math.sign(e.deltaY||0)*(na.checked?-1:1)))})),At("#btn_play").addEventListener("click",(()=>Ts())),At("#btn_stop").addEventListener("click",di),At("#btn_shuf").addEventListener("click",li),At("#btn_prev").addEventListener("mousedown",(()=>Ks("m",-1))),At("#btn_prev").addEventListener("click",(e=>{ms()||ci(!0)})),At("#btn_next").addEventListener("mousedown",(()=>Ks("m"))),At("#btn_next").addEventListener("click",(()=>{ms()||ci()})),Ja.addEventListener("input",(()=>{const e=io[In],{duration:t}=e;t&&t!=1/0?e.currentTime=t*Ja.value:Ja.value=0})),Ca.addEventListener("input",(()=>{const e=Ca.value;e&&(D().confirm({text:`Load preset ${Co(Ca)}?`,submitText:"LOAD",submitCallback:()=>xs(e)}),Ca.value="")})),At("#btn_manage_presets").addEventListener("click",(()=>{const e=[];zn.map(((e,t)=>`<strong>[${t+1}]</strong>&nbsp; ${Do(e)?'<em class="empty">Empty slot</em>':e.name||Ke}`)).forEach(((t,a)=>{const{name:n,options:o}=zn[a];e.push({type:1,text:t,handler:()=>Ws(a,To())},{type:2,text:Do(o)?"":'<button title="Rename">edit</button>',handler:()=>Ws(a,o,"",!0)},{type:2,text:Do(o)?"":'<button title="Download">file_save</button>',handler:()=>fs(o,n)},{type:2,text:Do(o)?"":'<button title="Delete">delete</button>',handler:()=>ps(a)})})),D().select({text:"<strong>Click slot to SAVE - Use buttons to Rename, Download or Delete</strong>",choices:e})}));for(const[e,t]of[[At("#preset_last"),We],[At("#preset_default"),Ge]])e.addEventListener("click",(()=>{D().confirm({text:`Restore all options in <strong>Settings</strong> and <strong>Advanced</strong> panels to ${t==Ge?"defaults":"session start"}?`,submitText:"RESTORE",submitCallback:()=>xs(t)})}));At("#btn_clear").addEventListener("click",(()=>{!function(){for(;Fn.hasChildNodes();)js(Fn.removeChild(Fn.firstChild));Fo()?Bn=-1:(Bn=0,is(In)),is(Dn),bi()}(),ui(!0)})),At("#create_playlist").addEventListener("click",(()=>ui())),At("#delete_playlist").addEventListener("click",(()=>{return e=Ea.selectedIndex,void(Ea[e].value&&D().confirm({text:`Do you really want to DELETE the "${Ea[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:async()=>{const t=Ea[e].value,a=De+t,n=await(0,P.Jt)(Ie);n&&delete n[t],await(0,P.yH)(a),await(0,P.hZ)(Ie,n),D().alert({text:"Playlist deleted"}),Ls()},cancelCallback:()=>{D().alert({text:"Canceled"})}}));var e})),At("#load_playlist").addEventListener("click",(()=>{ws({file:Ea.value}).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;D().alert({text:t,time:5})}))})),At("#save_playlist").addEventListener("click",(()=>{var e;(e=Ea.selectedIndex)?D().confirm({text:`Overwrite "${Ea[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{ui(Ea[e].value)},cancelCallback:()=>{D().alert({text:"Canceled"})}}):ui()})),ka.addEventListener("click",(()=>hi()));const n=At("#btn_toggle_filesystem"),s=()=>n.innerText=Un?"cloud":"hard_drive";(qn||Un)&&jn?(s(),n.addEventListener("click",(async()=>{Un=!Un;const e=Un?await(0,P.Jt)(Ae):ys(Ae);Un&&e&&"granted"!=await e[0].handle.requestPermission()?Un=!1:(w=!w,g=[],f=null,k=[w?i:o],O(e),s(),Gs(Ce,Un))}))):Zo(n,!1);const r=At("#btn_add_selected"),l=At("#btn_add_folder");qn||Un?(r.addEventListener("mousedown",(()=>es($(".selected")))),l.addEventListener("click",(()=>es($())))):(Zo(r,!1),Zo(l,!1));const c=At("#local_file");let d,u;jn?Zo(c.parentElement,!1):c.addEventListener("change",(e=>function(e){const t=e.files[0];if(t){is();const e=io[In];e.dataset.file=t.name,e.dataset.title=zo(t.name).baseName,ks(t,e,!0).then((e=>I.WC(e))).then((t=>ts(t,e))).catch((e=>{}))}}(e.target))),At("#btn_load_url").addEventListener("click",(()=>{D().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&(ns({file:e},!0),ui(!0))}})})),At("#btn_fullscreen").addEventListener("click",bs);const p=At("#btn_pip");document.pictureInPictureEnabled?p.addEventListener("click",(async()=>{if(wo!==document.pictureInPictureElement){const e=On.canvas.captureStream();d=e.getTracks()[0],wo.muted=!0,wo.srcObject=e,await wo.play(),wo.requestPictureInPicture()}else document.exitPictureInPicture()})):p.classList.add("disabled");const h=((e,t=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}})((()=>On.setCanvasSize(u.width,u.height)));wo.addEventListener("enterpictureinpicture",(e=>{u=e.pictureInPictureWindow,zt.classList.add("pip"),p.classList.add("active"),On.setCanvasSize(u.height*Sa.value,u.height),u.addEventListener("resize",h)})),wo.addEventListener("leavepictureinpicture",(()=>{u.removeEventListener("resize",h),wo.pause(),d.stop(),wo.srcObject=d=null,p.classList.remove("active"),zt.classList.remove("pip"),On.setCanvasSize()}));const m=navigator.mediaSession;m&&(m.setActionHandler("play",(()=>Ts())),m.setActionHandler("pause",(()=>Ts())),m.setActionHandler("previoustrack",(()=>As())),m.setActionHandler("nexttrack",(()=>$s()))),At("#add-gradient").addEventListener("click",(()=>Cs())),At("#btn-save-gradient").addEventListener("click",(()=>Us())),At("#btn-save-gradient-copy").addEventListener("click",(()=>Cs(!0))),At("#btn-delete-gradient").addEventListener("click",(()=>{D().confirm({text:`Do you really want to DELETE <strong>${uo.name}</strong>?<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{uo&&uo.key&&(delete hn[uo.key],0===Object.keys(hn).filter((e=>!hn[e].disabled)).length&&(hn[Object.keys(hn)[0]].disabled=!1),Ms(),Ps(),zs(ye),zs(Le),uo=null,location.href="#config")}})})),At("#btn-export-gradient").addEventListener("click",(()=>fs(uo,`audioMotion-gradient-${uo.key}`)));const b=At("#import_gradient");b.addEventListener("input",(()=>{const e=b.files[0];b.value="",e.text().then((e=>{try{uo=JSON.parse(e)}catch(e){return void ls(e,!0)}Us(!0)}))})),At("#new-gradient-bkgd").addEventListener("input",(e=>{uo.bgColor=e.target.value})),At("#new-gradient-name").addEventListener("input",(e=>{uo.name=e.target.value})),At("#new-gradient-horizontal").addEventListener("input",(e=>{uo.dir=e.target.checked?"h":void 0}));const v=_t("details"),y=e=>v.forEach((e=>e.open=!1));v.forEach((e=>{e.addEventListener("click",(()=>{e.open||y()}))})),At("#manage_gradients").addEventListener("click",(()=>{location.href="#config",y(),At("#gradients_management").open=!0})),At("#export_settings").addEventListener("click",(()=>fs(To(),"audioMotion-settings")));const x=At("#import_settings");x.addEventListener("input",(()=>{const e=x.files[0];x.value="",D().confirm({text:"ATTENTION!<br>This will overwrite all current options in the <strong>Settings</strong> and <strong>Advanced</strong> panels!",submitText:"IMPORT",submitCallback:()=>{e.text().then((e=>{try{xs(JSON.parse(e))}catch(e){ls(e,!0)}}))}})}))}function li(){for(let e=Wo()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=Fn.replaceChild(Fn.children[t],Fn.children[e]);Fn.insertBefore(a,Fn.children[t])}_s(0),ui(!0)}function ci(e=!1){(e?As():$s())||Ys(`Already at ${e?"first":"last"} track`)}function di(){for(const e of io)e.pause();Ys(),Ss(0)}async function ui(e,t=!0){const a=1==e;if(!a||Fa.checked)if(0!=Wo()||a)if(e){let n;if(!a&&!t){n=So(e,"_");let t=await(0,P.Jt)(Ie)||{},a=0,o=n;for(;t.hasOwnProperty(n)&&a<1e3;)n=o+"_"+a,a++;t[n]=e,await(0,P.hZ)(Ie,t),Ls(n)}let o=[];for(const e of Fn.childNodes){const{album:t,artist:a,codec:n,duration:s,file:i,title:r}=e.dataset,{handle:l,dirHandle:c}=e;o.push({file:i,handle:l,dirHandle:c,content:{album:t,artist:a,codec:n,duration:s,title:r}})}a?(0,P.hZ)(Pe,o):(0,P.hZ)(De+n,o).then((()=>D().alert({text:"Playlist saved!"})))}else D().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&ui(e,!1)},cancelCallback:()=>{D().alert({text:"Canceled"})}});else D().alert({text:"Queue is empty!"})}function fi(e){for(const t of io)t.dataset.file==e.dataset.file&&ts(e,t)}function pi(e){if(void 0===e&&(e=!!zt.style.height),window.innerHeight>=Tt&&(document.body.style.overflowY="hidden"),e)for(const e of _n)Zo(At(`#${e.value}`),!0);const t=At(".player-panel").clientHeight+At(".bottom-panel").clientHeight+10;zt.style.height=e?"":`calc( 100vh - ${t}px )`,sn.classList.toggle("closed",!e)}function hi(){co.endTime<performance.now()&&(co.info=0),2==co.info?Ys():Ys(1+(0|co.info),+aa.value||1/0)}function mi(){const{destination:e}=On.audioCtx,{maxChannelCount:t}=e,a=on.checked;if(Hn)if(On.disconnectInput(),a)for(const e of mo)On.connectInput(e);else On.connectInput(Hn);e.channelCount=Math.min(a?6:2,t),ls(`Surround audio output ${a?"enabled":"disabled"}. Device supports ${t} channels; channels in use: ${e.channelCount}`),ds("connected nodes",On.connectedSources)}function bi(){const e=Fn.querySelector(".current"),t=Fn.children[Bn];e&&e.classList.remove("current"),t&&(t.classList.add("current"),t.scrollIntoViewIfNeeded())}function gi(e){void 0!==e?ha.checked=e:e=ha.checked,e?On.disconnectOutput():On.connectOutput()}function vi(){Gs(Te,{...To(),micSource:Xa.checked,mute:ha.checked,volume:dn.dataset.value})}function ki(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=(t=>{const{abs:a,sign:n}=Math;return e==Dt?["","10 bands (octaves)","20 bands (half octaves)","30 bands (1/3rd oct.)","40 bands (1/4th oct.)","60 bands (1/6th oct.)","80 bands (1/8th oct.)","120 bands (1/12th oct.)","240 bands (1/24th oct.)"][+t||0]:e==Ht?0==t?"None":1==t?"Legacy":(100*t|0)+"%":e==Yt?0==t?0:(100*t|0)+"%":e==Za?0==t?"OFF":a(t)+" RPM"+(-1==n(t)?" (CCW)":""):t})(e.value))}!async function(){const e=e=>{const t=$s(!0);ds("audioOnEnded",{mediaEl:e.target.id.slice(-1),isNextSong:t}),t||(di(),Ys("Queue ended",10),Ho()&&wo.pause())},t=e=>{e.target.attributes.src&&ls("Error loading "+e.target.src,!0)},a=e=>{ds("audioOnPlay",{mediaEl:e.target.id.slice(-1)}),io[In].attributes.src?(Ho()&&wo.play(),io[In].currentTime<.1&&"1"==Aa.value&&Hs(!0),Bo(Ga)&&Ys(1,+rn.value||1/0)):_s(Bn)},r=e=>{if(e.target!=io[In])return;const{currentTime:t,duration:a}=io[In];Ja.value=a&&a!=1/0?t/a:0,Ya.innerText=Yo(t,!0),Va.innerHTML=Yo(a?t-a:0,!0).padEnd(6).replaceAll(" ","&nbsp;")};let l=!1;const c="audiomotion.app"!=window.location.hostname,d=new URL(window.location).searchParams,u=d.get("mode"),E=d.get("frontPanel")||d.get("mediaPanel");null!=d.get("debug")&&(Gt.checked=!0,ls("Debug enabled via URL parameter")),Is(wa,_n,"panel"),Pn=At('label[for="panel-console"]'),window.addEventListener("error",(e=>ls(`Unexpected ${e.error}`,!0))),ls(`audioMotion v${F} initializing...`),ls(`User agent: ${navigator.userAgent}`),At("#version").innerText=F;const $=ys(_e),T=At("#update-banner");let A;null!=$&&$!=F||T.remove(),$!=F&&(Gs(_e,F),null!=$&&(T.classList.add(Ct),T.addEventListener("click",(()=>T.classList.remove(Ct))),setTimeout((()=>{T.classList.remove(Ct)}),1e4)));try{A=await fetch(vt)}catch(e){}let _=A&&A.ok?await A.text():"{}";try{_=JSON.parse(_)}catch(e){ls(`Error parsing ${vt} - ${e}`,!0),_={}}_={...kt,frontPanel:_.mediaPanel,..._},jn=_.enableLocalAccess&&!!window.showDirectoryPicker;let I=_.enableLocalAccess&&(!c||u==ve||"server"!=u&&ys(Ce));null===I&&(I=_.defaultAccessMode==ve),(E==qe||_.frontPanel==qe&&E!=je)&&pi(!1),ls(`Instantiating audioMotion-analyzer v${n.A.version}`),On=new n.A(It,{bgAlpha:0,fsElement:zt,onCanvasDraw:(e,t)=>{if(!io.length)return;const a=io[In],n=a.dataset,o=a.duration-a.currentTime,s=+Kt.value,i=Rt.value[0],r=Bt.value,l=ho+1/e.fps,c=Bo(ga),d=e.pixelRatio,{timestamp:u}=t;if(o<l&&Fo()&&(ds("gapless track skip",{remaining:o,interval:l}),$s()),s>0&&o<=s&&Bo(Ga)&&u>co.endTime&&Fo()&&Ys(1,o,1),!(r!=ee&&"4"!=r&&"5"!=r||i!=G&&i!=W)){let t;if(r==ee)t=(70*e.getEnergy()|0)-25;else{const e=a.currentTime/a.duration;t=100*("4"==r?e:1-e)}zt.style.backgroundSize=`auto ${100+t}%`}ka.width|=0;const{endTime:f,startTime:p,msgTimer:h,info:m,msg:b,fade:g}=co;if(u>f&&u>h)return;const v=(e,t,a,n)=>{c?(ko.strokeText(e,t,a,n),ko.fillText(e,t,a,n)):(ko.shadowOffsetX=ko.shadowOffsetY=3*d,ko.fillText(e,t,a,n),ko.shadowOffsetX=ko.shadowOffsetY=0)};if(ko.lineWidth=4*d,ko.lineJoin="round",ko.font=oo,ko.textAlign="center",ko.fillStyle="#fff",ko.strokeStyle=ko.shadowColor="#000",h>u&&(u>f||2!=m)){const e=(h-u)/1e3;ko.globalAlpha=e>1?1:e,v(co.msg,Yn,Xn)}if(f>u){if(g<0){const e=(f-u)/1e3;ko.globalAlpha=e>-g?1:e/-g}else{const e=Math.max(0,(u-p)/1e3);ko.globalAlpha=e>g?1:e/g}if(2==co.info&&(v(Io(),Yn,Xn,ao),ko.textAlign="left",v(Co(pa),Kn,Xn,ao),v(`Randomize: ${Co(Aa)}`,Kn,Zn,ao),ko.textAlign="right",v(Co(qa).toUpperCase()+" sensitivity",Jn,Xn,ao),v(`Repeat is ${Uo(Ra)}`,Jn,Zn,ao)),Xa.checked)ko.textAlign="left",ko.font=so,v("MIC source",Kn,eo,no);else{ko.textAlign="right",v(n.codec,Jn,Qn),v(n.quality,Jn,Qn+Kn);const e=Wo();e&&ja.checked&&v(`Track ${Bn+1} of ${e}`,Jn,Qn-Kn),ko.textAlign="left",v(n.artist.toUpperCase(),Kn,Qn,no),ko.font=`italic ${oo}`,v(n.album,Kn,to,no),ko.font=so,v(a.src?n.title:"No song loaded",Kn,eo,no),(a.duration||n.duration)&&(n.duration||(n.duration=Yo(a.duration),Fn.children[Bn]&&(Fn.children[Bn].dataset.duration=n.duration)),ko.textAlign="right",v(Yo(a.currentTime)+" / "+n.duration,Jn,to)),yo.width&&Ua.checked&&ko.drawImage(yo,Kn,Qn-1.3*Vn,Vn,Vn)}}},onCanvasResize:(e,t)=>{rs(t);const{canvas:a,fsWidth:n,fsHeight:o,isFullscreen:s,loRes:i,pixelRatio:r}=t;let l;switch(e){case"create":ls(`Display resolution: ${n} x ${o} px (pixelRatio: ${window.devicePixelRatio})`),l="Canvas created";break;case"lores":l=`Lo-res ${i?"ON":"OFF"} (pixelRatio = ${r})`;break;case"fschange":l=(s?"Enter":"Exit")+"ed fullscreen";break;case"user":l=(Ho()?"Resized for":"Closed")+" PIP";break;default:return}ls(`${l||e}. Canvas size is ${a.width} x ${a.height} px`)}});const R=On.audioCtx,H=function(){const e=(e,t)=>{Array.isArray(e)&&e.forEach((e=>{const{value:a,disabled:n}="object"==typeof e?e:{value:e,disabled:!0},o=Array.isArray(t)?t.find((e=>e.value==a)):t[a];o&&(o.disabled=n)}))},t=ys(Te),a=null!==t,n=ys($e)||{},{fftSize:o,smoothing:s}=n;((e,t)=>{const a=Ao(e);-1!=a&&(pn[a].options=t)})(We,{..._o(Ge),fftSize:o,smoothing:s,...t}),zn=ys(we)||[],Array.isArray(zn)||(zn=[{name:"Custom",options:zn}]);for(let e=0;e<9;e++)void 0===zn[e]?zn[e]={}:Do(zn[e])||zn[e].options||(zn[e]={options:zn[e]});e(ys(xe),wn);const i=ys(ye);i&&Object.keys(i).forEach((e=>{hn[e]=i[e],hn[e].key=e})),e(ys(Le),hn),e(ys(Se),gn);const r=_t(".min-db");r.forEach((e=>Xo(e,-120,-60)));const l=_t(".max-db");l.forEach((e=>Xo(e,-50,0)));const c=_t(".linear-boost");c.forEach((e=>Xo(e,1,5,.2))),(ys(Me)||vn).forEach(((e,t)=>{r[t].value=e.min,l[t].value=e.max,c[t].value=e.boost||vn[t].boost})),Ds(Sa,En),Xo(Zt,25,100,5),Ds(da,Sn),Ds(Nt,[[V,"Disable"],[Y,"Built-in"],[...jn?[J,"Local folder"]:[]]]),Xo(qt,0,1e3),on.disabled=On.audioCtx.destination.maxChannelCount<=2,Xs({...Ln,...n}),Ds(ya,[["0","Small"],["1","Medium"],["2","Large"]]),Zs({...yn,...ys(Ee)||{}}),Xo(ta,.01,25,.01),Xo(xa,0,5e3,50),Xo(La,0,5e3,50),ei({...$n,...ys(Oe)||{}}),Ds(en,[["none","None"],[yt,"Shadow"],["solid","Solid"]]),Ds(tn,[["gold","Gold"],["gray","Gray"],[wt,"White"],["yellow","Yellow"]]);const d=[["top","Top"],[Et,"Center"],[St,"Bottom"]];return Ds(an,d),Ds(nn,d),oi({...An,...n,...ys(Re)||{}}),a}();Fn=At("#playlist"),Fn.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&(_s(Eo(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),Bn=0,M.Ay.create(Fn,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{Bn=Eo(Fn.querySelector(".current")),0!=e.newIndex||Fo()?Ss(j):Ss(0),ui(!0)}}),In=0,Dn=1,R.createStereoPanner&&(Hn=R.createStereoPanner());for(const n of[0,1])io[n]=At(`#player${n}`),is(n),io[n].addEventListener("abort",(()=>ds(`mediaEl ${n} load aborted`))),io[n].addEventListener("canplay",(()=>ds(`mediaEl ${n} can play`))),io[n].addEventListener("canplaythrough",(()=>ds(`mediaEl ${n} can play through`))),io[n].addEventListener("pause",(()=>ds(`mediaEl ${n} is paused`))),io[n].addEventListener("play",a),io[n].addEventListener("playing",(()=>ds(`mediaEl ${n} is playing`))),io[n].addEventListener("emptied",(()=>ds(`mediaEl ${n} emptied`))),io[n].addEventListener("ended",e),io[n].addEventListener("error",t),io[n].addEventListener("timeupdate",r),io[n].querySelector("track").addEventListener("load",si),Hn?(mo[n]=R.createMediaElementSource(io[n]),mo[n].connect(Hn)):On.connectInput(io[n]);Xo(Ja,0,1,.001),Ja.value=0,Ya.innerText=Va.innerText=Yo(0,!0),function(){var e,t,a,n,o;e=At("#enabled_bgfit"),t="enabledBgFit",n=Bt,o=xe,(a=wn).forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),_t(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return D().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;const s=a.find((t=>t.value==e.dataset.option));s&&(s.disabled=!e.checked,Ds(n,a),zs(o))}))}));const s=At("#enabled_gradients");Object.keys(hn).forEach((e=>{s.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${hn[e].disabled?"":"checked"}> ${hn[e].name}</label>`})),Ps();const i=At("#random_properties");gn.forEach((e=>{i.innerHTML+=`<label${e.value==ct?' class="colspan-3"':""}><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),_t(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{gn.find((t=>t.value==e.value)).disabled=!e.checked,zs(Se)}))})),_t("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{const t=e.dataset.preset;At(`.min-db[data-preset="${t}"]`).value=vn[t].min,At(`.max-db[data-preset="${t}"]`).value=vn[t].max,At(`.linear-boost[data-preset="${t}"]`).value=vn[t].boost,_t(`[data-preset="${t}"]`).forEach((e=>{e.classList.remove("field-error")})),e.dataset.preset==$o(qa)&&ti(qa,!1),zs(Me)})):e.addEventListener("change",(()=>{No(e)&&(e.dataset.preset==$o(qa)&&ti(qa,!1),zs(Me)),e.classList.toggle("field-error",!No(e))}))}));for(const e of[...kn,...xn,...Cn,...Tn])e.addEventListener("change",(()=>{No(e)&&ti(e),e.classList.toggle("field-error",!No(e))}));At("#reset_osd").addEventListener("click",(()=>{Zs(yn),ti(kn)})),At("#reset_general").addEventListener("click",(()=>{Xs(Ln),ti(xn)})),At("#reset_peak").addEventListener("click",(()=>{ei($n),ti(Cn)})),At("#reset_subs").addEventListener("click",(()=>{oi(An),ti(Tn)}))}(),Rs();for(const e of[16,20,25,30,40,50,60,100,250,500,1e3,2e3])Oa[Oa.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,2e4,22e3])_a[_a.options.length]=new Option(e/1e3+"kHz",e);Is(pa,mn),Is(jt,bn),Is(qa,[["0","Low"],["1","Medium"],["2","High"]]),Ds(Aa,[["0","OFF"],["1","On track change"],["2","every 5 seconds"],["6","every 15 seconds"],["12","every 30 seconds"],["24","every minute"],["48","every 2 minutes"],["120","every 5 minutes"]]),Is(Ma,[[Ve,"Off"],[Xe,"25%"],[Ye,"40%"],[Je,"Mirror"]]),Ds(Bt,wn),Is(fa,[["-1","Left"],["0","Off"],["1","Right"]]),Is(Xt,[[ht,"Bark"],["linear","Linear"],[mt,"Log"],["mel","Mel"]]),Is(fn,[["","Off"],["A","A"],["B","B"],["C","C"],[$t,"D"],["468","468"]]),Is(Ut,[[de,"Gradient"],[ue,"Index"],[fe,"Level"]]),Is(za,[[Ue,"Off"],[1,"Drop"],[ze,"Fade"]]),Is(Ba,[[bt,"Off"],[1,"Freqs"],[gt,"Notes"]]),Is(Na,[[bt,"Off"],[1,"On"]]),Is(Pt,[[0,"Tempered"],[1,"ANSI/IEC"]]),Is(sa,[[0,"Decibels"],[1,"Linear"]]);let B=[];for(let e=10;e<16;e++){const t=2**e;B.push([t,(t/1024|0)+"k"])}Is(Vt,B),Xo(Dt,1,8),Xo(Ht,0,1,.05),Xo(Ft,.1,1,.05),Xo(Yt,0,1,.05),Xo(ia,0,3,.5),Xo(Ta,0,1,.05),Xo(Ka,0,.95,.05),Xo(Za,-10,10,1),Ys(),Object.keys(hn).forEach((e=>{const{bgColor:t,dir:a,colorStops:n}=hn[e];n&&On.registerGradient(e,{bgColor:t,dir:a,colorStops:n})})),Ms();const N=function(e,t={}){let a;var n;return m=document.createElement("ul"),m.className="breadcrumb",e.append(m),b=document.createElement("ul"),b.className="filelist",e.append(b),a=setTimeout((()=>{m.innerHTML="Waiting for server..."}),5e3),m.innerHTML="Initializing... please wait...",m.addEventListener("click",(async function(e){e.target&&"LI"==e.target.nodeName&&function(e){let t;for(;e>0;)t=g.pop(),e--;const a=g[g.length-1];a&&a.handle&&(f=a.handle,t=null),S(t,t&&t.scrollTop)}(e.target.dataset.depth)})),b.addEventListener("click",(async function(e){const t=e.target;if(t&&"LI"==t.nodeName)if("dir"==t.dataset.type)S(t.handle||t.dataset.path);else if("mount"==t.dataset.type)if(w)try{f=await window.showDirectoryPicker({startIn:"music"}),g=[],S(f)}catch(e){}else g=[],S(t.dataset.path)})),b.addEventListener("dblclick",(function(e){const t=e.target;t&&"LI"==t.nodeName&&p&&["file","list"].includes(t.dataset.type)&&p({file:C(t.dataset.path),handle:t.handle,dirHandle:t.dirHandle,subs:t.subs},e)})),"function"==typeof t.onDblClick&&(p=t.onDblClick),"function"==typeof t.onEnterDir&&(h=t.onEnterDir),t.fileExtensions&&(n=t.fileExtensions,v=new RegExp("\\.("+n.join("|")+")$","i")),new Promise((e=>{fetch(".",{method:"HEAD"}).then((async n=>{clearTimeout(a),x=!0,k=[t.rootPath||o],y=await S(k[0]),(t.forceFileSystemAPI&&s||!y)&&(g=[],s?(k=[i],w=!0):k=[],L()),e({webServer:x,useFileSystemAPI:w,serverHasMedia:y,filelist:b})})).catch((t=>{clearTimeout(a),s?(k=[i],w=!0):k=[],L(),e({webServer:x,useFileSystemAPI:w,filelist:b})}))}))}(At("#file_explorer"),{onDblClick:(e,t)=>{es([e],!0),t.target.classList.remove("selected","sortable-chosen")},onEnterDir:e=>{Ha.checked&&l&&Vo(e)},fileExtensions:[...he,...be,...ge],forceFileSystemAPI:I}).then((e=>{Wn=e.webServer,qn=e.serverHasMedia,Un=e.useFileSystemAPI;const{filelist:t}=e;qn||ls(Wn?"Cannot access music directory on server":"No server found",!0),Un&&ls("Accessing files from local device via File System Access API."),!jn&&_.enableLocalAccess&&ls('No browser support for File System Access API. Cannot access files from local device. <a href="https://audiomotion.app/docs/#/known-issues?id=file-system-access-api" target="_blank">Learn more...</a>',I),Gs(Ce,I&&jn),Ls(),(Un||qn)&&M.Ay.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{if("playlist"==e.to.id){let t=e.items.length?e.items:[e.item],a=[];t.forEach((e=>{const{handle:t,dirHandle:n,subs:o}=e;a.push(ns({file:C(e.dataset.path),handle:t,dirHandle:n,subs:o})),e.remove()})),Promise.all(a).then((()=>ui(!0)))}}}),ri()}));if(window.addEventListener("keydown",gs),window.addEventListener("keyup",gs),D().setOptions({positions:{alert:"bottom"}}),window.ResizeObserver){let e;new ResizeObserver((()=>{e||(e=setTimeout((()=>{rs(),e=0}),60))})).observe(zt)}Promise.all([Ns(),N]).then((async()=>{const e=()=>{a&&O(a),Fa.checked&&ws({file:!0})},t=async()=>{!(o&&"granted"!=await n.requestPermission()||s&&"granted"!=await a[0].handle.requestPermission())&&(ua.classList.remove("locked"),window.removeEventListener("click",t),o&&Ns(),e())},a=Un?await(0,P.Jt)(Ae):ys(Ae),n=await(0,P.Jt)(ke),o=jn&&n&&"granted"!=await n.queryPermission(),s=Un&&Array.isArray(a)&&a[0]&&"granted"!=await a[0].handle.queryPermission();ls(`Loading ${H?"last session":"default"} settings`),xs(We,!1,!0),o||s?(ua.classList.add("locked"),window.addEventListener("click",t)):e(),ti([Zt,on,cn,...Tn],!1),ho=(R.outputLatency||0)+R.baseLatency,ls(`AudioContext sample rate is ${R.sampleRate}Hz; Total latency is ${1e3*ho|0}ms`),ls("Initialization complete!"),l=!0}))}()},6216:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),n=parseInt(a.getPropertyValue("border-top-width")),o=parseInt(a.getPropertyValue("border-left-width")),s=this.offsetTop-t.offsetTop<t.scrollTop,i=this.offsetTop-t.offsetTop+this.clientHeight-n>t.scrollTop+t.clientHeight,r=this.offsetLeft-t.offsetLeft<t.scrollLeft,l=this.offsetLeft-t.offsetLeft+this.clientWidth-o>t.scrollLeft+t.clientWidth,c=s&&!i;(s||i)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-n+this.clientHeight/2),(r||l)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-o+this.clientWidth/2),(s||i||r||l)&&!e&&this.scrollIntoView(c)})},143:()=>{},3411:()=>{}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,a,o,s)=>{if(!a){var i=1/0;for(d=0;d<e.length;d++){for(var[a,o,s]=e[d],r=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(n.O).every((e=>n.O[e](a[l])))?a.splice(l--,1):(r=!1,s<i&&(i=s));if(r){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,o,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[i,r,l]=a,c=0;if(i.some((t=>0!==e[t]))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var d=l(n)}for(t&&t(a);c<i.length;c++)s=i[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[96],(()=>n(6965)));o=n.O(o)})();