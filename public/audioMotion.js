(()=>{var e,t={8169:(e,t,a)=>{"use strict";var o,l,r,s=a(8841),n=[],i=[],c=!1;function d(e,t){var a,r;return void 0!==e&&(".."==e?a=i.pop():i.push({dir:e,scrollTop:l.scrollTop})),l.innerHTML="<li>Loading...</li>",r=f(),new Promise((e=>{fetch(r).then((t=>{if(200==t.status)return c?t.json():t.text();e(!1)})).then((r=>{c||(r=p(r)),function(e,t){o.innerHTML="",l.innerHTML="",i.forEach(((e,t)=>{""==e.dir&&(e.dir="root"),o.innerHTML+=`<li data-depth="${i.length-t-1}">${e.dir}</li> / `})),n.forEach((e=>{l.innerHTML+=`<li data-type="mount" data-path="${e}">[ ${e} ]</li>`})),i.length>1&&(l.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e&&(e.dirs&&e.dirs.forEach((e=>{l.innerHTML+=`<li data-type="dir" data-path="${e}">${e}</li>`})),e.files&&e.files.forEach((e=>{l.innerHTML+=`<li data-type="${null!==e.match(/\.(m3u|m3u8)$/)?"list":"file"}" data-path="${e}">${e}</li>`})),l.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e.cover?`, url('${f(e.cover)}')`:"")),l.scrollTop=t||0}(r,t||a&&a.scrollTop),e(!0)})).catch((t=>{console.log(`Error accessing directory. ${t}`),e(!1)}))}))}function u(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const[,t,o]=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i);a.push({uri:t,file:o})}return a}function p(e){const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,a=/\.(mp3|flac|m4a|aac|ogg|wav|m3u|m3u8)$/i;let o=[],l=[],r=[];const s=(e,a)=>{const o=new RegExp(`${a}.*${t.source}`,"i");return e.find((e=>e.match(o)))};for(const{uri:s,file:n}of u(e))"/"==s.substring(s.length-1)?n.match(/parent directory/i)||("/"==n.substring(n.length-1)?l.push(n.substring(0,n.length-1)):l.push(n)):n.match(t)?r.push(n):n.match(a)&&o.push(n);const n=s(r,"cover")||s(r,"folder")||s(r,"front")||r[0],i=new Intl.Collator;return{cover:n,dirs:l.sort(i.compare),files:o.sort(i.compare)}}function f(e){var t="";return i.forEach((e=>{t+=e.dir+"/"})),e&&(t+=e),t=t.replace(/#/g,"%23")}function h(e="li"){var t=[];return l.querySelectorAll(e).forEach((e=>{["file","list"].includes(e.dataset.type)&&t.push({file:f(e.dataset.path),type:e.dataset.type})})),t}var g=a(2463),m=(a(7379),a(1474)),v=a(3681),b=a.n(v);m.ZP.mount(new m.LJ);const k="3",y={album:"",artist:"",codec:"",cover:"",duration:"",file:"",quality:"",title:""},x="custom-grads",L="custom-preset",S="disabled-bgfit",w="disabled-gradients",E="disabled-modes",O="disabled-properties",$="display-options",I="general-settings",C="last-config",T="sensitivity-presets",_=document.querySelector.bind(document),A=document.querySelectorAll.bind(document),M=_("#alpha_bars"),R=_("#analyzer"),P=_("#background"),N=_("#balance"),H=_("#bar_space"),D=_("#bg_img_dim"),F=_("#bg_img_fit"),q=_("#bg_container"),z=_("#cycle_grad"),j=_("#bg_dim"),B=_("#end_timeout"),K=_("#fft_size"),W=_("#fill_alpha"),U=_("#fps"),G=_("#fs_height"),J=_("#gradient"),V=_("#info_timeout"),X=_("#led_display"),Y=_("#line_width"),Z=_("#lo_res"),Q=_("#lumi_bars"),ee=_("#mirror"),te=_("#mode"),ae=_("#mute"),oe=_("#no_shadow"),le=_("#outline"),re=_("#osd"),se=_("#pip_ratio"),ne=_("#playlists"),ie=_("#preset"),ce=_("#radial"),de=_("#random_mode"),ue=_("#freq_max"),pe=_("#freq_min"),fe=_("#reflex"),he=_("#repeat"),ge=_("#scaleX"),me=_("#scaleY"),ve=_("#sensitivity"),be=_("#show_count"),ke=_("#show_cover"),ye=_("#show_peaks"),xe=_("#show_song"),Le=_("#smoothing"),Se=_("#source"),we=_("#spin"),Ee=_("#split_grad"),Oe=_("#stereo"),$e=_("#track_timeout"),Ie=_("#video"),Ce=_("#volume"),Te=_("#warp"),_e={default:{alphaBars:0,background:0,balance:0,barSpace:.1,bgImageDim:.5,bgImageFit:1,cycleGrad:1,fillAlpha:.1,freqMax:22e3,freqMin:20,fsHeight:100,gradient:"prism",ledDisplay:0,lineWidth:2,loRes:0,lumiBars:0,mirror:0,mode:0,noShadow:1,outlineBars:0,radial:0,randomMode:0,reflex:0,repeat:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:1,showSong:1,smoothing:.5,spin:2,splitGrad:0,stereo:0,volume:1},fullres:{freqMax:22e3,freqMin:20,mode:0,radial:0,randomMode:0,reflex:0,smoothing:.5},octave:{barSpace:.1,ledDisplay:0,lumiBars:0,mode:3,radial:0,randomMode:0,reflex:0},ledbars:{background:0,barSpace:.5,ledDisplay:1,lumiBars:0,mode:3,radial:0,randomMode:0,reflex:0},demo:{cycleGrad:1,randomMode:6}},Ae={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",disabled:!1},rainbow:{name:"Rainbow",disabled:!1},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},Me=[{value:"0",text:"Discrete frequencies",disabled:!1},{value:"10",text:"Area graph",disabled:!1},{value:"101",text:"Line graph",disabled:!1},{value:"8",text:"Full octave bands",disabled:!1},{value:"7",text:"Half octave bands",disabled:!1},{value:"6",text:"1/3rd octave bands",disabled:!1},{value:"5",text:"1/4th octave bands",disabled:!1},{value:"4",text:"1/6th octave bands",disabled:!1},{value:"3",text:"1/8th octave bands",disabled:!1},{value:"2",text:"1/12th octave bands",disabled:!1},{value:"1",text:"1/24th octave bands",disabled:!1}],Re=[{value:"alpha",text:"Alpha",disabled:!1},{value:"nobg",text:"Background",disabled:!1},{value:"barSp",text:"Bar Spacing",disabled:!1},{value:"imgfit",text:"BG Image Fit",disabled:!1},{value:"fill",text:"Fill Opacity",disabled:!1},{value:"leds",text:"LEDs",disabled:!1},{value:"line",text:"Line Width",disabled:!1},{value:"lumi",text:"Lumi",disabled:!1},{value:"mirror",text:"Mirror",disabled:!1},{value:"outline",text:"Outline",disabled:!1},{value:"peaks",text:"Peaks",disabled:!1},{value:"radial",text:"Radial",disabled:!1},{value:"spin",text:"Radial Spin",disabled:!1},{value:"reflex",text:"Reflex",disabled:!1},{value:"split",text:"Split",disabled:!1},{value:"stereo",text:"Stereo",disabled:!1}],Pe=[{min:-70,max:-20},{min:-85,max:-25},{min:-100,max:-30}],Ne={info:5,track:10,end:0,covers:!0,count:!0},He=[{value:"0",text:"Adjust",disabled:!1},{value:"1",text:"Center",disabled:!1},{value:"3",text:"Pulse",disabled:!1},{value:"2",text:"Repeat",disabled:!1},{value:"6",text:"Warp",disabled:!1},{value:"7",text:"Warp Drive",disabled:!1},{value:"8",text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],De={fftSize:8192,pipRatio:2.35},Fe=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]];let qe,ze,je,Be,Ke,We,Ue,Ge,Je,Ve,Xe,Ye,Ze,Qe=[],et=[],tt=[],at=null,ot={},lt=!1,rt=!1,st=0;const nt=re.getContext("2d"),it=new Image,ct=document.createElement("video"),dt=e=>Math.round(100*e)/100,ut=e=>{let t="",a="";return e>=3600&&(t=(e/3600|0)+":",e%=3600,a="0"),t+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),t},pt=e=>e.slice(e.lastIndexOf(".")+1).toLowerCase(),ft=e=>e.slice(0,e.lastIndexOf(".")),ht=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},gt=e=>e[e.selectedIndex].text,mt=e=>({alphaBars:+kt(M),background:P.value,barSpace:H.value,bgImageDim:D.value,bgImageFit:F.value,cycleGrad:+kt(z),fillAlpha:W.value,freqMax:ue.value,freqMin:pe.value,fsHeight:G.value,gradient:J.value,ledDisplay:+kt(X),lineWidth:Y.value,loRes:+kt(Z),lumiBars:+kt(Q),mirror:ee.value,mode:te.value,noShadow:+kt(oe),outlineBars:+kt(le),radial:+kt(ce),randomMode:de.value,reflex:fe.value,repeat:+kt(he),sensitivity:ve.value,showFPS:+kt(U),showPeaks:+kt(ye),showScaleX:+kt(ge),showScaleY:+kt(me),showSong:+kt(xe),smoothing:Le.value,spin:we.value,splitGrad:+kt(Ee),stereo:+kt(Oe)}),vt=e=>q.classList.contains("pip"),bt=(e=Qe[je])=>e&&e.currentTime>0&&!e.paused&&!e.ended,kt=e=>"1"==e.dataset.active,yt=e=>kt(e)?"ON":"OFF",xt=e=>Je.children.length,Lt=(e=2)=>Math.random()*e|0;function St(e,t=!1){const a=e.map((e=>Ot(e.file,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${xt()<1e3?"":". Queue is full!"}`;b().alert({text:a,time:5})}))}function wt(e,t){const a=t.dataset,o=e.dataset,l=e.common,r=e.format;if(o)Object.assign(a,o);else if(a.artist=l.artist||a.artist,a.title=l.title||a.title,a.album=l.album?l.album+(l.year?" ("+l.year+")":""):"",a.codec=r?r.codec||r.container:a.codec,r&&r.bitsPerSample?a.quality=(r.sampleRate/1e3|0)+"KHz / "+r.bitsPerSample+"bits":r.bitrate?a.quality=(r.bitrate/1e3|0)+"K "+(r.codecProfile||""):a.quality="",r&&r.duration?a.duration=ut(r.duration):a.duration="",l.picture&&l.picture.length){const e=new Blob([l.picture[0].data],{type:l.picture[0].format});a.cover=URL.createObjectURL(e)}t==Qe[je]&&ua()}function Et(e,t={}){if(xt()>=1e3)return 0;const a=(e=e.replace(/\\/g,"/")).split("/").pop(),o=a.split(".").pop(),l=document.createElement("li"),r=l.dataset;return Object.assign(r,y),r.artist=t.artist||"",r.title=t.title||a.replace(/%23/g,"#")||e.slice(e.lastIndexOf("//")+2),r.codec=o!==a?o.toUpperCase():"",e=e.replace(/#/g,"%23"),r.file=e,Je.appendChild(l),1!=xt()||bt()||Kt(0),Ve>xt()-3&&qt(),r.retrieve=1,ta(),1}function Ot(e,t=!1){let a;return a=["m3u","m3u8"].includes(pt(e))?zt(e):new Promise((t=>t(Et(e)))),a.then((e=>{t&&!bt()&&e>0&&Vt(xt()-e)})),a}function $t(e){let t=e?dt((+N.dataset.value||0)+.1*e):0;t<-1?t=-1:t>1&&(t=1),ca(t),da("Balance: "+(0==t?"CENTER":100*Math.abs(t)+"% "+(t>0?"Right":"Left"))),Ea()}function It(e){const t=+G.value;(1==e&&t<+G.max||-1==e&&t>+G.min)&&(G.value=t+G.step*e,fa(G,!0),Oa(G)),da(`Analyzer height: ${G.value}%`)}function Ct(e){let t=dt((+Ce.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),ga(t),da("Volume: "+20*t),Ea()}function Tt(e=je){const t=Qe[e],a=t.dataset;t.removeAttribute("src"),Object.assign(a,y),t.load(),e==je&&ua()}function _t(){for(;Je.hasChildNodes();)aa(Je.removeChild(Je.firstChild));bt()?Ve=-1:(Ve=0,Tt(je)),Tt(Ue),La()}function At(e,t,a){const o=_("#console-content"),l=new Date,r=l.toLocaleTimeString([],{hour12:!1})+"."+String(l.getMilliseconds()).padStart(3,"0");a&&(o.innerHTML=""),t&&_("#toggle_console").classList.add("warning"),e&&(o.innerHTML+=`<div ${t?'class="error"':""}>${r} ${e}</div>`),o.scrollTop=o.scrollHeight}function Mt(e,t){const a=e.selectedIndex+(t?-1:1);a<0?e.selectedIndex=e.options.length-1:a>=e.options.length?e.selectedIndex=0:e.selectedIndex=a,fa(e,!0)}function Rt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Pt(){at&&at.key&&(delete Ae[at.key],0===Object.keys(Ae).filter((e=>!Ae[e].disabled)).length&&(Ae[Object.keys(Ae)[0]].disabled=!1),Yt(),Xt(),la(x),la(w),at=null,location.href="/#config")}function Nt(e=1){const t=Qe[je];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),da(1),t.currentTime=a}"m"==lt&&sa("m",e)}function Ht(){return clearTimeout(Be),!!lt&&(lt=!1,!0)}async function Dt(){vt()&&await document.exitPictureInPicture(),qe.toggleFullscreen(),document.activeElement.blur()}function Ft(e){if("BODY"!=e.target.tagName||e.altKey||e.ctrlKey)return;const t=e.shiftKey;if("keydown"==e.type)switch(e.code){case"ArrowUp":t?It(1):Ct(1);break;case"ArrowDown":t?It(-1):Ct(-1);break;case"ArrowLeft":t?$t(-1):lt?(da("Rewind",1),Nt(-1)):sa("k",-1);break;case"ArrowRight":t?$t(1):lt?(da("Fast forward",1),Nt()):sa("k");break;default:return}else switch(e.code){case"Delete":case"Backspace":Je.querySelectorAll(".selected").forEach((e=>{aa(e),e.remove()}));const e=ht(Je.querySelector(".current"));void 0!==e?Ve=e:Ve>xt()-1?Ve=xt()-1:Ve--,xt()?qt():(Tt(Ue),bt()||Tt());break;case"Space":da(bt()?"Pause":"Play",1),Gt();break;case"ArrowLeft":case"KeyJ":Ht()||t||(da("Previous track",1),va(!0));break;case"KeyG":Mt(J,t),da("Gradient: "+Ae[J.value].name);break;case"ArrowRight":case"KeyK":Ht()||t||(da("Next track",1),va());break;case"KeyA":kt(z)||t?de.selectedIndex==de.options.length-1&&!t||0==de.selectedIndex&&kt(z)&&t?(z.dataset.active="0",de.value="0",da("Auto gradient OFF / Random mode OFF")):(Mt(de,t),da("Random mode: "+gt(de))):(z.dataset.active="1",da("Auto gradient ON")),fa(de,!0);break;case"KeyB":Mt(t?F:P);const a=P.value[0];da("Background: "+gt(P)+(a>1&&a<7?` (${gt(F)})`:""));break;case"KeyC":ce.click(),da("Radial "+yt(ce));break;case"KeyD":xa();break;case"KeyE":xt()>0&&(ma(),da("Shuffle"));break;case"KeyF":Dt();break;case"KeyH":U.click();break;case"KeyI":xe.click(),da("Song info display "+yt(xe));break;case"KeyL":X.click(),da("LED effect "+yt(X));break;case"KeyM":case"KeyV":Mt(te,t),da("Mode: "+gt(te));break;case"KeyN":Mt(ve,t),da(gt(ve).toUpperCase()+" sensitivity");break;case"KeyO":Z.click(),da((kt(Z)?"LOW":"HIGH")+" Resolution");break;case"KeyP":ye.click(),da("Peaks "+yt(ye));break;case"KeyR":he.click(),da("Queue repeat "+yt(he));break;case"KeyS":da("Scale: "+["None","Frequency (Hz)","Level (dB)","Both"][function(e){let t=+ge.dataset.active+(me.dataset.active<<1)+(e?-1:1);return t<0?t=3:t>3&&(t=0),ge.dataset.active=1&t,me.dataset.active=t>>1,fa([ge,me],!0),t}(t)]);break;case"KeyT":oe.click(),da((kt(oe)?"Flat":"Shadowed")+" text mode");break;case"KeyU":Q.click(),da("Luminance bars "+yt(Q));break;case"KeyX":Mt(fe,t),da("Reflex: "+gt(fe));break;default:return}e.preventDefault()}function qt(){const e=Ve<xt()-1?Ve+1:0,t=Je.children[e],a=Qe[Ue];t&&(a.src=t.dataset.file,a.load(),wt(t,a)),rt=!1}function zt(e){return e=e.replace(/\\/g,"/"),new Promise((t=>{let a,o=0;if(e)if(["m3u","m3u8"].includes(pt(e)))fetch(e).then((t=>{if(200==t.status)return t.text();At(`Fetch returned error code ${t.status} for URI ${e}`,!0)})).then((l=>{e=e.slice(0,e.lastIndexOf("/")+1),l.split(/[\r\n]+/).forEach((t=>{if("#"!=t.charAt(0)&&""!=t.trim()){t=t.replace(/\\/g,"/"),a||(a=t.slice(t.lastIndexOf("/")+1),a=ft(a).replace(/_/g," ")),"http"!=t.slice(0,4)&&":"!=t[1]&&"/"!=t[0]&&(t=e+t);const l=a.indexOf(" - "),r=-1==l?{title:a}:{artist:a.slice(0,l),title:a.slice(l+3)};o+=Et(t,r),a=""}else"#EXTINF"==t.slice(0,7)&&(a=t.slice(t.indexOf(",")+1||8))})),t(o)})).catch((e=>{At(e,!0),t(o)}));else{let l=localStorage.getItem("pl_"+e);l?(l=JSON.parse(l),l.forEach((e=>{e=e.replace(/\\/g,"/"),a=e.slice(e.lastIndexOf("/")+1),a=ft(a).replace(/_/g," "),o+=Et(e,{title:a})}))):At(`Unrecognized playlist file: ${e}`,!0),t(o)}else t(-1)}))}function jt(e,t,a){if(!_e[e])return;const o=_e[e],l=_e.default;A("[data-prop]").forEach((e=>{const t=e.dataset.prop,r=void 0!==o[t]?o[t]:a?l[t]:void 0;void 0!==r&&(e.classList.contains("switch")?e.dataset.active=+r:e==Ce?ga(r):e==N?ca(r):(e.value=r,-1==e.selectedIndex&&(e.selectedIndex=0),Oa(e)))})),qe.setOptions({alphaBars:kt(M),fftSize:K.value,ledBars:kt(X),loRes:kt(Z),lumiBars:kt(Q),maxFreq:ue.value,minFreq:pe.value,mirror:ee.value,outlineBars:kt(le),radial:kt(ce),showFPS:kt(U),showPeaks:kt(ye),showScaleX:kt(ge),showScaleY:kt(me),smoothing:Le.value,spinSpeed:we.value,splitGradient:kt(Ee),stereo:kt(Oe)}),fa([P,F,D,ve,fe,J,de,H,G,te],!0),"demo"==e&&na(!0),t&&b().alert({text:"Settings loaded!"})}function Bt(e){Rt(ne);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,ne.options[ne.options.length]=t;let a=localStorage.getItem("playlists");a&&(a=JSON.parse(a),Object.keys(a).forEach((t=>{const o=new Option(a[t],t);o.dataset.isLocal="1",t==e&&(o.selected=!0),ne.options[ne.options.length]=o}))),fetch("playlists.cfg").then((e=>200==e.status&&(At("Found legacy playlists.cfg file"),e.text()))).then((e=>{if(!1!==e){let t=0;e.split(/[\r\n]+/).forEach((e=>{if("#"!=e.charAt(0)&&""!=e.trim()){let a=e.split(/\|/);2==a.length&&(ne.options[ne.options.length]=new Option(a[0].trim(),a[1].trim()),t++)}})),t?At(`${t} playlists loaded from playlists.cfg`):At("No playlists found in playlists.cfg",!0)}})).catch((e=>{}))}function Kt(e){const t=Qe[je];if(Je.children[e]){Ve=e;const a=Je.children[Ve];return t.src=a.dataset.file,wt(a,t),La(),qt(),!0}return!1}function Wt(){at={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:"custom-gradient-1"};let e=2;for(;Object.keys(Ae).some((e=>e===at.key))&&e<10;)at.key=`custom-gradient-${e}`,e++;ea(),_("#btn-save-gradient").innerText="Add",_("#btn-delete-gradient").style.display="none",location.href="/#gradient-editor"}function Ut(e){if(rt||Ke||Ve>xt()-1)return!0;if(rt=!0,Ve<xt()-1)Ve++;else{if(!kt(he))return rt=!1,!1;Ve=0}return e|=bt(),je=Ue,Ue=0|!je,ua(),e?Qe[je].play().then((()=>{qt()})).catch((e=>{20!=e.code&&(At(e,!0),qt(),Ut(!0))})):qt(),La(),!0}function Gt(e){Ke||(bt()&&!e?(Qe[je].pause(),vt()&&ct.pause()):Qe[je].play().catch((e=>{20!=e.code&&(At(e,!0),Ut(!0))})))}function Jt(){let e=!0;return bt()?Qe[je].currentTime>2?Qe[je].currentTime=0:Ve>0?Vt(Ve-1):e=!1:e=Kt(Ve-1),e}function Vt(e){Kt(e)&&Gt(!0)}function Xt(){const e=_("#enabled_gradients");Rt(e),Object.keys(Ae).forEach((t=>{t.startsWith("custom")?e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${Ae[t].disabled?"":"checked"}>\n                   <a href="#" data-grad="${t}" class="grad-edit-link">${Ae[t].name}</a>\n                </label>`:e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${Ae[t].disabled?"":"checked"}>\n                   ${Ae[t].name}\n                </label>`})),A(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(Ae).reduce(((e,t)=>e+!Ae[t].disabled),0)<2)return b().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;Ae[e.dataset.grad].disabled=!e.checked,Yt(),la(w)}))})),A(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),function(e){if(!Ae[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=Ae[e],a={};a.name=t.name,a.bgColor=t.bgColor,a.dir=t.dir,a.disabled=t.disabled,a.key=e,a.colorStops=[];for(const e of t.colorStops)a.colorStops.push({...e});at=a}(e.target.getAttribute("data-grad")),ea(),_("#btn-save-gradient").innerText="Save",_("#btn-delete-gradient").style.display="block",location.href="/#gradient-editor"}))}))}function Yt(){let e=J.value;Rt(J);for(const e of Object.keys(Ae))Ae[e].disabled||(J.options[J.options.length]=new Option(Ae[e].name,e));""!==e&&(J.value=e,fa(J,!0))}function Zt(e,t){const a=[["","Select preset"],["demo","Demo (random)"],["fullres","Full resolution"],["ledbars","LED bars"],["octave","Octave bands"],..._e.custom?[["custom","Custom"]]:[],...e?[["last","Last session"]]:[],["default","Restore defaults"]];Qt(ie,a),ie.value=t||""}function Qt(e,t,a){const o=e.value,l=!Array.isArray(t[0]);a||Rt(e);for(const a of l?t.filter((e=>!e.disabled)):t){const t=new Option(a.text||a[1],a.value||a[0]);""==t.value&&(t.disabled=!0),e[e.options.length]=t}""!==o&&(e.value=o,-1==e.selectedIndex&&(e.selectedIndex=0),fa(e,!0))}function ea(){if(null==at)throw new Error("Current gradient must be set before editing gradient");const e=_("#grad-color-table");Rt(e),_("#new-gradient-name").value=at.name,_("#new-gradient-horizontal").checked="h"===at.dir;const t=_("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),at.colorStops.forEach(((e,t)=>{!function(e,t){const a=_("#grad-color-table"),o=_("#grad-row-template").cloneNode(!0),l=o.querySelector(".grad-color-picker"),r=o.querySelector(".grad-color-value"),s=o.querySelector(".grad-color-stop"),n=o.querySelector(".grad-add-stop"),i=o.querySelector(".grad-remove-stop");l.value=t.color,r.value=t.color,s.value=t.pos,l.addEventListener("input",(t=>{r.value=t.target.value,at.colorStops[e].color=l.value})),r.addEventListener("input",(t=>{l.value=t.target.value,at.colorStops[e].color=l.value})),s.addEventListener("input",(t=>{at.colorStops[e].pos=parseFloat(t.target.value)})),n.addEventListener("click",(()=>{at.colorStops.splice(e+1,0,{pos:(()=>{if(e===at.colorStops.length-1){const e=at.colorStops[at.colorStops.length-1].pos;return at.colorStops[at.colorStops.length-1].pos=(at.colorStops[at.colorStops.length-2].pos+e)/2,e}return(at.colorStops[e].pos+at.colorStops[e+1].pos)/2})(),color:"#111111"}),ea()})),2===at.colorStops.length?i.setAttribute("disabled","true"):i.addEventListener("click",(()=>{at.colorStops.splice(e,1),ea()})),o.removeAttribute("id"),a.appendChild(o)}(t,at.colorStops[t])})),_("#new-gradient-bkgd").value=at.bgColor}function ta(){if(st>=4)return;const e=Array.from(Je.children).find((e=>e.dataset.retrieve));if(e){st++,delete e.dataset.retrieve;const t=e.dataset.file;g.fetchFromUrl(t,{skipPostHeaders:!0}).then((a=>{a&&(wt(a,e),ya(e),a.common.picture&&a.common.picture.length||function(e){return new Promise((t=>{const a=e.slice(0,e.lastIndexOf("/")+1);if(-1==Ye)t("");else if(void 0!==ot[a])t(a+ot[a]);else{const e=1==Ye?"/getCover/"+a.replace(/\//g,"%2f"):a;fetch(e).then((e=>200==e.status?e.text():null)).then((e=>{let o="";if(e)if(1==Ye)o=e;else{const t=p(e);t.cover&&(o=t.cover)}ot[a]=o,t(a+o)}))}}))}(t).then((t=>{e.dataset.cover=t,ya(e)})))})).catch((e=>{})).finally((()=>{st--,ta()}))}}function aa(e){const t=e.dataset.cover;t.startsWith("blob:")&&URL.revokeObjectURL(t)}function oa(){null!==at&&(Ae[at.key]=at,qe.registerGradient(at.key,at),Yt(),Xt(),la(x),at=null,location.href="/#config")}function la(e){const t=e=>e.filter((e=>e.disabled)).map((e=>e.value));if(e&&e!=E||ra(E,t(Me)),e&&e!=S||ra(S,t(He)),e&&e!=w||ra(w,Object.keys(Ae).filter((e=>Ae[e].disabled))),!e||e==x){const e={};Object.keys(Ae).filter((e=>e.startsWith("custom"))).forEach((t=>e[t]=Ae[t])),ra(x,e)}if(e&&e!=O||ra(O,t(Re)),!e||e==T){let e=[];for(const t of[0,1,2])e.push({min:_(`.min-db[data-preset="${t}"]`).value,max:_(`.max-db[data-preset="${t}"]`).value});ra(T,e)}if(!e||e==$){const e={info:V.value,track:$e.value,end:B.value,covers:ke.checked,count:be.checked};ra($,e)}if(!e||e==I){const e={fftSize:K.value,pipRatio:se.value};ra(I,e)}}function ra(e,t){localStorage.setItem(e,JSON.stringify(t))}function sa(e,t=1){Be=setTimeout((()=>{lt=e,Nt(t)}),200)}function na(e=Ke){if(!bt()&&!e)return;const t=e=>!Re.find((t=>t.value==e)).disabled,a=e=>{e.dataset.active=Lt(),o.push(e)};let o=[];if(te.selectedIndex=Lt(te.options.length),t("alpha")&&a(M),t("nobg")&&(P.selectedIndex=Lt(P.options.length)),t("imgfit")&&(F.selectedIndex=Lt(F.options.length),o.push(F)),t("peaks")&&a(ye),t("leds")&&a(X),t("lumi")&&(Q.dataset.active=P.value[0]>1&&kt(X)?0:Lt(),o.push(Q)),t("line")&&(Y.value=Lt(5)+1,Oa(Y)),t("fill")&&(W.value=Lt(6)/10,Oa(W)),t("barSp")&&(H.selectedIndex=Lt(H.options.length)),t("outline")&&a(le),t("reflex")){const e=fe.options.length-(te.value%10!=0);fe.selectedIndex=Lt(e)}t("radial")&&a(ce),t("spin")&&(we.value=Lt(4),Oa(we),o.push(we)),t("split")&&a(Ee),t("stereo")&&a(Oe),t("mirror")&&(ee.value=Lt(3)-1,o.push(ee)),kt(z)&&(J.selectedIndex=Lt(J.options.length),o.push(J)),o.push(P,fe,te),fa(o,!0)}function ia(e){document.documentElement.style.setProperty("--background-image",e?`url( ${e.replace(/['()]/g,"\\$&")} )`:"none")}function ca(e){N.dataset.value=e,Ge&&(Ge.pan.value=Math.log10(9*Math.abs(e)+1)*Math.sign(e)),N.querySelector(".marker").style.transform=`rotate( ${145*e-90}deg )`}function da(e,t=2,a=1){e?"number"==typeof e?(ze.info=e,ze.timer=Math.round(Math.max(60*t,ze.timer||0)),ze.fade=Math.round(ze.timer/3)*a):(ze.msg=e,2==ze.info&&(ze.info=1),ze.msgTimer=60*t|0):ze={timer:0,msgTimer:0}}function ua(){it.src=Qe[je].dataset.cover,"2"==P.value&&ia(it.src)}function pa(e){V.value=e.info,$e.value=e.track,B.value=e.end,ke.checked=e.covers,be.checked=e.count}function fa(e,t){Array.isArray(e)||(e=[e]);for(const t of e)switch(t){case M:qe.alphaBars=kt(M);break;case P:const e=P.value[0],t="0"!=e&&"1"!=e;let a=P.value.slice(1);qe.overlay=t,qe.showBgColor="0"==e,"4"==e?(ia(),Ie.style.display="",a||(a=tt[Lt(tt.length)]),decodeURIComponent(Ie.src).endsWith(a)||(Ie.src="backgrounds/"+encodeURIComponent(a))):(Ie.style.display="none",t?(e!=k||a||(a=et[Lt(et.length)]),a&&(a="backgrounds/"+encodeURIComponent(a)),ia(a||it.src)):ia());break;case F:const o=F.value,l="6"==o||"7"==o||"8"==o;q.classList.toggle("repeat","2"==o),q.classList.toggle("cover","0"==o||l),q.style.backgroundSize="",Te.style.display=l?"":"none",Te.classList.toggle("rotating","8"==o),Te.classList.toggle("paused","6"==o);break;case D:j.style.background=`rgba(0,0,0,${1-D.value})`;break;case H:qe.barSpace=qe.isLumiBars?1.5:H.value;break;case W:qe.fillAlpha=10==te.value?1:W.value;break;case G:R.style.height=`${G.value}%`;break;case pe:case ue:for(;+ue.value<=+pe.value;)ue.selectedIndex++;qe.setFreqRange(pe.value,ue.value);break;case J:""===J.value&&(J.selectedIndex=0),qe.gradient=J.value;break;case X:qe.ledBars=kt(X);break;case Y:qe.lineWidth=10==te.value?0:Y.value;break;case Z:qe.loRes=kt(Z);break;case Q:qe.lumiBars=kt(Q),fa(H);break;case te:const r=te.value;qe.mode=r<10?r:10,10==r?(qe.lineWidth=0,qe.fillAlpha=1):(qe.lineWidth=Y.value,qe.fillAlpha=W.value),fa(H);break;case ee:qe.mirror=ee.value;break;case le:qe.outlineBars=kt(le);break;case ce:qe.radial=kt(ce),fa(H);break;case de:const s=de.value;Xe&&(Xe=clearInterval(Xe)),s>1&&(Xe=setInterval(na,2500*s));break;case fe:switch(fe.value){case"1":qe.reflexRatio=.4,qe.reflexAlpha=.2;break;case"2":qe.reflexRatio=.5,qe.reflexAlpha=1;break;default:qe.reflexRatio=0}break;case ge:qe.showScaleX=kt(ge);break;case me:qe.showScaleY=kt(me);break;case ve:const n=ve.value;qe.setSensitivity(_(`.min-db[data-preset="${n}"]`).value,_(`.max-db[data-preset="${n}"]`).value);break;case U:qe.showFPS=kt(U);break;case ye:qe.showPeaks=kt(ye);break;case Le:qe.smoothing=Le.value,At("smoothingTimeConstant is "+qe.smoothing);break;case we:qe.spinSpeed=we.value;break;case Ee:qe.splitGradient=kt(Ee);break;case Oe:qe.stereo=kt(Oe)}t&&Ea()}function ha(){Ke=Se.checked,Ke?navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((e=>{We=qe.audioCtx.createMediaStreamSource(e),bt()&&Qe[je].pause(),Ze=ae.checked,Sa(!0),qe.connectInput(We),At("Audio source set to microphone")})).catch((e=>{At(`Could not change audio source - ${e}`,!0),Se.checked=Ke=!1})):(At("Cannot access user microphone",!0),Se.checked=Ke=!1):(We&&(qe.disconnectInput(We),We.mediaStream.getTracks()[0].stop(),We=null,Sa(Ze)),At("Audio source set to built-in player"))}function ga(e){Ce.dataset.value=e,qe.volume=e**2.5,Ce.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function ma(){for(let e=xt()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=Je.replaceChild(Je.children[t],Je.children[e]);Je.insertBefore(a,Je.children[t])}Vt(0)}function va(e=!1){(e?Jt():Ut())||da(`Already at ${e?"first":"last"} track`)}function ba(){Qe[je].pause(),da(),Kt(0)}function ka(e,t=!0){if(0!=xt())if(e){if(e){let a=e;if(!t){a=a.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=a.toLowerCase().replace(/[^a-z0-9]/g,"_");let t=localStorage.getItem("playlists");for(t=t?JSON.parse(t):{};t.hasOwnProperty(a);)a+="_1";t[a]=e,ra("playlists",t),Bt(a)}let o=[];Je.childNodes.forEach((e=>o.push(e.dataset.file))),ra("pl_"+a,o),b().alert({text:"Playlist saved!"})}}else b().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&ka(e,!1)},cancelCallback:()=>{b().alert({text:"Canceled"})}});else b().alert({text:"Queue is empty!"})}function ya(e){for(const t of Qe)t.dataset.file==e.dataset.file&&wt(e,t)}function xa(){2==ze.info?da():da(1+(0|ze.info),+V.value||1/0)}function La(){const e=Je.querySelector(".current"),t=Je.children[Ve];e&&e.classList.remove("current"),t&&(t.classList.add("current"),t.scrollIntoViewIfNeeded())}function Sa(e){void 0!==e?ae.checked=e:e=ae.checked,e?qe.disconnectOutput():qe.connectOutput()}function wa(){const e=mt();_e.custom=e,ra(L,e),b().alert({text:"Custom preset saved!"}),Zt(Array.from(ie.options,(e=>e.value)).includes("last"),"custom")}function Ea(){ra(C,{...mt(),volume:Ce.dataset.value,balance:N.dataset.value})}function Oa(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=e.value)}!function(){let e,t,a,p,v,y,M,j,U,X,Z,Q,le;const ce=e=>{Ut(!0)||(Kt(0),da("Queue ended",10),vt()&&ct.pause())},ge=e=>{e.target.attributes.src&&At("Error loading "+e.target.src,!0)},me=e=>{Qe[je].attributes.src?(vt()&&ct.play(),Qe[je].currentTime<.1&&("1"==de.value?na(!0):kt(z)&&"0"==de.value&&Mt(J)),kt(xe)&&da(1,+$e.value||1/0)):Vt(Ve)};window.addEventListener("error",(e=>At(`Unexpected ${e.error}`,!0))),At("audioMotion.js v21.11 initializing..."),At(`User agent: ${navigator.userAgent}`),_("#version").innerText="21.11";const ye=function(){const e=(e,t)=>{null!==e&&JSON.parse(e).forEach((e=>{const a=t.find((t=>t.value==e));a&&(a.disabled=!0)}))},t=localStorage.getItem(C),a=null!==t;_e.last=JSON.parse(t)||{..._e.default},_e.custom=JSON.parse(localStorage.getItem(L)),Zt(a),e(localStorage.getItem(E),Me),e(localStorage.getItem(S),He);const o=localStorage.getItem(x);if(null!==o){const e=JSON.parse(o);Object.keys(e).forEach((t=>{Ae[t]=e[t]}))}const l=localStorage.getItem(w);null!==l&&JSON.parse(l).forEach((e=>{Ae[e].disabled=!0})),e(localStorage.getItem(O),Re);const r=A(".min-db");for(let e=-60;e>=-110;e-=5)r.forEach((t=>t[t.options.length]=new Option(e)));const s=A(".max-db");for(let e=0;e>=-40;e-=5)s.forEach((t=>t[t.options.length]=new Option(e)));(JSON.parse(localStorage.getItem(T))||Pe).forEach(((e,t)=>{r[t].value=e.min,s[t].value=e.max})),pa({...Ne,...JSON.parse(localStorage.getItem($))||{}});for(let e=10;e<16;e++)K[K.options.length]=new Option(2**e+(13==e?" (Recommended)":""),2**e);var n;return Qt(se,Fe),n={...De,...JSON.parse(localStorage.getItem(I))||{}},K.value=n.fftSize,se.value=n.pipRatio,a}();Je=_("#playlist"),Je.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&(Vt(ht(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),Ve=0,m.ZP.create(Je,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{Ve=ht(Je.querySelector(".current")),0!=e.newIndex||bt()||Kt(0),qt()}}),At(`Instantiating audioMotion-analyzer v${s.Z.version}`),qe=new s.Z(R,{fsElement:q,onCanvasDraw:o=>{const l=Qe[je],r=l.dataset,s=l.duration-l.currentTime,n=+B.value,i=P.value[0],c=F.value,d=kt(oe),u=qe.pixelRatio;if(s<.1&&Ut(!0),n>0&&s<=n&&kt(xe)&&!ze.info&&bt()&&da(1,s,-1),!("3"!=c&&"4"!=c&&"5"!=c||"2"!=i&&i!=k)){let e;if("3"==c)e=(70*qe.getEnergy()|0)-25;else{const t=l.currentTime/l.duration;e=100*("4"==c?t:1-t)}q.style.backgroundSize=`auto ${100+e}%`}if(re.width|=0,(ze.timer||ze.msgTimer)<1)return;const f=(e,t,a,o)=>{d?(nt.strokeText(e,t,a,o),nt.fillText(e,t,a,o)):(nt.shadowOffsetX=nt.shadowOffsetY=3*u,nt.fillText(e,t,a,o),nt.shadowOffsetX=nt.shadowOffsetY=0)};if(nt.lineWidth=4*u,nt.lineJoin="round",nt.font=Q,nt.textAlign="center",nt.fillStyle="#fff",nt.strokeStyle=nt.shadowColor="#000",ze.msgTimer>0&&2!=ze.info&&(nt.globalAlpha=ze.msgTimer<60?ze.msgTimer/60:1,f(ze.msg,a,v),ze.msgTimer--),ze.timer>0){if(ze.fade<0){const e=Math.abs(ze.fade),t=3*e-ze.timer;nt.globalAlpha=t<e?t/e:1}else nt.globalAlpha=ze.timer<ze.fade?ze.timer/ze.fade:1;if(2==ze.info&&(f("Gradient: "+Ae[J.value].name,a,v,X),f(`Auto gradient is ${yt(z)}`,a,y),nt.textAlign="left",f(gt(te),e,v,X),f(`Random mode: ${gt(de)}`,e,y,X),nt.textAlign="right",f(gt(ve).toUpperCase()+" sensitivity",p,v,X),f(`Repeat is ${yt(he)}`,p,y,X)),Ke)nt.textAlign="left",nt.font=le,f("MIC source",e,j,Z);else{nt.textAlign="right",f(r.codec,p,M),f(r.quality,p,M+e);const a=xt();a&&be.checked&&f(`Track ${(""+(Ve+1)).padStart((""+a).length,"0")} of ${a}`,p,M-e),nt.textAlign="left",f(r.artist.toUpperCase(),e,M,Z),nt.font=`italic ${Q}`,f(r.album,e,U,Z),nt.font=le,f(l.src?r.title:"No song loaded",e,j,Z),(l.duration||r.duration)&&(r.duration||(r.duration=l.duration===1/0?"LIVE":ut(l.duration),Je.children[Ve]&&(Je.children[Ve].dataset.duration=r.duration)),nt.textAlign="right",f(ut(l.currentTime)+" / "+r.duration,p,U)),it.width&&ke.checked&&nt.drawImage(it,e,M-1.3*t,t,t)}--ze.timer<1&&(ze.info=ze.fade=0)}},onCanvasResize:(o,l)=>{let r;const s=l.pixelRatio,n=re.width=q.clientWidth*s,i=re.height=q.clientHeight*s;switch(o){case"create":At(`Display resolution: ${l.fsWidth} x ${l.fsHeight} px (pixelRatio: ${window.devicePixelRatio})`),r="Canvas created";break;case"lores":r=`Lo-res ${l.loRes?"ON":"OFF"} (pixelRatio = ${s})`;break;case"fschange":r=(l.isFullscreen?"Enter":"Exit")+"ed fullscreen";break;case"resize":r="Window resized";break;case"user":r=(vt()?"Resized for":"Closed")+" PIP"}At(`${r||o}. Canvas size is ${l.canvas.width} x ${l.canvas.height} px`),e=Math.min(n,i)/17,t=3*e,a=n/2,p=n-e,v=1.4*e,y=1.8*v,X=n/3-e,M=i-4*e,j=i-2.8*e,U=i-1.6*e,Z=n-7*e,Q=`bold ${.7*e}px sans-serif`,le=`bold ${e}px sans-serif`}});const Ee=qe.audioCtx;Ee.createStereoPanner&&(Ge=Ee.createStereoPanner(),qe.connectInput(Ge)),je=0,Ue=1;for(const e of[0,1])Qe[e]=_(`#player${e}`),Tt(e),Qe[e].addEventListener("play",me),Qe[e].addEventListener("ended",ce),Qe[e].addEventListener("error",ge),Ge?Ee.createMediaElementSource(Qe[e]).connect(Ge):qe.connectInput(Qe[e]);!function(){const e=(e,t,a,o,l)=>{a.forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),A(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return b().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;a.find((t=>t.value==e.dataset.option)).disabled=!e.checked,Qt(o,a),la(l)}))}))};e(_("#enabled_modes"),"enabledMode",Me,te,E),e(_("#enabled_bgfit"),"enabledMode",He,F,S);const t=_("#enabled_gradients");Object.keys(Ae).forEach((e=>{t.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${Ae[e].disabled?"":"checked"}> ${Ae[e].name}</label>`})),Xt();const a=_("#random_properties");Re.forEach((e=>{a.innerHTML+=`<label><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),A(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{Re.find((t=>t.value==e.value)).disabled=!e.checked,la(O)}))})),A("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{_(`.min-db[data-preset="${e.dataset.preset}"]`).value=Pe[e.dataset.preset].min,_(`.max-db[data-preset="${e.dataset.preset}"]`).value=Pe[e.dataset.preset].max,e.dataset.preset==ve.value&&fa(ve),la(T)})):e.addEventListener("change",(()=>{e.dataset.preset==ve.value&&fa(ve),la(T)}))}));for(const e of[V,$e,B,ke,be])e.addEventListener("change",(()=>la($)));_("#reset_osd").addEventListener("click",(()=>{pa(Ne),la($)})),[K,se].forEach((e=>{e.addEventListener("change",(()=>{e==se&&vt()&&(qe.width=qe.height*se.value),e==K&&(qe.fftSize=K.value,At("FFT size is "+qe.fftSize+" samples")),la(I)}))}))}(),Qt(te,Me);for(const e of[20,30,40,50,60,100,250,500,1e3,2e3])pe[pe.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,22e3])ue[ue.options.length]=new Option(e/1e3+"kHz",e);Qt(ve,[["0","Low"],["1","Normal"],["2","High"]]),Qt(H,[["1.5","Legacy"],["0.1","Narrow"],["0.25","Regular"],["0.5","Wide"],["0.75","Extra wide"]]),Qt(de,[["0","Off"],["1","On track change"],["2","5 seconds"],["6","15 seconds"],["12","30 seconds"],["24","1 minute"],["48","2 minutes"],["120","5 minutes"]]),Qt(fe,[["0","Off"],["1","On"],["2","Mirrored"]]),Qt(P,[["2","Album cover"],["1","Black"],["0","Gradient default"]]),Qt(F,He),Qt(ee,[["0","Off"],["-1","Left"],["1","Right"]]);const Oe=fetch("backgrounds").then((e=>e.text())).then((e=>{const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,a=/\.(mp4|webm|mov)$/i;for(const{file:o}of u(e))o.match(t)?et.push(o):o.match(a)&&tt.push(o);const o=et.length,l=tt.length,r=et.map((e=>[k+e,"ðŸ–¼ï¸ "+ft(e)])).concat(tt.map((e=>["4"+e,"ðŸŽ¬ "+ft(e)]))).slice(0,20);l&&r.splice(0,0,["4","Random video"]),o&&r.splice(0,0,[k,"Random image"]),At("Found "+(o+l==0?"no media":o+" image files and "+l+" video")+" files in the backgrounds folder"),Qt(P,r,!0)})).catch((e=>{})),Ie=(e,t,a,o=1)=>{e.min=t,e.max=a,e.step=o};Ie(D,.1,1,.1),Ie(Y,1,5),Ie(W,0,.5,.1),Ie(Le,0,.9,.1),Ie(we,0,3,1),Ie(G,25,100,5),function(){const e=_("#toggle_settings");e.addEventListener("click",(()=>{_("#settings").classList.toggle("active",e.classList.toggle("active"))})),_(".settings-close").addEventListener("click",(()=>e.click()));const t=_("#toggle_console");let a,o,l;t.addEventListener("click",(()=>{_("#console").classList.toggle("active",t.classList.toggle("active")),t.classList.remove("warning"),At()})),_("#console-close").addEventListener("click",(()=>t.click())),_("#console-clear").addEventListener("click",(()=>At("Console cleared.",!1,!0))),A(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,fa(e,!0)}))})),A("[data-prop]").forEach((e=>{e.addEventListener("change",(()=>{fa(e,!0),Oa(e)}))})),Se.addEventListener("change",ha),ae.addEventListener("change",(()=>Sa())),[Ce,N].forEach((e=>{e.addEventListener("wheel",(t=>{if(t.preventDefault(),a)return;a=setTimeout((()=>a=!1),50);const o=Math.sign(t.deltaY||0);e==Ce?Ct(o):$t(o)}))})),N.addEventListener("dblclick",(()=>{$t(0)})),_("#btn_play").addEventListener("click",(()=>Gt())),_("#btn_stop").addEventListener("click",ba),_("#btn_shuf").addEventListener("click",ma),_("#btn_prev").addEventListener("mousedown",(()=>sa("m",-1))),_("#btn_prev").addEventListener("click",(e=>{Ht()||va(!0)})),_("#btn_next").addEventListener("mousedown",(()=>sa("m"))),_("#btn_next").addEventListener("click",(()=>{Ht()||va()})),_("#load_preset").addEventListener("click",(()=>{ie.value&&(At(`Loading preset '${gt(ie)}'`),jt(ie.value,!0))})),_("#btn_save").addEventListener("click",wa),_("#btn_fullscreen").addEventListener("click",Dt),_("#load_playlist").addEventListener("click",(()=>{zt(ne.value).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;b().alert({text:t,time:5})}))})),_("#save_playlist").addEventListener("click",(()=>{return e=ne.selectedIndex,void(""==ne[e].value?ka():ne[e].dataset.isLocal?b().confirm({text:`Overwrite "${ne[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{ka(ne[e].value)},cancelCallback:()=>{b().alert({text:"Canceled"})}}):b().alert({text:'This is a server playlist which cannot be overwritten.<br>Click "Save as..." to create a new local playlist.',time:5}));var e})),_("#create_playlist").addEventListener("click",(()=>ka())),_("#delete_playlist").addEventListener("click",(()=>{return e=ne.selectedIndex,void(ne[e].dataset.isLocal?b().confirm({text:`Do you really want to DELETE the "${ne[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:()=>{const t=ne[e].value;let a=localStorage.getItem("playlists");a&&(a=JSON.parse(a),delete a[t],ra("playlists",a)),localStorage.removeItem(`pl_${t}`),b().alert({text:"Playlist deleted"}),Bt()},cancelCallback:()=>{b().alert({text:"Canceled"})}}):ne[e].value&&b().alert({text:"Cannot delete a server playlist!"}));var e})),_("#btn_clear").addEventListener("click",_t),re.addEventListener("click",(()=>xa())),_("#local_file").addEventListener("change",(e=>function(e){const t=e.files[0];if(t){Tt();const e=Qe[je];e.src=URL.createObjectURL(t),e.play(),e.onload=()=>URL.revokeObjectURL(e.src),g.parseBlob(t).then((t=>wt(t,e))).catch((e=>{}))}}(e.target))),_("#btn_load_url").addEventListener("click",(()=>{b().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&Ot(e,!0)}})}));const r=_("#btn_pip");document.pictureInPictureEnabled?r.addEventListener("click",(async()=>{if(ct!==document.pictureInPictureElement){const e=qe.canvas.captureStream();o=e.getTracks()[0],ct.muted=!0,ct.srcObject=e,await ct.play(),ct.requestPictureInPicture()}else document.exitPictureInPicture()})):r.classList.add("disabled");const s=((e,t=300)=>{let a;return(...o)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,o)),t)}})((()=>qe.setCanvasSize(l.width,l.height)));ct.addEventListener("enterpictureinpicture",(e=>{l=e.pictureInPictureWindow,q.classList.add("pip"),r.classList.add("active"),qe.setCanvasSize(l.height*se.value,l.height),l.addEventListener("resize",s)})),ct.addEventListener("leavepictureinpicture",(()=>{l.removeEventListener("resize",s),ct.pause(),o.stop(),ct.srcObject=o=null,r.classList.remove("active"),q.classList.remove("pip"),qe.setCanvasSize()}));const n=navigator.mediaSession;n&&(n.setActionHandler("play",(()=>Gt())),n.setActionHandler("pause",(()=>Gt())),n.setActionHandler("previoustrack",(()=>Jt())),n.setActionHandler("nexttrack",(()=>Ut()))),_("#add-gradient").addEventListener("click",Wt),_("#btn-save-gradient").addEventListener("click",oa),_("#btn-delete-gradient").addEventListener("click",Pt),_("#new-gradient-bkgd").addEventListener("input",(e=>{at.bgColor=e.target.value})),_("#new-gradient-name").addEventListener("input",(e=>{at.name=e.target.value})),_("#new-gradient-horizontal").addEventListener("input",(e=>{at.dir=e.target.checked?"h":void 0}))}(),da(),Object.keys(Ae).forEach((e=>{Ae[e].colorStops&&qe.registerGradient(e,{bgColor:Ae[e].bgColor,colorStops:Ae[e].colorStops})})),Yt(),ha(),Bt();const Te=function(e,t={}){var a;return(o=document.createElement("ul")).className="breadcrumb",e.append(o),(l=document.createElement("ul")).className="filelist",e.append(l),a=setTimeout((()=>{o.innerHTML="Waiting for server..."}),5e3),o.innerHTML="Initializing... please wait...",o.addEventListener("click",(function(e){e.target&&"LI"==e.target.nodeName&&function(e){for(var t;e>0;)t=i.pop(),e--;d(void 0,t&&t.scrollTop)}(e.target.dataset.depth)})),l.addEventListener("click",(function(e){e.target&&"LI"==e.target.nodeName&&("dir"==e.target.dataset.type?d(e.target.dataset.path):"mount"==e.target.dataset.type&&(i=[],d(e.target.dataset.path)))})),"function"==typeof t.dblClick&&(r=t.dblClick),l.addEventListener("dblclick",(function(e){e.target&&"LI"==e.target.nodeName&&r&&["file","list"].includes(e.target.dataset.type)&&r(f(e.target.dataset.path),e)})),new Promise((e=>{fetch("/serverInfo").then((e=>e.text())).then((async r=>{let s;clearTimeout(a),r.startsWith("audioMotion")?(c=!0,s=1):s=0,n=[t.rootPath||"/music"],!1===await d(n[0])&&(o.innerHTML=`Cannot access media folder (${n[0]}) on server!`,l.innerHTML="",s=-1),e([s,l,s?r:"Standard web server"])})).catch((t=>{clearTimeout(a),o.innerHTML="No file server found.",e([-1,l])}))}))}(_("#file_explorer"),{dblClick:(e,t)=>{St([{file:e}],!0),t.target.classList.remove("selected","sortable-chosen")}}).then((([e,t,a])=>{const o=_("#btn_add_selected"),l=_("#btn_add_folder");Ye=e,-1==e?(At("No server found. File explorer will not be available.",!0),o.disabled=!0,l.disabled=!0):(At(`${a} detected`),m.ZP.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{"playlist"==e.to.id&&(e.items.length?e.items:[e.item]).forEach((e=>{Ot(f(e.dataset.path)),e.remove()}))}}),o.addEventListener("mousedown",(()=>St(h(".selected")))),l.addEventListener("click",(()=>St(h()))))}));window.addEventListener("keydown",Ft),window.addEventListener("keyup",Ft),b().setOptions({positions:{alert:"bottom"}}),Promise.all([Oe,Te]).then((()=>{At(`Loading ${ye?"last session":"default"} settings`),jt("last",!1,!0),At(`AudioContext sample rate is ${Ee.sampleRate}Hz; Latency is ${1e3*((Ee.outputLatency||0)+Ee.baseLatency)|0}ms`),At("Initialization complete!")}))}()},7379:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),o=parseInt(a.getPropertyValue("border-top-width")),l=parseInt(a.getPropertyValue("border-left-width")),r=this.offsetTop-t.offsetTop<t.scrollTop,s=this.offsetTop-t.offsetTop+this.clientHeight-o>t.scrollTop+t.clientHeight,n=this.offsetLeft-t.offsetLeft<t.scrollLeft,i=this.offsetLeft-t.offsetLeft+this.clientWidth-l>t.scrollLeft+t.clientWidth,c=r&&!s;(r||s)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-o+this.clientHeight/2),(n||i)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-l+this.clientWidth/2),(r||s||n||i)&&!e&&this.scrollIntoView(c)})},2361:()=>{},4616:()=>{}},a={};function o(e){var l=a[e];if(void 0!==l)return l.exports;var r=a[e]={exports:{}};return t[e].call(r.exports,r,r.exports,o),r.exports}o.m=t,e=[],o.O=(t,a,l,r)=>{if(!a){var s=1/0;for(d=0;d<e.length;d++){for(var[a,l,r]=e[d],n=!0,i=0;i<a.length;i++)(!1&r||s>=r)&&Object.keys(o.O).every((e=>o.O[e](a[i])))?a.splice(i--,1):(n=!1,r<s&&(s=r));if(n){e.splice(d--,1);var c=l();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,l,r]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};o.O.j=t=>0===e[t];var t=(t,a)=>{var l,r,[s,n,i]=a,c=0;if(s.some((t=>0!==e[t]))){for(l in n)o.o(n,l)&&(o.m[l]=n[l]);if(i)var d=i(o)}for(t&&t(a);c<s.length;c++)r=s[c],o.o(e,r)&&e[r]&&e[r][0](),e[s[c]]=0;return o.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var l=o.O(void 0,[216],(()=>o(8169)));l=o.O(l)})();