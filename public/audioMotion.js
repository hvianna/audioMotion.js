/*! For license information please see audioMotion.js.LICENSE.txt */
(()=>{var e,t={2301:(e,t,a)=>{"use strict";const o=JSON.parse('{"i8":"23.4.0-beta.0"}');var n=a(8841);const l="electron"in window,i=l&&/Windows/.test(navigator.userAgent);let r,s,c,d,u=[],p=[],f=!1;function h(e,t){let a,o;return e&&(".."==e?a=p.pop():p.push({dir:e,scrollTop:s.scrollTop})),s.innerHTML="<li>Loading...</li>",o=b(),new Promise((e=>{fetch(o).then((e=>200==e.status&&(f?e.json():e.text()))).then((o=>{!1!==o&&(f||(o=m(o)),function(e,t){r.innerHTML="",s.innerHTML="",p.forEach((({dir:e},t)=>{r.innerHTML+=`<li data-depth="${p.length-t-1}">${e}</li> ${i?"\\":"/"==e?"":"/"} `})),u.forEach((e=>{s.innerHTML+=`<li data-type="mount" data-path="${e}">[ ${e} ]</li>`})),p.length>1&&(s.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e&&(e.dirs&&e.dirs.forEach((e=>{s.innerHTML+=`<li data-type="dir" data-path="${e}">${e}</li>`})),e.files&&e.files.forEach((e=>{s.innerHTML+=`<li data-type="${null!==e.match(/\.(m3u|m3u8)$/)?"list":"file"}" data-path="${e}">${e}</li>`})),s.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e.cover?`, url('${b(e.cover)}')`:"")),s.scrollTop=t||0}(o,t||a&&a.scrollTop),c&&c(p),e(!0)),e(!1)})).catch((()=>e(!1)))}))}function b(e,t){let a="";return p.forEach((({dir:e})=>{a+=e+("/"==e?"":"/")})),e&&(a+=e),a=a.replace(/#/g,"%23"),l&&(a=a.replace(/\//g,"%2f"),t||(a=(e?"/getFile/":"/getDir/")+a)),a}function v(e="li"){let t=[];return s.querySelectorAll(e).forEach((e=>{["file","list"].includes(e.dataset.type)&&t.push({file:b(e.dataset.path),type:e.dataset.type})})),t}function g(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const[,t,o]=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i);a.push({uri:t,file:o})}return a}function m(e){const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,a=/\.(mp3|flac|m4a|aac|ogg|wav|m3u|m3u8)$/i;let o=[],n=[],l=[];const i=(e,a)=>{const o=new RegExp(`${a}.*${t.source}`,"i");return e.find((e=>e.match(o)))};for(const{uri:i,file:r}of g(e))"/"==i.substring(i.length-1)?r.match(/parent directory/i)||("/"==r.substring(r.length-1)?n.push(r.substring(0,r.length-1)):n.push(r)):r.match(t)?l.push(r):r.match(a)&&o.push(r);const r=i(l,"cover")||i(l,"folder")||i(l,"front")||l[0],s=new Intl.Collator;return{cover:r,dirs:n.sort(s.compare),files:o.sort(s.compare)}}var k=a(2463),y=(a(7379),a(1474)),x=a(3681),L=a.n(x);y.ZP.mount(new y.LJ);const w="electron"in window,E=w&&/Windows/.test(navigator.userAgent),S="/getFile/",$="/getCover/",C="/savePlist/",T=w?"/getBackground":"backgrounds",O=4,I=1e3,A="0",_="1",R="2",M="3",P="4",N="0",D="2",H="6",B="7",F="8",q={album:"",artist:"",codec:"",cover:"",duration:"",file:"",quality:"",title:""},j="custom-grads",z="custom-preset",W="disabled-bgfit",K="disabled-gradients",U="disabled-modes",G="disabled-properties",V="display-options",Y="general-settings",X="last-config",J="last-dir",Z="playlists",Q="sensitivity-presets",ee=document.querySelector.bind(document),te=document.querySelectorAll.bind(document),ae=ee("#alpha_bars"),oe=ee("#analyzer"),ne=ee("#ansi_bands"),le=ee("#background"),ie=ee("#balance"),re=ee("#bar_space"),se=ee("#bg_img_dim"),ce=ee("#bg_img_fit"),de=ee("#channel_layout"),ue=ee("#bg_container"),pe=ee("#cycle_grad"),fe=ee("#bg_dim"),he=ee("#end_timeout"),be=ee("#fft_size"),ve=ee("#fill_alpha"),ge=ee("#fps"),me=ee("#freq_scale"),ke=ee("#fs_height"),ye=ee("#gradient"),xe=ee("#gradientRight"),Le=ee("#info_timeout"),we=ee("#led_display"),Ee=ee("#linear_amplitude"),Se=ee("#line_width"),$e=ee("#loaded_playlist"),Ce=ee("#lo_res"),Te=ee("#lumi_bars"),Oe=ee("#mirror"),Ie=ee("#mode"),Ae=ee("#mute"),_e=ee("#no_shadow"),Re=ee("#note_labels"),Me=ee("#outline"),Pe=ee("#osd"),Ne=ee("#pip_ratio"),De=ee("#playlists"),He=ee("#preset"),Be=ee("#radial"),Fe=ee("#random_mode"),qe=ee("#freq_max"),je=ee("#freq_min"),ze=ee("#reflex"),We=ee("#repeat"),Ke=ee("#save_dir"),Ue=ee("#scaleX"),Ge=ee("#scaleY"),Ve=ee("#sensitivity"),Ye=ee("#show_count"),Xe=ee("#show_cover"),Je=ee("#show_peaks"),Ze=ee("#show_song"),Qe=ee("#smoothing"),et=ee("#source"),tt=ee("#spin"),at=ee("#split_grad"),ot=ee("#track_timeout"),nt=ee("#video"),lt=ee("#volume"),it=ee("#warp"),rt=ee("#weighting"),st={default:{alphaBars:0,ansiBands:0,background:0,balance:0,barSpace:.1,bgImageDim:.5,bgImageFit:1,channelLayout:"single",cycleGrad:1,fillAlpha:.1,freqMax:22e3,freqMin:20,freqScale:"log",gradient:"prism",gradientRight:"prism",ledDisplay:0,linearAmpl:0,lineWidth:2,loRes:0,lumiBars:0,mirror:0,mode:0,noShadow:1,noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:0,repeat:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:1,showSong:1,spin:2,splitGrad:0,volume:1,weighting:""},fullres:{freqMax:22e3,freqMin:20,mode:0,radial:0,randomMode:0,reflex:0},octave:{barSpace:.1,ledDisplay:0,lumiBars:0,mode:3,radial:0,randomMode:0,reflex:0},ledbars:{background:0,barSpace:.5,ledDisplay:1,lumiBars:0,mode:3,radial:0,randomMode:0,reflex:0},demo:{cycleGrad:1,randomMode:6}},ct={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",disabled:!1},rainbow:{name:"Rainbow",disabled:!1},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},dt=[{value:"0",text:"Discrete frequencies",disabled:!1},{value:"10",text:"Area graph",disabled:!1},{value:"101",text:"Line graph",disabled:!1},{value:"8",text:"Full octave bands",disabled:!1},{value:"7",text:"Half octave bands",disabled:!1},{value:"6",text:"1/3rd octave bands",disabled:!1},{value:"5",text:"1/4th octave bands",disabled:!1},{value:"4",text:"1/6th octave bands",disabled:!1},{value:"3",text:"1/8th octave bands",disabled:!1},{value:"2",text:"1/12th octave bands",disabled:!1},{value:"1",text:"1/24th octave bands",disabled:!1}],ut=[["single","Single channel"],["dual-vertical","Dual / Vertical"],["dual-combined","Dual / Combined"]],pt=[{value:"alpha",text:"Alpha",disabled:!1},{value:"nobg",text:"Background",disabled:!1},{value:"barSp",text:"Bar Spacing",disabled:!1},{value:"imgfit",text:"BG Image Fit",disabled:!1},{value:"stereo",text:"Channel Layout",disabled:!1},{value:"fill",text:"Fill Opacity",disabled:!1},{value:"leds",text:"LEDs",disabled:!1},{value:"line",text:"Line Width",disabled:!1},{value:"lumi",text:"Lumi",disabled:!1},{value:"mirror",text:"Mirror",disabled:!1},{value:"outline",text:"Outline",disabled:!1},{value:"peaks",text:"Peaks",disabled:!1},{value:"radial",text:"Radial",disabled:!1},{value:"spin",text:"Radial Spin",disabled:!1},{value:"reflex",text:"Reflex",disabled:!1},{value:"split",text:"Split",disabled:!1}],ft=[{min:-70,max:-20,boost:1},{min:-85,max:-25,boost:1.6},{min:-100,max:-30,boost:2.4}],ht={info:5,track:10,end:0,covers:!0,count:!0},bt=[{value:N,text:"Adjust",disabled:!1},{value:"1",text:"Center",disabled:!1},{value:"3",text:"Pulse",disabled:!1},{value:D,text:"Repeat",disabled:!1},{value:H,text:"Warp",disabled:!1},{value:B,text:"Warp Drive",disabled:!1},{value:F,text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],vt={fftSize:8192,smoothing:.5,pipRatio:2.35,fsHeight:100,saveDir:!0},gt=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]];let mt,kt,yt,xt,Lt,wt,Et,St,$t,Ct,Tt,Ot,It,At=[],_t=[],Rt=[],Mt=null,Pt={},Nt=!1,Dt=!1,Ht=0;const Bt=Pe.getContext("2d"),Ft=new Image,qt=document.createElement("video"),jt=(e,t)=>e.replace(/(%2f|\/)/g,t&&E?"\\":"/"),zt=e=>e.replace(/\//g,"%2f"),Wt=e=>Math.round(100*e)/100,Kt=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},Ut=e=>e[e.selectedIndex].text,Gt=e=>({alphaBars:+Jt(ae),ansiBands:+Jt(ne),background:le.value,barSpace:re.value,bgImageDim:se.value,bgImageFit:ce.value,channelLayout:de.value,cycleGrad:+Jt(pe),fillAlpha:ve.value,freqMax:qe.value,freqMin:je.value,freqScale:me.value,gradient:ye.value,gradientRight:xe.value,ledDisplay:+Jt(we),linearAmpl:+Jt(Ee),lineWidth:Se.value,loRes:+Jt(Ce),lumiBars:+Jt(Te),mirror:Oe.value,mode:Ie.value,noShadow:+Jt(_e),noteLabels:+Jt(Re),outlineBars:+Jt(Me),radial:+Jt(Be),randomMode:Fe.value,reflex:ze.value,repeat:+Jt(We),sensitivity:Ve.value,showFPS:+Jt(ge),showPeaks:+Jt(Je),showScaleX:+Jt(Ue),showScaleY:+Jt(Ge),showSong:+Jt(Ze),spin:tt.value,splitGrad:+Jt(at),weighting:rt.value}),Vt=e=>e.startsWith("http"),Yt=e=>ue.classList.contains("pip"),Xt=(e=At[yt])=>e&&e.currentTime>0&&!e.paused&&!e.ended,Jt=e=>"1"==e.dataset.active,Zt=e=>e.replace(/\\/g,"/"),Qt=e=>Jt(e)?"ON":"OFF",ea=e=>{const t=la(e),a=t.lastIndexOf("/")+1,o=t.slice(0,a),n=t.slice(a),l=n.lastIndexOf("."),i=l>=0?n.slice(0,l):n,r=l>=0?n.slice(l+1).toLowerCase():"";return{path:o,fileName:n,baseName:i,extension:r}},ta=e=>{e=e.replace(/_/g," ");const[,,t,a,,o,n]=e.match(/(^(-?\d+)([,\.\-\s]))?((.*?)\s+-\s+)?(.*)/);return{artist:o,title:n,duration:","==a?ia(t):""}},aa=e=>(w&&!Vt(e)&&(e.startsWith(S)&&(e=e.slice(S.length)),e=S+zt(e)),e),oa=e=>$t.children.length,na=(e=2)=>Math.random()*e|0,la=e=>{const t=new RegExp(`^${S}`);return Zt(jt(e.replace(t,"")))},ia=e=>{if(e==1/0||-1==e)return"LIVE";let t="",a="";return e>=3600&&(t=(e/3600|0)+":",e%=3600,a="0"),t+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),t},ra=(e,t,a,o=1)=>{e.min=t,e.max=a,e.step=o};function sa(e,t=!1){const a=e.map((e=>ua(e.file,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${oa()<I?"":". Queue is full!"}`;L().alert({text:a,time:5})}))}function ca(e,t){const a=t.dataset,o=e.dataset,n=e.common,l=e.format;if(o)Object.assign(a,o);else if(a.artist=n.artist||a.artist,a.title=n.title||a.title,a.album=n.album?n.album+(n.year?" ("+n.year+")":""):"",a.codec=l?l.codec||l.container:a.codec,l&&l.bitsPerSample?a.quality=(l.sampleRate/1e3|0)+"KHz / "+l.bitsPerSample+"bits":l.bitrate?a.quality=(l.bitrate/1e3|0)+"K "+(l.codecProfile||""):a.quality="",l&&l.duration?a.duration=ia(l.duration):a.duration="",n.picture&&n.picture.length){const e=new Blob([n.picture[0].data],{type:n.picture[0].format});a.cover=URL.createObjectURL(e)}t==At[yt]&&Za()}function da(e,t={}){if(oa()>=I)return 0;e=Zt(e);const a=jt(e).split("/").pop(),o=a.split(".").pop(),n=document.createElement("li"),l=n.dataset;return Object.assign(l,q),l.artist=t.artist||"",l.title=t.title||a.replace(/%23/g,"#")||e.slice(e.lastIndexOf("//")+2),l.duration=t.duration||"",l.codec=o!==a?o.toUpperCase():"",e=e.replace(/#/g,"%23"),l.file=e,$t.appendChild(n),1!=oa()||Xt()||Ia(0),Ct>oa()-3&&$a(),l.retrieve=1,qa(),1}function ua(e,t=!1){let a;return a=["m3u","m3u8"].includes(ea(e).extension)?Ca(e):new Promise((t=>t(da(e,ta(ea(e).baseName))))),a.then((e=>{t&&!Xt()&&e>0&&Pa(oa()-e)})),a}function pa(e){let t=e?Wt((+ie.dataset.value||0)+.1*e):0;t<-1?t=-1:t>1&&(t=1),Xa(t),Ja("Balance: "+(0==t?"CENTER":100*Math.abs(t)+"% "+(t>0?"Right":"Left"))),ho()}function fa(e){const t=+ke.value;(1==e&&t<+ke.max||-1==e&&t>+ke.min)&&(ke.value=t+ke.step*e,ha(ke)),Ja(`Analyzer height: ${ke.value}%`)}function ha(e){switch(e){case Ne:Yt()&&(mt.width=mt.height*Ne.value);break;case be:mt.fftSize=be.value,ga("FFT size is "+mt.fftSize+" samples");break;case Qe:mt.smoothing=Qe.value,ga("smoothingTimeConstant is "+mt.smoothing);break;case ke:oe.style.height=`${ke.value}%`;break;case Ke:Ke.checked?Ua(J,p):localStorage.removeItem(J)}Ka(Y)}function ba(e){let t=Wt((+lt.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),oo(t),Ja("Volume: "+20*t),ho()}function va(e=yt){const t=At[e],a=t.dataset;t.removeAttribute("src"),Object.assign(a,q),t.load(),e==yt&&Za()}function ga(e,t,a){const o=ee("#console-content"),n=new Date,l=n.toLocaleTimeString([],{hour12:!1})+"."+String(n.getMilliseconds()).padStart(3,"0");a&&(o.innerHTML=""),t&&ee("#toggle_console").classList.add("warning"),e&&(o.innerHTML+=`<div ${t?'class="error"':""}>${l} ${e}</div>`),o.scrollTop=o.scrollHeight}function ma(e,t){const a=e.selectedIndex+(t?-1:1);a<0?e.selectedIndex=e.options.length-1:a>=e.options.length?e.selectedIndex=0:e.selectedIndex=a,to(e,!0)}function ka(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function ya(){Mt&&Mt.key&&(delete ct[Mt.key],0===Object.keys(ct).filter((e=>!ct[e].disabled)).length&&(ct[Object.keys(ct)[0]].disabled=!1),Da(),Na(),Ka(j),Ka(K),Mt=null,location.href="/#config")}function xa(e=1){const t=At[yt];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),Ja(1),t.currentTime=a}"m"==Nt&&Ga("m",e)}function La(){return clearTimeout(xt),!!Nt&&(Nt=!1,!0)}async function wa(){Yt()&&await document.exitPictureInPicture(),mt.toggleFullscreen(),document.activeElement.blur()}function Ea(e){if("BODY"!=e.target.tagName||e.altKey||e.ctrlKey)return;const t=e.shiftKey;if("keydown"==e.type)switch(e.code){case"ArrowUp":t?fa(1):ba(1);break;case"ArrowDown":t?fa(-1):ba(-1);break;case"ArrowLeft":t?pa(-1):Nt?(Ja("Rewind",1),xa(-1)):Ga("k",-1);break;case"ArrowRight":t?pa(1):Nt?(Ja("Fast forward",1),xa()):Ga("k");break;default:return}else switch(e.code){case"Delete":case"Backspace":$t.querySelectorAll(".selected").forEach((e=>{ja(e),e.remove()}));const e=Kt($t.querySelector(".current"));void 0!==e?Ct=e:Ct>oa()-1?Ct=oa()-1:Ct--,oa()?$a():(va(Et),Xt()||va());break;case"Space":Ja(Xt()?"Pause":"Play",1),Ra();break;case"ArrowLeft":case"KeyJ":La()||t||(Ja("Previous track",1),lo(!0));break;case"KeyG":ma(ye,t),Ja("Gradient: "+ct[ye.value].name);break;case"ArrowRight":case"KeyK":La()||t||(Ja("Next track",1),lo());break;case"KeyA":Jt(pe)||t?Fe.selectedIndex==Fe.options.length-1&&!t||0==Fe.selectedIndex&&Jt(pe)&&t?(pe.dataset.active="0",Fe.value="0",Ja("Auto gradient OFF / Random mode OFF")):(ma(Fe,t),Ja("Random mode: "+Ut(Fe))):(pe.dataset.active="1",Ja("Auto gradient ON")),to(Fe,!0);break;case"KeyB":ma(t?ce:le);const a=le.value[0];Ja("Background: "+Ut(le)+(a>1&&a<7?` (${Ut(ce)})`:""));break;case"KeyC":Be.click(),Ja("Radial "+Qt(Be));break;case"KeyD":co();break;case"KeyE":oa()>0&&(no(),Ja("Shuffle"));break;case"KeyF":wa();break;case"KeyH":ge.click();break;case"KeyI":Ze.click(),Ja("Song info display "+Qt(Ze));break;case"KeyL":we.click(),Ja("LED effect "+Qt(we));break;case"KeyM":case"KeyV":ma(Ie,t),Ja("Mode: "+Ut(Ie));break;case"KeyN":ma(Ve,t),Ja(Ut(Ve).toUpperCase()+" sensitivity");break;case"KeyO":Ce.click(),Ja((Jt(Ce)?"LOW":"HIGH")+" Resolution");break;case"KeyP":Je.click(),Ja("Peaks "+Qt(Je));break;case"KeyR":We.click(),Ja("Queue repeat "+Qt(We));break;case"KeyS":Ja("Scale: "+["None","Frequency (Hz)","Level (dB)","Both"][function(e){let t=+Ue.dataset.active+(Ge.dataset.active<<1)+(e?-1:1);return t<0?t=3:t>3&&(t=0),Ue.dataset.active=1&t,Ge.dataset.active=t>>1,to([Ue,Ge],!0),t}(t)]);break;case"KeyT":_e.click(),Ja((Jt(_e)?"Flat":"Shadowed")+" text mode");break;case"KeyU":Te.click(),Ja("Luminance bars "+Qt(Te));break;case"KeyX":ma(ze,t),Ja("Reflex: "+Ut(ze));break;default:return}e.preventDefault()}function Sa(e){return JSON.parse(localStorage.getItem(e))}function $a(){const e=Ct<oa()-1?Ct+1:0,t=$t.children[e],a=At[Et];t&&(a.src=t.dataset.file,a.load(),ca(t,a)),Dt=!1}function Ca(e){return e=Zt(e),new Promise((t=>{let a,o=0;if(e)if(["m3u","m3u8"].includes(ea(e).extension))fetch(e).then((t=>{if(200==t.status)return t.text();ga(`Fetch returned error code ${t.status} for URI ${e}`,!0)})).then((n=>{$e.dataset.path||eo(e),e=ea(e).path,n.split(/[\r\n]+/).forEach((t=>{"#"!=t.charAt(0)&&""!=t.trim()?(t=Zt(t),a||(a=ea(t).baseName),Vt(t)||":"==t[1]||"/"==t[0]||(t=e+t),o+=da(aa(t),ta(a)),a=""):t.startsWith("#EXTINF")&&(a=t.slice(8))})),t(o)})).catch((e=>{ga(e,!0),t(o)}));else{const a=Sa("pl_"+e);Array.isArray(a)?a.forEach((e=>{e=Zt(e),o+=da(e,ta(ea(e).baseName))})):ga(`Unrecognized playlist file: ${e}`,!0),t(o)}else t(-1)}))}function Ta(e,t,a){if(!st[e])return;const o=st[e],n=st.default;void 0!==o.stereo&&(o.channelLayout=ut[+o.stereo][0]),te("[data-prop]").forEach((e=>{const t=e.dataset.prop,l=void 0!==o[t]?o[t]:a?n[t]:void 0;void 0!==l&&(e.classList.contains("switch")?e.dataset.active=+l:e==lt?oo(l):e==ie?Xa(l):(e.value=l,-1==e.selectedIndex&&(e.selectedIndex=0),bo(e)))})),mt.setOptions({alphaBars:Jt(ae),ansiBands:Jt(ne),channelLayout:de.value,fftSize:be.value,ledBars:Jt(we),linearAmplitude:Jt(Ee),loRes:Jt(Ce),lumiBars:Jt(Te),maxFreq:qe.value,minFreq:je.value,mirror:Oe.value,noteLabels:Jt(Re),outlineBars:Jt(Me),radial:Jt(Be),showFPS:Jt(ge),showPeaks:Jt(Je),showScaleX:Jt(Ue),showScaleY:Jt(Ge),smoothing:Qe.value,spinSpeed:tt.value,splitGradient:Jt(at),weightingFilter:rt.value}),ha(ke),to([le,ce,se,Ve,ze,ye,Fe,re,Ie],!0),"demo"==e&&Va(!0),t&&L().alert({text:"Settings loaded!"})}function Oa(e){ka(De);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,De.options[De.options.length]=t;const a=Sa(Z);a&&Object.keys(a).forEach((t=>{const o=new Option(a[t],t);o.dataset.isLocal="1",t==e&&(o.selected=!0),De.options[De.options.length]=o})),fetch("playlists.cfg").then((e=>200==e.status&&(ga("Found legacy playlists.cfg file"),e.text()))).then((e=>{if(!1!==e){let t=0;e.split(/[\r\n]+/).forEach((e=>{if("#"!=e.charAt(0)&&""!=e.trim()){let a=e.split(/\|/);2==a.length&&(De.options[De.options.length]=new Option(a[0].trim(),a[1].trim()),t++)}})),t?ga(`${t} playlists loaded from playlists.cfg`):ga("No playlists found in playlists.cfg",!0)}})).catch((e=>{}))}function Ia(e){const t=At[yt];if($t.children[e]){Ct=e;const a=$t.children[Ct];return t.src=a.dataset.file,ca(a,t),uo(),$a(),!0}return!1}function Aa(){Mt={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:"custom-gradient-1"};let e=2;for(;Object.keys(ct).some((e=>e===Mt.key))&&e<10;)Mt.key=`custom-gradient-${e}`,e++;Fa(),ee("#btn-save-gradient").innerText="Add",ee("#btn-delete-gradient").style.display="none",location.href="/#gradient-editor"}function _a(e){if(Dt||Lt||Ct>oa()-1)return!0;if(Dt=!0,Ct<oa()-1)Ct++;else{if(!Jt(We))return Dt=!1,!1;Ct=0}return e|=Xt(),yt=Et,Et=0|!yt,Za(),e?At[yt].play().then((()=>{$a()})).catch((e=>{20!=e.code&&(ga(e,!0),$a(),_a(!0))})):$a(),uo(),!0}function Ra(e){Lt||(Xt()&&!e?(At[yt].pause(),Yt()&&qt.pause()):At[yt].play().catch((e=>{20!=e.code&&(ga(e,!0),_a(!0))})))}function Ma(){let e=!0;return Xt()?At[yt].currentTime>2?At[yt].currentTime=0:Ct>0?Pa(Ct-1):e=!1:e=Ia(Ct-1),e}function Pa(e){Ia(e)&&Ra(!0)}function Na(){const e=ee("#enabled_gradients");ka(e),Object.keys(ct).forEach((t=>{t.startsWith("custom")?e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${ct[t].disabled?"":"checked"}>\n                   <a href="#" data-grad="${t}" class="grad-edit-link">${ct[t].name}</a>\n                </label>`:e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${ct[t].disabled?"":"checked"}>\n                   ${ct[t].name}\n                </label>`})),te(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(ct).reduce(((e,t)=>e+!ct[t].disabled),0)<2)return L().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;ct[e.dataset.grad].disabled=!e.checked,Da(),Ka(K)}))})),te(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),function(e){if(!ct[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=ct[e],a={};a.name=t.name,a.bgColor=t.bgColor,a.dir=t.dir,a.disabled=t.disabled,a.key=e,a.colorStops=[];for(const e of t.colorStops)a.colorStops.push({...e});Mt=a}(e.target.getAttribute("data-grad")),Fa(),ee("#btn-save-gradient").innerText="Save",ee("#btn-delete-gradient").style.display="block",location.href="/#gradient-editor"}))}))}function Da(){for(const e of[ye,xe]){let t=e.value;ka(e);for(const t of Object.keys(ct))ct[t].disabled||(e.options[e.options.length]=new Option(ct[t].name,t));""!==t&&(e.value=t,to(e,!0))}}function Ha(e,t){const a=[[null,"Select preset"],["demo","Demo (random)"],["fullres","Full resolution"],["ledbars","LED bars"],["octave","Octave bands"],...st.custom?[["custom","Custom"]]:[],...e?[["last","Last session"]]:[],["default","Restore defaults"]];Ba(He,a),He.value=t||""}function Ba(e,t,a){const o=e.value,n=!Array.isArray(t[0]);a||ka(e);for(const a of n?t.filter((e=>!e.disabled)):t){const t=new Option(a.text||a[1],a.value||a[0]);null===a[0]&&(t.disabled=!0),e[e.options.length]=t}""!==o&&(e.value=o,-1==e.selectedIndex&&(e.selectedIndex=0),to(e,!0))}function Fa(){if(null==Mt)throw new Error("Current gradient must be set before editing gradient");const e=ee("#grad-color-table");ka(e),ee("#new-gradient-name").value=Mt.name,ee("#new-gradient-horizontal").checked="h"===Mt.dir;const t=ee("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),Mt.colorStops.forEach(((e,t)=>{!function(e,t){const a=ee("#grad-color-table"),o=ee("#grad-row-template").cloneNode(!0),n=o.querySelector(".grad-color-picker"),l=o.querySelector(".grad-color-value"),i=o.querySelector(".grad-color-stop"),r=o.querySelector(".grad-add-stop"),s=o.querySelector(".grad-remove-stop");n.value=t.color,l.value=t.color,i.value=t.pos,n.addEventListener("input",(t=>{l.value=t.target.value,Mt.colorStops[e].color=n.value})),l.addEventListener("input",(t=>{n.value=t.target.value,Mt.colorStops[e].color=n.value})),i.addEventListener("input",(t=>{Mt.colorStops[e].pos=parseFloat(t.target.value)})),r.addEventListener("click",(()=>{Mt.colorStops.splice(e+1,0,{pos:(()=>{if(e===Mt.colorStops.length-1){const e=Mt.colorStops[Mt.colorStops.length-1].pos;return Mt.colorStops[Mt.colorStops.length-1].pos=(Mt.colorStops[Mt.colorStops.length-2].pos+e)/2,e}return(Mt.colorStops[e].pos+Mt.colorStops[e+1].pos)/2})(),color:"#111111"}),Fa()})),2===Mt.colorStops.length?s.setAttribute("disabled","true"):s.addEventListener("click",(()=>{Mt.colorStops.splice(e,1),Fa()})),o.removeAttribute("id"),a.appendChild(o)}(t,Mt.colorStops[t])})),ee("#new-gradient-bkgd").value=Mt.bgColor}function qa(){if(Ht>=O)return;const e=Array.from($t.children).find((e=>e.dataset.retrieve));if(e){Ht++,delete e.dataset.retrieve;const t=e.dataset.file;k.eF(t,{skipPostHeaders:!0}).then((a=>{a&&(ca(a,e),so(e),a.common.picture&&a.common.picture.length||function(e){return new Promise((t=>{const a=ea(e).path;if(-1==Ot||Vt(e))t("");else if(void 0!==Pt[a])t(aa(a+Pt[a]));else{const e=1==Ot?$+zt(a):a;fetch(e).then((e=>200==e.status?e.text():null)).then((e=>{let o="";if(e)if(1==Ot)o=e;else{const t=m(e);t.cover&&(o=t.cover)}Pt[a]=o,t(aa(a+o))}))}}))}(t).then((t=>{e.dataset.cover=t,so(e)})))})).catch((e=>{})).finally((()=>{Ht--,qa()}))}}function ja(e){const t=e.dataset.cover;t.startsWith("blob:")&&URL.revokeObjectURL(t)}function za(){null!==Mt&&(ct[Mt.key]=Mt,mt.registerGradient(Mt.key,Mt),Da(),Na(),Ka(j),Mt=null,location.href="/#config")}function Wa(e,t){if(0==oa())return void L().alert({text:"Queue is empty!"});if(!e)return void L().input({text:"Playlist will be saved to the current folder.<br>Enter filename:",submitText:"Save",submitCallback:e=>{e?Wa(b(e,!0)):L().alert({text:"Canceled"})},cancelCallback:()=>{L().alert({text:"Canceled"})}});const a=[];$t.childNodes.forEach((e=>{const{file:t,artist:o,title:n,duration:l}=e.dataset;a.push({file:la(t),artist:o,title:n,duration:l})})),fetch(C+e,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:a})}).then((e=>200==e.status?e.json():{error:`Cannot save file (ERROR ${e.status})`})).then((({file:e,error:a})=>{const o=e?`${t?"Updated":"Saved as"} ${ea(e).fileName}`:a;L().alert({text:o}),eo(e),h(null,s.scrollTop)}))}function Ka(e){const t=e=>e.filter((e=>e.disabled)).map((e=>e.value));if(e&&e!=U||Ua(U,t(dt)),e&&e!=W||Ua(W,t(bt)),e&&e!=K||Ua(K,Object.keys(ct).filter((e=>ct[e].disabled))),!e||e==j){const e={};Object.keys(ct).filter((e=>e.startsWith("custom"))).forEach((t=>e[t]=ct[t])),Ua(j,e)}if(e&&e!=G||Ua(G,t(pt)),!e||e==Q){let e=[];for(const t of[0,1,2])e.push({min:ee(`.min-db[data-preset="${t}"]`).value,max:ee(`.max-db[data-preset="${t}"]`).value,boost:ee(`.linear-boost[data-preset="${t}"]`).value});Ua(Q,e)}if(!e||e==V){const e={info:Le.value,track:ot.value,end:he.value,covers:Xe.checked,count:Ye.checked};Ua(V,e)}if(!e||e==Y){const e={fftSize:be.value,smoothing:Qe.value,pipRatio:Ne.value,fsHeight:ke.value,saveDir:Ke.checked};Ua(Y,e)}}function Ua(e,t){localStorage.setItem(e,JSON.stringify(t))}function Ga(e,t=1){xt=setTimeout((()=>{Nt=e,xa(t)}),200)}function Va(e=Lt){if(!Xt()&&!e)return;const t=e=>!pt.find((t=>t.value==e)).disabled,a=e=>{e.dataset.active=na(),o.push(e)};let o=[];if(Ie.selectedIndex=na(Ie.options.length),t("alpha")&&a(ae),t("nobg")&&(le.selectedIndex=na(le.options.length)),t("imgfit")&&(ce.selectedIndex=na(ce.options.length),o.push(ce)),t("peaks")&&a(Je),t("leds")&&a(we),t("lumi")&&(Te.dataset.active=le.value[0]>1&&Jt(we)?0:na(),o.push(Te)),t("line")&&(Se.value=na(5)+1,bo(Se)),t("fill")&&(ve.value=na(6)/10,bo(ve)),t("barSp")&&(re.selectedIndex=na(re.options.length)),t("outline")&&a(Me),t("reflex")){const e=ze.options.length-(Ie.value%10!=0);ze.selectedIndex=na(e)}t("radial")&&a(Be),t("spin")&&(tt.value=na(4),bo(tt),o.push(tt)),t("split")&&a(at),t("stereo")&&(de.selectedIndex=na(de.options.length)),t("mirror")&&(Oe.value=na(3)-1,o.push(Oe)),Jt(pe)&&(ye.selectedIndex=na(ye.options.length),o.push(ye)),o.push(le,ze,Ie),to(o,!0)}function Ya(e){document.documentElement.style.setProperty("--background-image",e?`url( ${e.replace(/['()]/g,"\\$&")} )`:"none")}function Xa(e){ie.dataset.value=e,St&&(St.pan.value=Math.log10(9*Math.abs(e)+1)*Math.sign(e)),ie.querySelector(".marker").style.transform=`rotate( ${145*e-90}deg )`}function Ja(e,t=2,a=1){e?"number"==typeof e?(kt.info=e,kt.timer=Math.round(Math.max(60*t,kt.timer||0)),kt.fade=Math.round(kt.timer/3)*a):(kt.msg=e,2==kt.info&&(kt.info=1),kt.msgTimer=60*t|0):kt={timer:0,msgTimer:0}}function Za(){Ft.src=At[yt].dataset.cover,le.value==R&&Ya(Ft.src)}function Qa(e){Le.value=e.info,ot.value=e.track,he.value=e.end,Xe.checked=e.covers,Ye.checked=e.count}function eo(e=""){w&&(e=la(e),$e.dataset.path=zt(e),$e.innerText=ea(e).fileName,$e.title=jt(e,!0))}function to(e,t){Array.isArray(e)||(e=[e]);for(const t of e)switch(t){case ae:mt.alphaBars=Jt(ae);break;case ne:mt.ansiBands=Jt(ne);break;case le:const e=le.value[0],a=e!=A&&e!=_;let o=le.value.slice(1);mt.overlay=a,mt.showBgColor=e==A,e==P?(Ya(),nt.style.display="",o||(o=Rt[na(Rt.length)]),decodeURIComponent(nt.src).endsWith(o)||(nt.src=T+"/"+encodeURIComponent(o))):(nt.style.display="none",a?(e!=M||o||(o=_t[na(_t.length)]),o&&(o=T+"/"+encodeURIComponent(o)),Ya(o||Ft.src)):Ya());break;case ce:const n=ce.value,l=n==H||n==B||n==F;ue.classList.toggle("repeat",n==D),ue.classList.toggle("cover",n==N||l),ue.style.backgroundSize="",it.style.display=l?"":"none",it.classList.toggle("rotating",n==F),it.classList.toggle("paused",n==H);break;case se:fe.style.background=`rgba(0,0,0,${1-se.value})`;break;case re:mt.barSpace=mt.isLumiBars?1.5:re.value;break;case de:mt.channelLayout=de.value;break;case ve:mt.fillAlpha=10==Ie.value?1:ve.value;break;case me:mt.frequencyScale=me.value;break;case je:case qe:for(;+qe.value<=+je.value;)qe.selectedIndex++;mt.setFreqRange(je.value,qe.value);break;case ye:case xe:""===t.value&&(t.selectedIndex=0),mt[t.dataset.prop]=t.value;break;case we:mt.ledBars=Jt(we);break;case Ee:mt.linearAmplitude=Jt(Ee);break;case Se:mt.lineWidth=10==Ie.value?0:Se.value;break;case Ce:mt.loRes=Jt(Ce);break;case Te:mt.lumiBars=Jt(Te),to(re);break;case Ie:const i=Ie.value;mt.mode=i<10?i:10,10==i?(mt.lineWidth=0,mt.fillAlpha=1):(mt.lineWidth=Se.value,mt.fillAlpha=ve.value),to(re);break;case Oe:mt.mirror=Oe.value;break;case Re:mt.noteLabels=Jt(Re);break;case Me:mt.outlineBars=Jt(Me);break;case Be:mt.radial=Jt(Be),to(re);break;case Fe:const r=Fe.value;Tt&&(Tt=clearInterval(Tt)),r>1&&(Tt=setInterval(Va,2500*r));break;case ze:switch(ze.value){case"1":mt.reflexRatio=.4,mt.reflexAlpha=.2;break;case"2":mt.reflexRatio=.5,mt.reflexAlpha=1;break;default:mt.reflexRatio=0}break;case Ue:mt.showScaleX=Jt(Ue);break;case Ge:mt.showScaleY=Jt(Ge);break;case Ve:const s=Ve.value;mt.setSensitivity(ee(`.min-db[data-preset="${s}"]`).value,ee(`.max-db[data-preset="${s}"]`).value),mt.linearBoost=ee(`.linear-boost[data-preset="${s}"]`).value;break;case ge:mt.showFPS=Jt(ge);break;case Je:mt.showPeaks=Jt(Je);break;case tt:mt.spinSpeed=tt.value;break;case at:mt.splitGradient=Jt(at);break;case rt:mt.weightingFilter=rt.value}t&&ho()}async function ao(){const e={mandatory:{chromeMediaSource:"desktop"}},t={audio:!w||e,video:!!w&&e};Lt=et.checked,Lt?navigator.mediaDevices?navigator.mediaDevices.getUserMedia(t).then((e=>{wt=mt.audioCtx.createMediaStreamSource(e),Xt()&&At[yt].pause(),It=Ae.checked,po(!0),mt.connectInput(wt),ga("Audio source set to microphone")})).catch((e=>{ga(`Could not change audio source - ${e}`,!0),et.checked=Lt=!1})):(ga("Cannot access user microphone",!0),et.checked=Lt=!1):(wt&&(mt.disconnectInput(wt),wt.mediaStream.getTracks()[0].stop(),wt=null,po(It)),ga("Audio source set to built-in player"))}function oo(e){lt.dataset.value=e,mt.volume=e**2.5,lt.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function no(){for(let e=oa()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=$t.replaceChild($t.children[t],$t.children[e]);$t.insertBefore(a,$t.children[t])}Pa(0)}function lo(e=!1){(e?Ma():_a())||Ja(`Already at ${e?"first":"last"} track`)}function io(){At[yt].pause(),Ja(),Ia(0)}function ro(e,t=!0){if(0!=oa())if(e){if(e){let a=e;if(!t){a=a.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=a.toLowerCase().replace(/[^a-z0-9]/g,"_");const t=Sa(Z)||{};for(;t.hasOwnProperty(a);)a+="_1";t[a]=e,Ua(Z,t),Oa(a)}let o=[];$t.childNodes.forEach((e=>o.push(e.dataset.file))),Ua("pl_"+a,o),L().alert({text:"Playlist saved!"})}}else L().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&ro(e,!1)},cancelCallback:()=>{L().alert({text:"Canceled"})}});else L().alert({text:"Queue is empty!"})}function so(e){for(const t of At)t.dataset.file==e.dataset.file&&ca(e,t)}function co(){2==kt.info?Ja():Ja(1+(0|kt.info),+Le.value||1/0)}function uo(){const e=$t.querySelector(".current"),t=$t.children[Ct];e&&e.classList.remove("current"),t&&(t.classList.add("current"),t.scrollIntoViewIfNeeded())}function po(e){void 0!==e?Ae.checked=e:e=Ae.checked,e?mt.disconnectOutput():mt.connectOutput()}function fo(){const e=Gt();st.custom=e,Ua(z,e),L().alert({text:"Custom preset saved!"}),Ha(Array.from(He.options,(e=>e.value)).includes("last"),"custom")}function ho(){Ua(X,{...Gt(),volume:lt.dataset.value,balance:ie.dataset.value})}function bo(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=e.value)}!async function(){let e,t,a,i,m,x,E,S,$,C,O,I,N;const D=e=>{_a(!0)||(Ia(0),Ja("Queue ended",10),Yt()&&qt.pause())},H=e=>{e.target.attributes.src&&ga("Error loading "+e.target.src,!0)},B=e=>{At[yt].attributes.src?(Yt()&&qt.play(),At[yt].currentTime<.1&&("1"==Fe.value?Va(!0):Jt(pe)&&"0"==Fe.value&&ma(ye)),Jt(Ze)&&Ja(1,+ot.value||1/0)):Pa(Ct)};window.addEventListener("error",(e=>ga(`Unexpected ${e.error}`,!0)));let F=!1;if(ga(`audioMotion v${o.i8} initializing...`),ga(`User agent: ${navigator.userAgent}`),ee("#version").innerText=o.i8,w){const e=JSON.parse(await electron.api("get-storage")||null);for(const t in e)Ua(t,e[t])}const q=function(){const e=(e,t)=>{Array.isArray(e)&&e.forEach((e=>{const a=t.find((t=>t.value==e));a&&(a.disabled=!0)}))},t=X in localStorage;st.last={...st.default,...Sa(X)},st.custom=Sa(z),Ha(t),e(Sa(U),dt),e(Sa(W),bt);const a=Sa(j);a&&Object.keys(a).forEach((e=>{ct[e]=a[e]}));const o=Sa(K);Array.isArray(o)&&o.forEach((e=>{ct[e].disabled=!0})),e(Sa(G),pt);const n=te(".min-db");n.forEach((e=>ra(e,-120,-60)));const l=te(".max-db");l.forEach((e=>ra(e,-50,0)));const i=te(".linear-boost");i.forEach((e=>ra(e,1,5,.2))),(Sa(Q)||ft).forEach(((e,t)=>{n[t].value=e.min,l[t].value=e.max,i[t].value=e.boost||ft[t].boost})),Qa({...ht,...Sa(V)||{}});for(let e=10;e<16;e++)be[be.options.length]=new Option(2**e);var r;return ra(Qe,0,.9,.1),Ba(Ne,gt),ra(ke,25,100,5),r={...vt,...Sa(Y)||{}},be.value=r.fftSize,Qe.value=r.smoothing,Ne.value=r.pipRatio,ke.value=r.fsHeight,Ke.checked=r.saveDir,t}();$t=ee("#playlist"),$t.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&(Pa(Kt(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),Ct=0,y.ZP.create($t,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{Ct=Kt($t.querySelector(".current")),0!=e.newIndex||Xt()||Ia(0),$a()}}),ga(`Instantiating audioMotion-analyzer v${n.Z.version}`),mt=new n.Z(oe,{fsElement:ue,onCanvasDraw:o=>{const n=At[yt],l=n.dataset,r=n.duration-n.currentTime,s=+he.value,c=le.value[0],d=ce.value,u=Jt(_e),p=mt.pixelRatio;if(r<.1&&_a(!0),s>0&&r<=s&&Jt(Ze)&&!kt.info&&Xt()&&Ja(1,r,-1),!("3"!=d&&"4"!=d&&"5"!=d||c!=R&&c!=M)){let e;if("3"==d)e=(70*mt.getEnergy()|0)-25;else{const t=n.currentTime/n.duration;e=100*("4"==d?t:1-t)}ue.style.backgroundSize=`auto ${100+e}%`}if(Pe.width|=0,(kt.timer||kt.msgTimer)<1)return;const f=(e,t,a,o)=>{u?(Bt.strokeText(e,t,a,o),Bt.fillText(e,t,a,o)):(Bt.shadowOffsetX=Bt.shadowOffsetY=3*p,Bt.fillText(e,t,a,o),Bt.shadowOffsetX=Bt.shadowOffsetY=0)};if(Bt.lineWidth=4*p,Bt.lineJoin="round",Bt.font=I,Bt.textAlign="center",Bt.fillStyle="#fff",Bt.strokeStyle=Bt.shadowColor="#000",kt.msgTimer>0&&2!=kt.info&&(Bt.globalAlpha=kt.msgTimer<60?kt.msgTimer/60:1,f(kt.msg,a,m),kt.msgTimer--),kt.timer>0){if(kt.fade<0){const e=Math.abs(kt.fade),t=3*e-kt.timer;Bt.globalAlpha=t<e?t/e:1}else Bt.globalAlpha=kt.timer<kt.fade?kt.timer/kt.fade:1;if(2==kt.info&&(f("Gradient: "+ct[ye.value].name,a,m,C),f(`Auto gradient is ${Qt(pe)}`,a,x),Bt.textAlign="left",f(Ut(Ie),e,m,C),f(`Random mode: ${Ut(Fe)}`,e,x,C),Bt.textAlign="right",f(Ut(Ve).toUpperCase()+" sensitivity",i,m,C),f(`Repeat is ${Qt(We)}`,i,x,C)),Lt)Bt.textAlign="left",Bt.font=N,f("MIC source",e,S,O);else{Bt.textAlign="right",f(l.codec,i,E),f(l.quality,i,E+e);const a=oa();a&&Ye.checked&&f(`Track ${(""+(Ct+1)).padStart((""+a).length,"0")} of ${a}`,i,E-e),Bt.textAlign="left",f(l.artist.toUpperCase(),e,E,O),Bt.font=`italic ${I}`,f(l.album,e,$,O),Bt.font=N,f(n.src?l.title:"No song loaded",e,S,O),(n.duration||l.duration)&&(l.duration||(l.duration=ia(n.duration),$t.children[Ct]&&($t.children[Ct].dataset.duration=l.duration)),Bt.textAlign="right",f(ia(n.currentTime)+" / "+l.duration,i,$)),Ft.width&&Xe.checked&&Bt.drawImage(Ft,e,E-1.3*t,t,t)}--kt.timer<1&&(kt.info=kt.fade=0)}},onCanvasResize:(o,n)=>{let l;const r=n.pixelRatio,s=Pe.width=ue.clientWidth*r,c=Pe.height=ue.clientHeight*r;switch(o){case"create":ga(`Display resolution: ${n.fsWidth} x ${n.fsHeight} px (pixelRatio: ${window.devicePixelRatio})`),l="Canvas created";break;case"lores":l=`Lo-res ${n.loRes?"ON":"OFF"} (pixelRatio = ${r})`;break;case"fschange":l=(n.isFullscreen?"Enter":"Exit")+"ed fullscreen";break;case"resize":l="Window resized";break;case"user":l=(Yt()?"Resized for":"Closed")+" PIP"}ga(`${l||o}. Canvas size is ${n.canvas.width} x ${n.canvas.height} px`),e=Math.min(s,c)/17,t=3*e,a=s/2,i=s-e,m=1.4*e,x=1.8*m,C=s/3-e,E=c-4*e,S=c-2.8*e,$=c-1.6*e,O=s-7*e,I=`bold ${.7*e}px sans-serif`,N=`bold ${e}px sans-serif`}});const ae=mt.audioCtx;ae.createStereoPanner&&(St=ae.createStereoPanner(),mt.connectInput(St)),yt=0,Et=1;for(const e of[0,1])At[e]=ee(`#player${e}`),va(e),At[e].addEventListener("play",B),At[e].addEventListener("ended",D),At[e].addEventListener("error",H),St?ae.createMediaElementSource(At[e]).connect(St):mt.connectInput(At[e]);!function(){const e=(e,t,a,o,n)=>{a.forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),te(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return L().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;a.find((t=>t.value==e.dataset.option)).disabled=!e.checked,Ba(o,a),Ka(n)}))}))};e(ee("#enabled_modes"),"enabledMode",dt,Ie,U),e(ee("#enabled_bgfit"),"enabledMode",bt,ce,W);const t=ee("#enabled_gradients");Object.keys(ct).forEach((e=>{t.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${ct[e].disabled?"":"checked"}> ${ct[e].name}</label>`})),Na();const a=ee("#random_properties");pt.forEach((e=>{a.innerHTML+=`<label><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),te(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{pt.find((t=>t.value==e.value)).disabled=!e.checked,Ka(G)}))})),te("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{const t=e.dataset.preset;ee(`.min-db[data-preset="${t}"]`).value=ft[t].min,ee(`.max-db[data-preset="${t}"]`).value=ft[t].max,ee(`.linear-boost[data-preset="${t}"]`).value=ft[t].boost,te(`[data-preset="${t}"]`).forEach((e=>{e.classList.remove("field-error")})),e.dataset.preset==Ve.value&&to(Ve),Ka(Q)})):e.addEventListener("change",(()=>{const t=+e.value>=+e.min&&+e.value<=+e.max;t&&(e.dataset.preset==Ve.value&&to(Ve),Ka(Q)),e.classList.toggle("field-error",!t)}))}));for(const e of[Le,ot,he,Xe,Ye])e.addEventListener("change",(()=>Ka(V)));ee("#reset_osd").addEventListener("click",(()=>{Qa(ht),Ka(V)})),[be,Qe,Ne,ke,Ke].forEach((e=>{e.addEventListener("change",(()=>ha(e)))}))}(),Ba(Ie,dt);for(const e of[20,30,40,50,60,100,250,500,1e3,2e3])je[je.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,22e3])qe[qe.options.length]=new Option(e/1e3+"kHz",e);Ba(de,ut),Ba(Ve,[["0","Low"],["1","Normal"],["2","High"]]),Ba(re,[["1.5","Legacy"],["0.1","Narrow"],["0.25","Regular"],["0.5","Wide"],["0.75","Extra wide"]]),Ba(Fe,[["0","Off"],["1","On track change"],["2","5 seconds"],["6","15 seconds"],["12","30 seconds"],["24","1 minute"],["48","2 minutes"],["120","5 minutes"]]),Ba(ze,[["0","Off"],["1","On"],["2","Mirrored"]]),Ba(le,[[R,"Album cover"],[_,"Black"],[A,"Gradient default"]]),Ba(ce,bt),Ba(Oe,[["0","Off"],["-1","Left"],["1","Right"]]),Ba(me,[["bark","Bark"],["linear","Linear"],["log","Logarithmic"],["mel","Mel"]]),Ba(rt,[["","None"],["A","A-weighting"],["B","B-weighting"],["C","C-weighting"],["D","D-weighting"],["468","ITU-R 468"]]);const ne=fetch(T).then((e=>e.text())).then((e=>{const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,a=/\.(mp4|webm|mov)$/i;for(const{file:o}of g(e))t.test(o)?_t.push(o):a.test(o)&&Rt.push(o);const o=_t.length,n=Rt.length,l=_t.map((e=>[M+e,"ðŸ–¼ï¸ "+ea(e).baseName])).concat(Rt.map((e=>[P+e,"ðŸŽ¬ "+ea(e).baseName]))).slice(0,20);n&&l.splice(0,0,[P,"Random video"]),o&&l.splice(0,0,[M,"Random image"]),ga("Found "+(o+n==0?"no media":o+" image files and "+n+" video")+" files in the backgrounds folder"),Ba(le,l,!0)})).catch((e=>{}));ra(se,.1,1,.1),ra(Se,1,5),ra(ve,0,.5,.1),ra(tt,0,3,1),function(){const e=ee("#toggle_settings");e.addEventListener("click",(()=>{ee("#settings").classList.toggle("active",e.classList.toggle("active"))})),ee(".settings-close").addEventListener("click",(()=>e.click()));const t=ee("#toggle_console");let a;t.addEventListener("click",(()=>{ee("#console").classList.toggle("active",t.classList.toggle("active")),t.classList.remove("warning"),ga()})),ee("#console-close").addEventListener("click",(()=>t.click())),ee("#console-clear").addEventListener("click",(()=>ga("Console cleared.",!1,!0))),te(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,to(e,!0)}))})),te("[data-prop]").forEach((e=>{e.addEventListener("change",(()=>{to(e,!0),bo(e)}))})),et.addEventListener("change",ao),Ae.addEventListener("change",(()=>po())),[lt,ie].forEach((e=>{e.addEventListener("wheel",(t=>{if(t.preventDefault(),a)return;a=setTimeout((()=>a=!1),50);const o=Math.sign(t.deltaY||0);e==lt?ba(o):pa(o)}))})),ie.addEventListener("dblclick",(()=>{pa(0)})),ee("#btn_play").addEventListener("click",(()=>Ra())),ee("#btn_stop").addEventListener("click",io),ee("#btn_shuf").addEventListener("click",no),ee("#btn_prev").addEventListener("mousedown",(()=>Ga("m",-1))),ee("#btn_prev").addEventListener("click",(e=>{La()||lo(!0)})),ee("#btn_next").addEventListener("mousedown",(()=>Ga("m"))),ee("#btn_next").addEventListener("click",(()=>{La()||lo()})),ee("#load_preset").addEventListener("click",(()=>{He.value&&(ga(`Loading preset '${Ut(He)}'`),Ta(He.value,!0))})),ee("#btn_save").addEventListener("click",fo),ee("#btn_fullscreen").addEventListener("click",wa),ee("#save_playlist").addEventListener("click",(()=>{if(w){const e=$e.dataset.path;e?L().confirm({text:`<strong>${$e.innerText}</strong><br>will be overwritten with the current play queue<br>ARE YOU SURE?`,submitText:"Overwrite",submitCallback:()=>Wa(e,!0),cancelCallback:()=>L().alert({text:"Canceled"})}):Wa()}else e=De.selectedIndex,""==De[e].value?ro():De[e].dataset.isLocal?L().confirm({text:`Overwrite "${De[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{ro(De[e].value)},cancelCallback:()=>{L().alert({text:"Canceled"})}}):L().alert({text:'This is a server playlist which cannot be overwritten.<br>Click "Save as..." to create a new local playlist.',time:5});var e})),ee("#create_playlist").addEventListener("click",(()=>w?Wa():ro())),ee("#btn_clear").addEventListener("click",(()=>{!function(){for(;$t.hasChildNodes();)ja($t.removeChild($t.firstChild));Xt()?Ct=-1:(Ct=0,va(yt)),va(Et),uo()}(),eo()})),(w?ee(".playlist-bar"):$e).style.display="none",w||(ee("#load_playlist").addEventListener("click",(()=>{Ca(De.value).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;L().alert({text:t,time:5})}))})),ee("#delete_playlist").addEventListener("click",(()=>{return e=De.selectedIndex,void(De[e].dataset.isLocal?L().confirm({text:`Do you really want to DELETE the "${De[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:()=>{const t=De[e].value,a=Sa(Z);a&&(delete a[t],Ua(Z,a)),localStorage.removeItem(`pl_${t}`),L().alert({text:"Playlist deleted"}),Oa()},cancelCallback:()=>{L().alert({text:"Canceled"})}}):De[e].value&&L().alert({text:"Cannot delete a server playlist!"}));var e}))),Pe.addEventListener("click",(()=>co()));const o=ee("#local_file");let n,l;w?o.parentElement.style.display="none":o.addEventListener("change",(e=>function(e){const t=e.files[0];if(t){va();const e=At[yt];e.src=URL.createObjectURL(t),e.play(),e.onload=()=>URL.revokeObjectURL(e.src),k.Aj(t).then((t=>ca(t,e))).catch((e=>{}))}}(e.target))),ee("#btn_load_url").addEventListener("click",(()=>{L().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&ua(e,!0)}})}));const i=ee("#btn_pip");document.pictureInPictureEnabled?i.addEventListener("click",(async()=>{if(qt!==document.pictureInPictureElement){const e=mt.canvas.captureStream();n=e.getTracks()[0],qt.muted=!0,qt.srcObject=e,await qt.play(),qt.requestPictureInPicture()}else document.exitPictureInPicture()})):i.classList.add("disabled");const r=((e,t=300)=>{let a;return(...o)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,o)),t)}})((()=>mt.setCanvasSize(l.width,l.height)));qt.addEventListener("enterpictureinpicture",(e=>{l=e.pictureInPictureWindow,ue.classList.add("pip"),i.classList.add("active"),mt.setCanvasSize(l.height*Ne.value,l.height),l.addEventListener("resize",r)})),qt.addEventListener("leavepictureinpicture",(()=>{l.removeEventListener("resize",r),qt.pause(),n.stop(),qt.srcObject=n=null,i.classList.remove("active"),ue.classList.remove("pip"),mt.setCanvasSize()}));const s=navigator.mediaSession;s&&(s.setActionHandler("play",(()=>Ra())),s.setActionHandler("pause",(()=>Ra())),s.setActionHandler("previoustrack",(()=>Ma())),s.setActionHandler("nexttrack",(()=>_a()))),ee("#add-gradient").addEventListener("click",Aa),ee("#btn-save-gradient").addEventListener("click",za),ee("#btn-delete-gradient").addEventListener("click",ya),ee("#new-gradient-bkgd").addEventListener("input",(e=>{Mt.bgColor=e.target.value})),ee("#new-gradient-name").addEventListener("input",(e=>{Mt.name=e.target.value})),ee("#new-gradient-horizontal").addEventListener("input",(e=>{Mt.dir=e.target.checked?"h":void 0}))}(),Ja(),Object.keys(ct).forEach((e=>{ct[e].colorStops&&mt.registerGradient(e,{bgColor:ct[e].bgColor,colorStops:ct[e].colorStops})})),Da(),ao(),Oa();const fe=function(e,t={}){let a;return r=document.createElement("ul"),r.className="breadcrumb",e.append(r),s=document.createElement("ul"),s.className="filelist",e.append(s),a=setTimeout((()=>{r.innerHTML="Waiting for server..."}),5e3),r.innerHTML="Initializing... please wait...",r.addEventListener("click",(function(e){e.target&&"LI"==e.target.nodeName&&function(e){let t;for(;e>0;)t=p.pop(),e--;h(void 0,t&&t.scrollTop)}(e.target.dataset.depth)})),s.addEventListener("click",(function(e){e.target&&"LI"==e.target.nodeName&&("dir"==e.target.dataset.type?h(e.target.dataset.path):"mount"==e.target.dataset.type&&(p=[],h(e.target.dataset.path)))})),s.addEventListener("dblclick",(function(e){e.target&&"LI"==e.target.nodeName&&d&&["file","list"].includes(e.target.dataset.type)&&d(b(e.target.dataset.path),e)})),"function"==typeof t.onDblClick&&(d=t.onDblClick),"function"==typeof t.onEnterDir&&(c=t.onEnterDir),new Promise((e=>{fetch("/serverInfo").then((e=>e.text())).then((async o=>{let n;if(clearTimeout(a),o.startsWith("audioMotion")?(f=!0,n=1):n=0,1==n&&l){const e=await fetch("/getMounts");u=await e.json()}else u=[t.rootPath||"/music"];!1===await h(u[0])&&(r.innerHTML=`Cannot access media folder (${u[0]}) on server!`,s.innerHTML="",n=-1),e([n,s,n?o:"Standard web server"])})).catch((t=>{clearTimeout(a),r.innerHTML="No file server found.",e([-1,s])}))}))}(ee("#file_explorer"),{onDblClick:(e,t)=>{sa([{file:e}],!0),t.target.classList.remove("selected","sortable-chosen")},onEnterDir:e=>{Ke.checked&&F&&Ua(J,e)}}).then((([e,t,a])=>{const o=ee("#btn_add_selected"),n=ee("#btn_add_folder");Ot=e,-1==e?(ga("No server found. File explorer will not be available.",!0),o.disabled=!0,n.disabled=!0):(ga(`${a} detected on port ${location.port}`),y.ZP.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{"playlist"==e.to.id&&(e.items.length?e.items:[e.item]).forEach((e=>{ua(b(e.dataset.path)),e.remove()}))}}),o.addEventListener("mousedown",(()=>sa(v(".selected")))),n.addEventListener("click",(()=>sa(v()))))}));window.addEventListener("keydown",Ea),window.addEventListener("keyup",Ea),L().setOptions({positions:{alert:"bottom"}}),Promise.all([ne,fe]).then((()=>{ga(`Loading ${q?"last session":"default"} settings`),Ta("last",!1,!0),async function(e){if(!e)return!1;const t=[...p];p=e;await h()||(p=t)}(Sa(J)),ga(`AudioContext sample rate is ${ae.sampleRate}Hz; Latency is ${1e3*((ae.outputLatency||0)+ae.baseLatency)|0}ms`),ga("Initialization complete!"),F=!0}))}()},7379:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),o=parseInt(a.getPropertyValue("border-top-width")),n=parseInt(a.getPropertyValue("border-left-width")),l=this.offsetTop-t.offsetTop<t.scrollTop,i=this.offsetTop-t.offsetTop+this.clientHeight-o>t.scrollTop+t.clientHeight,r=this.offsetLeft-t.offsetLeft<t.scrollLeft,s=this.offsetLeft-t.offsetLeft+this.clientWidth-n>t.scrollLeft+t.clientWidth,c=l&&!i;(l||i)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-o+this.clientHeight/2),(r||s)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-n+this.clientWidth/2),(l||i||r||s)&&!e&&this.scrollIntoView(c)})},9283:()=>{},3838:()=>{}},a={};function o(e){var n=a[e];if(void 0!==n)return n.exports;var l=a[e]={exports:{}};return t[e].call(l.exports,l,l.exports,o),l.exports}o.m=t,e=[],o.O=(t,a,n,l)=>{if(!a){var i=1/0;for(d=0;d<e.length;d++){for(var[a,n,l]=e[d],r=!0,s=0;s<a.length;s++)(!1&l||i>=l)&&Object.keys(o.O).every((e=>o.O[e](a[s])))?a.splice(s--,1):(r=!1,l<i&&(i=l));if(r){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[a,n,l]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};o.O.j=t=>0===e[t];var t=(t,a)=>{var n,l,[i,r,s]=a,c=0;if(i.some((t=>0!==e[t]))){for(n in r)o.o(r,n)&&(o.m[n]=r[n]);if(s)var d=s(o)}for(t&&t(a);c<i.length;c++)l=i[c],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var n=o.O(void 0,[216],(()=>o(2301)));n=o.O(n)})();