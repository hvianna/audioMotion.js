/*! For license information please see audioMotion.js.LICENSE.txt */
(()=>{var e,t={6965:(e,t,a)=>{"use strict";var n=a(4015);const o="/music",s=!!window.showDirectoryPicker,i="Click to open a new root folder",r="No music found on server and no browser support for File System API",l=40,c="loading",d="local",u="server";let f,p,h,m,b,g=[],v=/.*/,k=[],y=!1,w=!1,x=!1;function L(e,t){m.innerHTML="",b.innerHTML="",b.style.backgroundImage="";const a=(e,t)=>{const a=document.createElement("li"),n=e.name||e;a.dataset.type=null!==n.match(/\.(m3u|m3u8)$/)&&"file"==t?"list":t,a.dataset.path=n,a.dataset.subs=+!!e.subs,a.innerText=n,a.handle=e.handle,a.dirHandle=e.dirHandle,a.subs=e.subs,b.append(a)},n=e=>b.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e?`, url('${e}')`:"");if(0==k.length&&(m.innerHTML=r),g.forEach((({dir:e},t)=>{m.innerHTML+=`<li data-depth="${g.length-t-1}">${e}</li> ${"/"==e?"":"/"} `;let a=0;for(;m.getBoundingClientRect().height>l&&a<m.children.length-1;)m.children[a].innerText="..",a++})),k.forEach((e=>{b.innerHTML+=`<li data-type="mount" ${w&&!f?'class="full-panel"':""} data-path="${e}">[ ${e} ]</li>`})),g.length>1&&(b.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e){const{cover:t,dirs:o,files:s}=e;o&&o.forEach((e=>a(e,"dir"))),s&&s.forEach((e=>a(e,"file"))),t&&t.handle?t.handle.getFile().then((e=>n(URL.createObjectURL(e)))):n(t?C(t.name):"")}b.scrollTop=t||0}async function E(e,t){let a,n=e&&"string"!=typeof e?e:null,o=f,s=[...g];const i=m.parentElement;if(n&&(e=n.name),e)if(".."==e){a=g.pop();const e=g[g.length-1];e&&e.handle&&(n=e.handle)}else g.push({dir:e,scrollTop:b.scrollTop,handle:n});i.classList.add(c),i.classList.toggle(d,w),i.classList.toggle(u,x&&!w),f&&n&&(f=n);const r=await T(C(),f);return i.classList.remove(c),!1!==r?(L(r,t||a&&a.scrollTop),h&&h(g),!0):(g=s,f=o,!1)}function S(e){return e.replace(/[#%&]/g,(e=>({"#":"%23","%":"%25","&":"%26"}[e])))}function C(e){let t="";return g.forEach((({dir:e})=>{t+=e+("/"==e?"":"/")})),e&&(t+=e),t=S(t),x&&"/"==t[0]&&(t=t.slice(1)),t}function $(e="li"){let t=[];return b.querySelectorAll(e).forEach((e=>{const{path:a,type:n}=e.dataset,{handle:o,dirHandle:s,subs:i}=e;["file","list"].includes(n)&&t.push({file:C(a),handle:o,dirHandle:s,subs:i,type:n})})),t}async function T(e,t){let a;try{if(s&&t instanceof FileSystemDirectoryHandle){a=[];for await(const[e,n]of t.entries())a.push({name:e,handle:n,dirHandle:t})}else{const t=await fetch(e);a=!!t.ok&&await t.text()}}catch(e){a=!1}return!1!==a&&function(e,t){const a=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i,n=/\.vtt$/i;let o=[],i=[],r=[],l=[];const c=(e,t)=>{const n=new RegExp(`${t}.*${a.source}`,"i");return e.find((e=>(e.name||e).match(n)))};if(Array.isArray(e)&&s)for(const t of e){const{name:e,handle:s,dirHandle:c}=t;s instanceof FileSystemDirectoryHandle?o.push(t):s instanceof FileSystemFileHandle&&(e.match(a)?r.push(t):e.match(n)&&l.push(t),e.match(v)&&i.push(t))}else for(const{url:t,file:s}of A(e)){const e={name:s};"/"==t.slice(-1)?o.push(e):(s.match(a)?r.push(e):s.match(n)&&l.push(e),s.match(v)&&i.push(e))}for(const e of l){const{name:a,handle:n}=e,[,o,,s]=a.match(/(.*?)(\.([a-z]{0,3}))?\.vtt$/i)||[],r=i.find((e=>e.name.startsWith(o)));r&&(r.subs={src:t?t+a:C(a),lang:s,handle:n})}const d=c(r,"cover")||c(r,"folder")||c(r,"front")||r[0],u=new Intl.Collator,f=(e,t)=>u.compare(e.name,t.name);return{cover:d,dirs:o.sort(f),files:i.sort(f)}}(a,e)}async function _(e){const t=[...g],a=e.split("/");let n=t[t.length-1].handle;for(;a.length>1;){const e=a.shift();if(".."==e)t.pop(),n=t[t.length-1].handle;else{try{n=await n.getDirectoryHandle(e)}catch(e){return{}}t.push({handle:n})}}const o=a.shift(),s=n;try{n=await n.getFileHandle(o)}catch(e){n=void 0}return{handle:n,dirHandle:s}}function A(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const[,t,n]=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i),o="/"==t.slice(-1),s=t.slice(t.lastIndexOf("/",o?t.length-2:void 0)+1),i=decodeURIComponent(s.slice(0,o?-1:void 0));o&&n.match(/^(parent directory|\.\.)/i)||a.push({url:s,file:i})}return a}async function O(e){const t=e&&e[e.length-1],a=f,n=[...g];g=e,t&&t.handle&&(f=t.handle);const o=!!e&&await E();return o||(f=a,g=n,w||g.length?w&&!f&&L():E(k[0])),o}var I=a(6015),P=(a(6216),a(7783)),H=a(382),R=a(246),D=a(4596),F=a.n(D);R.Ay.mount(new R.cR);const M=location.origin+location.pathname,N="25.9",B="backgrounds/",q=4,j=2e3,U=-1,z="0",G="1",W="2",K="3",V="4",J="0",X="1",Y="2",Z="0",Q="2",ee="3",te="6",ae="7",ne="8",oe={album:"",artist:"",codec:"",cover:"",duration:"",file:"",filename:"",quality:"",title:""},se="compact",ie="fit-video",re="preserve-filenames",le="warning",ce="dual-combined",de="single",ue="gradient",fe="bar-index",pe="bar-level",he=20,me=["mp3","flac","m4a","aac","ogg","wav"],be=["jpg","jpeg","webp","avif","png","gif","bmp"],ge=["m3u","m3u8"],ve=["mkv","mpg","webm","mp4","avi","mov"],ke="local",ye="bgDir",we="custom-grads",xe="custom-preset",Le="disabled-bgfit",Ee="disabled-gradients",Se="disabled-properties",Ce="display-options",$e="force-filesystem",Te="general-settings",_e="last-config",Ae="last-dir",Oe="last-version",Ie="peak-settings",Pe="playlists",He="playqueue",Re="sensitivity-presets",De="subtitles-settings",Fe="pl_",Me="11",Ne="0",Be="10",qe="101",je="close",Ue="open",ze=0,Ge=2,We="default",Ke="last",Ve="No description",Je="0",Xe="1",Ye="2",Ze="3",Qe="alpha",et="nobg",tt="bands",at="imgfit",nt="colormode",ot="gradient",st="leds",it="lumi",rt="mode",lt="outline",ct="peaks",dt="presets",ut="radial",ft="reflex",pt="round",ht="split",mt="log",bt=0,gt=2,vt="config.yaml",kt={defaultAccessMode:ke,enableLocalAccess:!0,frontPanel:Ue,preserveFilenames:!1},yt="shadow",wt="white",xt="subs-bg-",Lt="subs-color-",Et="bottom",St="center",Ct="show",$t=document.querySelector.bind(document),Tt=document.querySelectorAll.bind(document),_t=$t("#alpha_bars"),At=$t("#analyzer"),Ot=$t("#ansi_bands"),It=$t("#auto_hide"),Pt=$t("#background"),Ht=$t("#band_count"),Rt=$t("#bar_space"),Dt=$t("#bg_img_dim"),Ft=$t("#bg_img_fit"),Mt=$t("#bg_location"),Nt=$t("#bg_max_items"),Bt=$t("#channel_layout"),qt=$t("#color_mode"),jt=$t("#bg_container"),Ut=$t("#debug"),zt=$t("#bg_dim"),Gt=$t("#end_timeout"),Wt=$t("#fft_size"),Kt=$t("#fill_alpha"),Vt=$t("#fps"),Jt=$t("#freq_scale"),Xt=$t("#fs_height"),Yt=$t("#gradient"),Zt=$t("#gradientRight"),Qt=$t("#gravity"),ea=$t("#info_timeout"),ta=$t("#invert_volume"),aa=$t("#led_display"),na=$t("#linear_amplitude"),oa=$t("#line_width"),sa=$t("#link_grads"),ia=$t("#lo_res"),ra=$t("#lumi_bars"),la=$t("#max_fps"),ca=$t("#files_panel"),da=$t("#mirror"),ua=$t("#mode"),fa=$t("#mute"),pa=$t("#no_dim_subs"),ha=$t("#no_dim_video"),ma=$t("#no_shadow"),ba=$t("#outline"),ga=$t("#osd"),va=$t("#osd_font_size"),ka=$t("#panel_selection"),ya=$t("#peak_fade"),wa=$t("#peak_hold"),xa=$t("#pip_ratio"),La=$t("#playlists"),Ea=$t("#playlist"),Sa=$t("#preserve_filenames"),Ca=$t("#presets"),$a=$t("#radial"),Ta=$t("#radius"),_a=$t("#random_mode"),Aa=$t("#freq_max"),Oa=$t("#freq_min"),Ia=$t("#reduce_subs"),Pa=$t("#reduce_video"),Ha=$t("#reflex"),Ra=$t("#repeat"),Da=$t("#round_bars"),Fa=$t("#save_dir"),Ma=$t("#save_queue"),Na=$t("#scaleX"),Ba=$t("#scaleY"),qa=$t("#sensitivity"),ja=$t("#show_count"),Ua=$t("#show_cover"),za=$t("#show_peaks"),Ga=$t("#show_song"),Wa=$t("#show_subs"),Ka=$t("#smoothing"),Va=$t("#song_duration"),Ja=$t("#current_time"),Xa=$t("#progress"),Ya=$t("#source"),Za=$t("#spin"),Qa=$t("#split_grad"),en=$t("#subs_background"),tn=$t("#subs_color"),an=$t("#subs_position"),nn=$t("#subs_position_audio"),on=$t("#enable_surround"),sn=$t("#toggle_panel"),rn=$t("#track_timeout"),ln=$t("#video"),cn=$t("#video_fill"),dn=$t("#volume"),un=$t("#warp"),fn=$t("#weighting"),pn=$t(".player-panel").clientHeight+$t(".bottom-panel").clientHeight,hn=parseInt(getComputedStyle(jt).minHeight)+pn+ca.clientHeight,mn=[{key:"demo",name:"Demo (random)",options:{randomMode:6}},{key:"ledbars",name:"Classic LED bars",options:{alphaBars:0,background:z,bandCount:"6",barSpace:.2,channelLayout:de,colorMode:ue,gradient:"classic",ledDisplay:1,lumiBars:0,outlineBars:0,mode:Me,radial:0,randomMode:0,reflex:Je,roundBars:0,showPeaks:1,splitGrad:0}},{key:"dual",name:"Dual-channel combined Graph",options:{channelLayout:ce,fillAlpha:.3,gradient:"cool",gradientRight:"dusk",lineWidth:1,linkGrads:0,mode:qe,radial:0,randomMode:0,reflex:Je,showPeaks:ze,splitGrad:0}},{key:"bands",name:"Octave Bands + Reflex",options:{alphaBars:0,background:W,bandCount:"2",bgImageFit:Z,channelLayout:de,colorMode:ue,gradient:"rainbow",ledDisplay:0,lumiBars:0,mode:Me,outlineBars:0,radial:0,randomMode:0,reflex:Ze,roundBars:0,showPeaks:1,showScaleX:gt,splitGrad:0}},{key:"radial",name:"Radial, Color by Level",options:{alphaBars:1,background:W,bandCount:"5",bgImageFit:ee,channelLayout:de,colorMode:pe,gradient:"prism",ledDisplay:0,lumiBars:0,mirror:0,mode:Me,outlineBars:0,radial:1,randomMode:0,showPeaks:1,splitGrad:0}},{key:"round",name:"Round Bars, Color by Index",options:{alphaBars:0,background:W,bandCount:"3",bgImageFit:ae,channelLayout:de,colorMode:fe,gradient:"apple",ledDisplay:0,lumiBars:0,mirror:0,mode:Me,outlineBars:0,radial:0,randomMode:0,reflex:Ye,roundBars:1,showPeaks:ze,splitGrad:0}},{key:Ke,name:"Last session",options:{}},{key:We,name:"Restore defaults",options:{alphaBars:0,ansiBands:0,background:W,bandCount:"6",barSpace:.2,bgImageDim:.3,bgImageFit:"1",channelLayout:de,colorMode:ue,fftSize:8192,fillAlpha:.3,freqMax:2e4,freqMin:20,freqScale:mt,gradient:"prism",gradientRight:"prism",ledDisplay:0,linearAmpl:1,lineWidth:1,linkGrads:0,loRes:0,lumiBars:0,micSource:0,mirror:0,mode:Ne,mute:0,noShadow:1,outlineBars:0,radial:0,radius:.5,randomMode:0,reflex:Je,repeat:0,roundBars:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:bt,showSong:1,showSubtitles:1,smoothing:.7,spin:2,splitGrad:0,volume:1,weighting:"D"}}],bn={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",colorStops:["#f00",{color:"#ff0",level:.85,pos:.6},{color:"#0f0",level:.475}],disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",colorStops:["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],disabled:!1},prism_old:{name:"Prism (legacy)",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"],disabled:!0},rainbow:{name:"Rainbow",dir:"h",colorStops:["#817","#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b","#639"],disabled:!1},rainbow_old:{name:"Rainbow (legacy)",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 47% )","hsl( 240, 100%, 58% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"],disabled:!0},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},gn=[[Me,"Bars"],[Ne,"FFT"],[Be,"Graph"]],vn=[[de,"Single"],[ce,"Comb"],["dual-horizontal","Horiz"],["dual-vertical","Vert"]],kn=[{value:dt,text:"User Presets",disabled:!0},{value:Qe,text:"Alpha",disabled:!1},{value:rt,text:"Analyzer Mode",disabled:!1},{value:et,text:"Background",disabled:!1},{value:at,text:"BG Image Fit",disabled:!1},{value:tt,text:"Band Count",disabled:!1},{value:nt,text:"Color Mode",disabled:!1},{value:ot,text:"Gradients",disabled:!1},{value:st,text:"LEDs",disabled:!1},{value:it,text:"Lumi",disabled:!1},{value:lt,text:"Outline",disabled:!1},{value:ct,text:"Peaks",disabled:!1},{value:ut,text:"Radial",disabled:!1},{value:ft,text:"Reflex",disabled:!1},{value:pt,text:"Round",disabled:!1},{value:ht,text:"Split",disabled:!1}],yn=[{min:-70,max:-20,boost:1},{min:-85,max:-25,boost:1.6},{min:-100,max:-30,boost:2.4}],wn=[Gt,ea,va,ja,Ua,rn],xn={info:5,track:10,end:10,covers:!0,count:!0,osdFontSize:"1"},Ln=[{value:Z,text:"Adjust",disabled:!1},{value:"1",text:"Center",disabled:!1},{value:ee,text:"Pulse",disabled:!1},{value:Q,text:"Repeat",disabled:!1},{value:te,text:"Warp",disabled:!1},{value:ae,text:"Warp Drive",disabled:!1},{value:ne,text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],En=[It,Mt,Nt,Xt,ta,la,xa,Sa,Fa,Ma,on],Sn={autoHide:!1,bgLocation:X,bgMaxItems:100,fsHeight:100,invertVol:!1,maxFPS:60,pipRatio:2.35,preserveFilenames:!1,saveDir:!0,saveQueue:!0,surround:!1},Cn=[[30,"30"],[60,"60"],[0,"unlimited"]],$n=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]],Tn=[Qt,ya,wa],_n={gravity:3.8,peakFade:750,peakHold:500},An=[pa,ha,Ia,Pa,en,tn,an,nn,cn],On={background:yt,color:wt,noDimVideo:!0,noDimSubs:!0,posAudio:"top",position:Et,reduceOnSubs:!1,reduceOnVideo:!0,videoFill:!0},In=[{value:"files_panel",text:"Media"},{value:"settings",text:"Settings"},{value:"advanced",text:"Advanced"},{value:"console",text:"Console"}];let Pn,Hn,Rn,Dn,Fn,Mn,Nn,Bn,qn,jn,Un,zn,Gn,Wn,Kn,Vn,Jn,Xn,Yn,Zn,Qn,eo,to,ao,no,oo,so,io,ro=[],lo=[],co=[],uo={},fo=null,po={},ho=!1,mo=0,bo=[],go=!1,vo=!1,ko=0;const yo=ga.getContext("2d"),wo=new Image,xo=document.createElement("video"),Lo=e=>"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,2)),Eo=e=>Math.round(100*e)/100,So=(e,t="")=>(e+"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g,t),Co=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},$o=e=>{let t=e.value??"";if(Ro(e)){const a=e.querySelector(":checked ~ label");a&&(t=a.textContent)}else"range"==e.type?t=yi(e):"SELECT"==e.tagName&&(t=e[e.selectedIndex].text);return t},To=e=>{let t=e.value;return e==Ht?t=9-t:Ro(e)?t=e.elements[e.dataset.prop].value:e.className.includes("switch")&&(t=e.dataset.active||0),""+t},_o=e=>({alphaBars:To(_t),ansiBands:To(Ot),background:To(Pt),bandCount:To(Ht),barSpace:To(Rt),bgImageDim:To(Dt),bgImageFit:To(Ft),channelLayout:To(Bt),colorMode:To(qt),fftSize:To(Wt),fillAlpha:To(Kt),freqMax:To(Aa),freqMin:To(Oa),freqScale:To(Jt),gradient:To(Yt),gradientRight:To(Zt),ledDisplay:To(aa),linearAmpl:To(na),lineWidth:To(oa),linkGrads:To(sa),loRes:To(ia),lumiBars:To(ra),mirror:To(da),mode:To(ua),noShadow:To(ma),outlineBars:To(ba),radial:To($a),radius:To(Ta),randomMode:To(_a),reflex:To(Ha),repeat:To(Ra),roundBars:To(Da),sensitivity:To(qa),showFPS:To(Vt),showPeaks:To(za),showScaleX:To(Na),showScaleY:To(Ba),showSong:To(Ga),showSubtitles:To(Wa),smoothing:To(Ka),spin:To(Za),splitGrad:To(Qa),weighting:To(fn)}),Ao=e=>{const t=+e==e?e:mn.findIndex((t=>t.key==e));return t<0||t>mn.length-1?-1:t},Oo=e=>{const t=Ao(e);return-1==t?{}:mn[t].options},Io=e=>{const t=Ao(e);return-1!=t&&mn[t].name},Po=()=>{const e=To(Bt)!=de&&!Bo(sa);return`Gradient${e?"s":""}: ${bn[Yt.value].name+(e?" / "+bn[Zt.value].name:"")}`},Ho=e=>e&&e.startsWith("blob:"),Ro=e=>"FORM"==e.tagName&&null!=e.dataset.prop,Do=e=>e.startsWith("http")&&!e.startsWith(M),Fo=e=>!e||"object"!=typeof e||!Object.keys(e).length,Mo=e=>jt.classList.contains("pip"),No=(e=ro[Hn])=>e&&e.currentTime>0&&!e.paused&&!e.ended,Bo=e=>!!+To(e),qo=e=>"number"!=e.type||+e.value>=+e.min&&+e.value<=+e.max,jo=(e=ro[Hn])=>ve.includes(Go(e.dataset.file).extension),Uo=e=>"string"==typeof e?e.replace(/\\/g,"/"):e,zo=e=>Bo(e)?"ON":"OFF",Go=e=>{if("string"!=typeof e)return{};const t=Uo(e),a=t.lastIndexOf("/")+1,n=t.slice(0,a),o=t.slice(a),s=o.lastIndexOf("."),i=s>=0?o.slice(0,s):o,r=s>=0?o.slice(s+1).toLowerCase():"";return{path:n,fileName:o,baseName:i,extension:r}},Wo=e=>{const t=/\s*\([0-9]{4}\)/;let a=(e=e.replace(/_/g," ")).match(t);a&&(a=a[0].trim(),e=e.replace(t,"").trim());const[,,n,o,,s,i]=e.match(/(^(-?\d+)([,\.\-\s]))?((.*?)\s+-\s+)?(.*)/);return{album:a,artist:s,title:i,duration:","==o?Xo(n):""}},Ko=e=>Ea.children.length,Vo=(e=2)=>Math.random()*e|0,Jo=e=>{zn?(0,P.hZ)(Ae,e):Kn&&Ks(Ae,e)},Xo=(e,t)=>{if(Math.abs(e)==1/0||"-1"===e)return"LIVE";let a="",n="",o="";return e<0&&(e=-e,n="-"),(e>=3600||t)&&(o=(e/3600|0)+":",e%=3600,a="0"),o+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),n+o},Yo=(e,t)=>{if(e==fa)ki(t);else if(e==Ya)oi(t);else if(e==dn)li(t);else if(e==Ht)e.value=9-t;else if(Ro(e)){const a=e.querySelector(`[value="${t}"]`);a&&(a.checked=!0)}else e.classList.contains("switch")?e.dataset.active=+t:(e.value=t,-1==e.selectedIndex&&(e.selectedIndex=0));xi(e==Jt?Ht:e)},Zo=(e,t,a,n=1)=>{e.min=t,e.max=a,e.step=n},Qo=(e,t)=>{void 0===t&&(t=!!e.style.display),e.style.display=t?"":"none"},es=e=>e.charAt(0).toUpperCase()+e.slice(1),ts=async e=>new Promise(((t,a)=>{e.onerror=()=>{e.onerror=e.onloadeddata=null,a()},e.onloadeddata=()=>{e.onerror=e.onloadeddata=null,fs("onLoadedData",{mediaEl:e.id.slice(-1)}),t()}}));function as(e,t=!1){const a=e.map((e=>ss(e,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${Ko()<j?"":". Queue is full!"}`;F().alert({text:a,time:5}),pi(!0)}))}function ns(e,t){const a=t.dataset,n=e.dataset,{album:o,artist:s,picture:i,title:r,year:l}=e.common||{},{bitrate:c,bitsPerSample:d,codec:u,codecProfile:f,container:p,duration:h,lossless:m,numberOfChannels:b,sampleRate:g}=e.format||{};if(n)Object.assign(a,n);else{a.artist=s||a.artist,a.title=r||a.title,a.album=o?o+(l?" ("+l+")":""):a.album,a.codec=u||p?(u||p)+" ("+b+"ch)":a.codec;const e=g?Math.round(g/1e3)+"kHz":"";if(a.quality=m||!c?(d?d+"bits":"")+(e&&d?" / ":"")+e:Math.round(c/1e3)+"kbps"+(f?" "+f:"")+(e?" / ":"")+e,a.duration=h?Xo(h):"",i&&i.length){const e=new Blob([i[0].data],{type:i[0].format});a.cover=URL.createObjectURL(e)}}t==ro[Hn]&&Zs()}function os(e,t){return new Promise((a=>{if(Ko()>=j)return void a(0);const{fileName:n,baseName:o,extension:s}=Go(function(e){return e.replace(/%2[356]/g,(e=>({"%23":"#","%25":"%","%26":"&"}[e])))}(e.file)),i=Uo(e.file),r=document.createElement("li"),l=r.dataset;Object.assign(l,oe),t||(t=Wo(o)),l.album=t.album||"",l.artist=t.artist||"",l.title=t.title||n||i.slice(i.lastIndexOf("//")+2),l.duration=t.duration||"",l.codec=t.codec||s.toUpperCase(),l.filename=n,l.file=i,r.handle=e.handle,r.dirHandle=e.dirHandle,r.subs=e.subs,Ea.appendChild(r),!me.includes(s)&&s||(l.retrieve=1,Us()),1!=Ko()||No()?(Bn==Ko()-2&&Cs(U),a(1)):Cs(0).then((()=>a(1)))}))}function ss(e,t=!1){let a;return a=ge.includes(Go(e.file).extension)?Ls(e):os(e),a.then((e=>{t&&!No()&&e>0&&Is(Ko()-e)})),a}function is(e){const t=+Xt.value;(1==e&&t<+Xt.max||-1==e&&t>+Xt.min)&&(Xt.value=t+Xt.step*e,ni(Xt)),Ys(`Analyzer height: ${Xt.value}%`)}function rs(e){let t=Eo((+dn.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),li(t),Ys("Volume: "+20*t),wi()}function ls(e=Hn){const t=e instanceof HTMLMediaElement?e:ro[e],a=t.dataset;ys(t,null),$s(t),Object.assign(a,oe),t.load(),e==Hn&&Zs()}function cs(e=Pn){const t=e.pixelRatio,a=ga.height=jt.clientHeight*t,n=ga.width=jt.clientWidth*t;Vn=Math.max(12,Math.min(n,a)/[24,17,13.5][+va.value]),Jn=3*Vn,Xn=n/2,Yn=n-Vn,Zn=1.4*Vn,Qn=1.8*Zn,no=n/3-Vn,eo=a-4*Vn,to=a-2.8*Vn,ao=a-1.6*Vn,oo=n-8*Vn,so=`bold ${.7*Vn}px sans-serif`,io=`bold ${Vn}px sans-serif`}function ds(e,t,a){const n=$t("#console-content"),o=new Date,s=o.toLocaleTimeString([],{hour12:!1})+"."+String(o.getMilliseconds()).padStart(3,"0");a&&(n.innerHTML="",Rn.classList.remove(le)),t&&Rn&&Rn.classList.add(le),e&&(n.innerHTML+=`<div ${t?'class="error"':""}>${s} &gt; ${e}</div>`),n.scrollTop=n.scrollHeight}function us(e,t){const a=Ro(e)?e.elements[e.dataset.prop]:e.options;let n=(Ro(e)?Array.from(a).findIndex((e=>e.checked)):e.selectedIndex)+(t?-1:1);n<0?n=a.length-1:n>=a.length&&(n=0),Ro(e)?a[n].checked=!0:e.selectedIndex=n,ni(e)}function fs(e,t){if(Ut.checked){if("object"==typeof e&&(t=e,e=""),t){e+=(e?", ":"")+"{ ";let a=0;for(const[n,o]of Object.entries(t))e+=(a?", ":"")+n+": "+o,a++;e+=" }"}ds(e)}}function ps(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function hs(e,t){const a=document.createElement("a");a.setAttribute("href",Lo(e)),a.setAttribute("download",`${t}.json`),a.click()}function ms(e,t){if(Fo(Gn[e]))return;const a=`User Preset #${e+1}`,n=Gn[e].name?"<br>"+Gn[e].name:"";t?(Gn[e]={},Ks(xe,Gn),F().alert({text:`Deleted ${a}`}),Fs()):F().confirm({text:`Do you really want to DELETE ${a}?${n}<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{ms(e,!0)},cancelCallback:()=>{F().alert({text:"Canceled!"})}})}function bs(e=1){const t=ro[Hn];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),Ys(1),t.currentTime=a}"m"==ho&&Js("m",e)}function gs(){return clearTimeout(Dn),!!ho&&(ho=!1,!0)}async function vs(){Mo()&&await document.exitPictureInPicture(),Pn.toggleFullscreen(),document.activeElement.blur()}function ks(e){if(e.altKey||e.ctrlKey||e.metaKey)return;const t=e.shiftKey;if("F1"==e.code&&!t)return location.href="#help",void e.preventDefault();if("BODY"==e.target.tagName){if("keydown"==e.type)switch(e.code){case"ArrowUp":t?is(1):rs(1);break;case"ArrowDown":t?is(-1):rs(-1);break;case"ArrowLeft":ho?(Ys("Rewind",1),bs(-1)):Js("k",-1);break;case"ArrowRight":ho?(Ys("Fast forward",1),bs()):Js("k");break;default:return}else if(e.code.match(/^(Digit|Numpad)[0-9]$/)){const a=e.code.slice(-1)-1;if(-1==a)t||(Ns(!0),ni(_a,!1));else if(t){const e=_o();e.randomMode=0,Vs(a,e)}else Es(a)}else switch(e.code){case"Delete":case"Backspace":Ea.querySelectorAll(".selected").forEach((e=>{zs(e),e.remove()}));const e=Co(Ea.querySelector(".current"));void 0!==e?vi(e):Bn>Ko()-1?vi(Ko()-1):vi(Bn-1),Ko()?Cs(U):(ls(Mn),No()||ls()),pi(!0);break;case"Space":Ys(No()?"Pause":"Play",1),As();break;case"ArrowLeft":case"KeyJ":gs()||t||(Ys("Previous track",1),ui(!0));break;case"KeyG":us(Yt,t),Ys(Po());break;case"ArrowRight":case"KeyK":gs()||t||(Ys("Next track",1),ui());break;case"KeyA":us(_a,t),Ys("Randomize: "+$o(_a)),ni(_a);break;case"KeyB":us(t?Ft:Pt);const a=Pt.value[0];Ys("Background: "+$o(Pt)+(a>1&&a<7?` (${$o(Ft)})`:""));break;case"KeyC":$a.click(),Ys("Radial "+zo($a));break;case"KeyD":bi();break;case"KeyE":Ko()>0&&(di(),Ys("Shuffle"));break;case"KeyF":vs();break;case"KeyH":Vt.click();break;case"KeyI":Ga.click(),Ys("Song info display "+zo(Ga));break;case"KeyL":aa.click(),Ys("LED effect "+zo(aa));break;case"KeyM":case"KeyV":us(ua,t),Ys("Mode: "+$o(ua));break;case"KeyN":us(qa,t),Ys($o(qa).toUpperCase()+" sensitivity");break;case"KeyO":ia.click(),Ys((Bo(ia)?"LOW":"HIGH")+" Resolution");break;case"KeyP":us(za,t),Ys("Peaks "+$o(za));break;case"KeyR":Ra.click(),Ys("Queue repeat "+zo(Ra));break;case"KeyS":const n=["None","Frequencies","Musical Notes",,"Level"],o=function(e){e=-2*e+1;let t=+To(Na)+(+To(Ba)<<2)+e;return t<0?t=6:3==t?t+=e:t>6&&(t=0),Yo(Na,3&t),Yo(Ba,t>>2),ni([Na,Ba]),t}(t);Ys("Scale labels: "+(o<5?n[o]:n[o-4]+" + "+n[4]));break;case"KeyT":ma.click(),Ys((Bo(ma)?"Flat":"Shadowed")+" text mode");break;case"KeyU":ra.click(),Ys("Luminance bars "+zo(ra));break;case"KeyX":us(Ha,t),Ys("Reflex: "+$o(Ha));break;default:return}e.preventDefault()}}function ys(e,t){const a=e.src||"";Ho(a)&&URL.revokeObjectURL(a),t?e.src=t:e.removeAttribute("src"),ti()}async function ws(e,t,a){const n=URL.createObjectURL(e);ys(t,n);try{await ts(t),a&&t.play()}catch(e){}return n}function xs(e){return JSON.parse(localStorage.getItem(e))}function Ls(e){let t=Uo(e.file);return new Promise((async a=>{let n=[];const o=e=>{Promise.all(n).then((t=>{const n=t.reduce(((e,t)=>e+t),0);a(n),e&&pi(!0)}))},s=async e=>{let a,s;t=Go(t).path;for(let o of e.split(/[\r\n]+/))if("#"!=o.charAt(0)&&""!=o.trim()){let e,i;if(o=Uo(o),s||(s=Go(o).baseName),!Do(o)){if(zn&&(({handle:e,dirHandle:i}=await _(o)),!e)){ds(`Cannot resolve file handle for ${o}`,!0),s="";continue}o=S(o),":"!=o[1]&&"/"!=o[0]&&(o=t+o)}n.push(os({file:o,handle:e,dirHandle:i},{...Wo(s),...a?{album:a}:{}})),s=""}else o.startsWith("#EXTINF")?s=o.slice(8):o.startsWith("#EXTALB")&&(a=o.slice(8));o()};if(t)if("string"==typeof t&&ge.includes(Go(t).extension))e.handle?e.handle.getFile().then((e=>e.text())).then(s).catch((e=>{ds(e,!0),a(0)})):fetch(t).then((e=>e.ok?e.text():(ds(`Fetch returned error code ${e.status} for URI ${t}`,!0),""))).then(s).catch((e=>{ds(e,!0),a(0)}));else{const e=await(0,P.Jt)(!0===t?He:Fe+t);Array.isArray(e)?(e.forEach((e=>{const{file:t,handle:a,dirHandle:o,subs:s,content:i}=e;n.push(os({file:t,handle:a,dirHandle:o,...a&&!o?{subs:s}:{}},i))})),o(e!=He)):(!0!==t&&ds(`Unrecognized playlist file: ${t}`,!0),a(0))}else a(-1)}))}function Es(e,t=!0,a,n){const o=+e==e,s="object"==typeof e,i=s?e:o?Gn[e].options:Oo(e),r=Oo(We);Fo(i)||(t&&!s&&ds("Loading "+(o?"User Preset #"+(+e+1):"'"+Io(e)+"' preset")),e==We&&delete i.volume,void 0!==i.stereo&&(i.channelLayout=vn[+i.stereo][0]),1.5==i.barSpace&&(i.barSpace=1),+i.fadePeaks&&+i.showPeaks&&(i.showPeaks=Ge),i.mode==qe&&(i.mode=Be),[Ne,Me,Be].includes(i.mode)||(i.bandCount=i.mode,i.mode=Me),+i.noteLabels&&+i.showScaleX&&(i.showScaleX=gt),Tt("[data-prop]").forEach((e=>{const t=e.dataset.prop,o=void 0!==i[t]?i[t]:a?r[t]:void 0;void 0===o||e==_a&&n||Yo(e,o)})),Pn.setOptions({alphaBars:Bo(_t),ansiBands:+To(Ot),colorMode:To(qt),fftSize:To(Wt),fillAlpha:To(Kt),frequencyScale:To(Jt),ledBars:Bo(aa),linearAmplitude:+To(na),lineWidth:To(oa),loRes:Bo(ia),lumiBars:Bo(ra),maxFPS:To(la),maxFreq:To(Aa),minFreq:To(Oa),mirror:To(da),outlineBars:Bo(ba),peakFadeTime:To(ya),peakHoldTime:To(wa),radial:Bo($a),radius:To(Ta),roundBars:Bo(Da),showFPS:Bo(Vt),showScaleY:+To(Ba),smoothing:To(Ka),spinSpeed:To(Za),splitGradient:Bo(Qa),weightingFilter:To(fn)}),ni([Pt,Ft,Dt,Bt,za,Qt,sa,qa,Ha,Yt,Zt,...n?[]:[_a],Rt,Wa,Na,ua]),"demo"==e&&Ns(!0),t&&F().alert({text:"Settings loaded!"}))}async function Ss(e){ps(La);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,La.options[La.options.length]=t;let a=await(0,P.Jt)(Pe);const n=xs(Pe);if(n){for(const e of Object.keys(n)){const t=Fe+e,o=xs(t);let s=[];for(const e of o)s.push({file:e});await(0,P.hZ)(t,s),Bs(t),a[e]=n[e]}await(0,P.hZ)(Pe,a),Bs(Pe)}if(a){const t=Object.keys(a),n=new Intl.Collator;t.sort(((e,t)=>n.compare(a[e],a[t])));for(const n of t){const t=new Option(a[n],n);n==e&&(t.selected=!0),La.options[La.options.length]=t}}}async function Cs(e,t){const a=e!==U||t,n=e!==U?e:Bn<Ko()-1?Bn+1:0,o=a?Hn:Mn,s=ro[o],i=Ea.children[n];fs("loadSong start",{n:e,index:n,mediaEl:o}),a||si();let r=!1;if(i){if(a&&vi(n),ns(i,s),$s(s,i),i.handle)try{await i.handle.requestPermission();const e=await i.handle.getFile();await ws(e,s,t),r=!0}catch(e){ds(`Error loading ${i.dataset.file}`,!0),ls(s)}else{ys(s,i.dataset.file);try{await ts(s),t&&s.play(),r=!0}catch(e){}}!r&&t?Cs(U,t):a&&Cs(U),i.classList.toggle("error",!r)}return a||(vo=!1),fs("loadSong end",{n:e,index:n,mediaEl:o,success:r}),r}async function $s(e,t){const a=e.querySelector("track");Ho(a.src)&&URL.revokeObjectURL(a.src);let{subs:n}=t||{};if(t&&!n&&Bo(Wa)&&!Do(t.dataset.file)){const{path:e,baseName:a}=Go(t.dataset.file);let o;if(!t.dirHandle&&t.handle||(o=await T(e,t.dirHandle)),o){const e=o.files.find((e=>e.name.startsWith(a)));e&&e.subs&&(n=e.subs,t.subs=n)}}if(n){const{src:e,lang:t,handle:o}=n;a.srclang=t||navigator.language,o?o.getFile().then((e=>a.src=URL.createObjectURL(e))).catch((e=>{})):a.src=e}else a.removeAttribute("src"),a.removeAttribute("srclang")}function Ts(e){e?(fo.name+=" (copy)",fo.key=""):fo={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:""},qs(),Qo($t("#btn-delete-gradient"),!1),Qo($t("#btn-save-gradient"),!0),Qo($t("#btn-export-gradient"),!1),Qo($t("#btn-save-gradient-copy"),!1),location.href="#gradient-editor"}function _s(e){if(fs("playNextSong",{play:e,queueIndex:Bn,skipping:vo}),vo||Ya.checked||Bn>Ko()-1)return!0;if(vo=!0,Bn<Ko()-1)vi(Bn+1);else{if(!Bo(Ra))return vo=!1,!1;vi(0)}e|=No(),[Hn,Mn]=[Mn,Hn],ti(),Zs();const t=ro[Hn];return e&&t.src?t.play().then((()=>Cs(U))).catch((t=>{t.code!=he&&(ds(t,!0),Cs(U,e))})):Cs(U),!0}function As(e){Ya.checked||(No()&&!e?(ro[Hn].pause(),Mo()&&xo.pause()):ro[Hn].play().catch((e=>{e.code!=he&&(ds(e,!0),_s(!0))})))}function Os(){let e=!0;return No()?ro[Hn].currentTime>2?ro[Hn].currentTime=0:Bn>0?Is(Bn-1):e=!1:e=Cs(Bn-1),e}function Is(e){Cs(e,!0)}function Ps(){let e=[{value:W,text:"Album cover"},{value:G,text:"Black"},{value:z,text:"Gradient default"}];const t=e.length,a=lo.length,n=co.length;e=[...e,...lo.map(((e,t)=>({value:K+e.name,text:"🖼️ "+e.name,idx:t}))),...co.map(((e,t)=>({value:V+e.name,text:"🎬 "+e.name,idx:t})))].slice(0,t+ +Nt.value),n&&e.splice(t,0,{value:V,text:"Random video"}),a&&e.splice(t,0,{value:K,text:"Random image"}),Ms(Pt,e)}function Hs(e,t,a){a||(a=e.dataset.prop);const n=!Array.isArray(t[0]);for(const o of n?t.filter((e=>!e.disabled)):t){const t=o.text||o[1],n=o.value||o[0],s=a+"-"+n,i=document.createElement("input"),r=document.createElement("label");i.name=a,i.id=s,i.type="radio",i.value=n,r.htmlFor=s,r.innerText=t,e.append(i,r)}}function Rs(){const e=$t("#enabled_gradients"),t=Object.keys(bn),a=new Intl.Collator;t.sort(((e,t)=>a.compare(bn[e].name,bn[t].name))),ps(e),t.forEach((t=>{e.innerHTML+=`<label>\n\t\t\t\t<input type="checkbox" class="enabledGradient" data-grad="${t}" ${bn[t].disabled?"":"checked"}>\n\t\t\t\t${bn[t].name}<a href="#" data-grad="${t}" class="grad-edit-link" title="edit"></a>\n\t\t\t</label>`})),Tt(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(bn).reduce(((e,t)=>e+!bn[t].disabled),0)<2)return F().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;bn[e.dataset.grad].disabled=!e.checked,Ds(),Ws(Ee)}))})),Tt(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{var t;e.preventDefault(),function(e){if(!bn[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=(e,t,a)=>{const n=t*Math.min(a,1-a),o=(t,o=(t+e/30)%12)=>a-n*Math.max(Math.min(o-3,9-o,1),-1);let s="#";for(const e of[0,8,4])s+=Math.round(255*o(e)).toString(16).padStart(2,"0");return s},a=e=>e.match(/\(\s+(.*),\s+(.*?)%?,\s+(.*?)%?\s+\)/).slice(1),n=bn[e],o={...n};o.colorStops=[];for(const e of n.colorStops){if(e.color.startsWith("rgb")){const{color:t}=e;e.color="#";for(const n of a(t))e.color+=(+n).toString(16).padStart(2,"0")}else if(e.color.startsWith("hsl")){const[n,o,s]=a(e.color);e.color=t(n,o/100,s/100)}else if(4==e.color.length){const[t,a,n,o]=e.color;e.color="#"+a+a+n+n+o+o}o.colorStops.push({...e})}fo=o}(t=e.target.getAttribute("data-grad")),qs(),Qo($t("#btn-delete-gradient"),!!bn[t].key),Qo($t("#btn-save-gradient"),!!bn[t].key),Qo($t("#btn-export-gradient"),!0),Qo($t("#btn-save-gradient-copy"),!0),location.href="#gradient-editor"}))}))}function Ds(){const e=Object.keys(bn),t=new Intl.Collator;e.sort(((e,a)=>t.compare(bn[e].name,bn[a].name)));for(const t of[Yt,Zt]){let a=t.value;ps(t);for(const a of e)bn[a].disabled||(t.options[t.options.length]=new Option(bn[a].name,a));""!==a&&(t.value=a,ni(t))}}function Fs(){const e=(e,t)=>{const a=document.createElement("optgroup");a.label=e;for(const[e,n]of t)a.appendChild(new Option(n,e));Ca.appendChild(a)};ps(Ca),Ca.appendChild(new Option("Select a preset to load",""));const t=Gn.map(((e,t)=>[t,e.name?`[${t+1}] ${e.name}`:""])).filter((([e,t])=>!!t));t.length&&e("User Presets",t),e("Built-in Presets",mn.filter((e=>![Ke,We].includes(e.key))).map((e=>[e.key,e.name])))}function Ms(e,t){const a=e.value;Array.isArray(t)||(t=[t]),ps(e);for(const a of t.filter((e=>e&&!e.disabled))){const t=new Option(a.text||a[1],a.value||a[0]);null===a[0]&&(t.disabled=!0),void 0!==a.idx&&(t.idx=a.idx),e[e.options.length]=t}""!==a&&(e.value=a,-1==e.selectedIndex&&(e.selectedIndex=0),ni(e))}function Ns(e=Ya.checked){if(!No()&&!e)return;const t=e=>!kn.find((t=>t.value==e)).disabled,a=(e,t=()=>!0)=>{let a=9;do{if(Ro(e)){const t=e.elements[e.dataset.prop];t[Vo(t.length)].checked=!0}else if(void 0!==e.dataset.active)e.dataset.active=Vo();else if(e.step){const{min:t,max:a,step:n}=e,o=Vo((a-t)/n+1)*n+ +t;Yo(e,(10*o|0)/10)}else e.selectedIndex=Vo(e.options.length)}while(!t(To(e))&&a--);ni(e)};if(t(dt)){const e=Gn.map(((e,t)=>Fo(e)?null:t)).filter((e=>null!==e)),t=e.length;t&&Es(e[Vo(t)],!1,!1,!0)}if(t(rt)&&a(ua),t(Qe)&&a(_t),t(et)&&a(Pt),t(tt)&&a(Ht),t(at)&&a(Ft),t(nt)&&a(qt),t(ct)&&a(za),t(st)&&a(aa),t(it)&&a(ra,(e=>!+e||!Pn.overlay||!Bo(aa))),t(lt)&&a(ba),t(ft)&&a(Ha,(e=>e!=Ye||!Bo(aa))),t(ut)&&a($a),t(pt)&&a(Da),t(ht)&&a(Qa),t(ot))for(const e of[Yt,...Bo(sa)?[]:[Zt]])a(e)}function Bs(e){localStorage.removeItem(e)}function qs(){if(null==fo)throw new Error("Current gradient must be set before editing gradient");const e=$t("#grad-color-table");ps(e),$t("#new-gradient-name").value=fo.name,$t("#new-gradient-horizontal").checked="h"===fo.dir;const t=$t("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),fo.colorStops.forEach(((e,t)=>{!function(e,t){const a=$t("#grad-color-table"),n=$t("#grad-row-template").cloneNode(!0),o=n.querySelector(".grad-color-picker"),s=n.querySelector(".grad-color-value"),i=n.querySelector(".grad-color-stop"),r=n.querySelector(".grad-add-stop"),l=n.querySelector(".grad-remove-stop");o.value=t.color,s.value=t.color,i.value=t.pos,o.addEventListener("input",(t=>{s.value=t.target.value,fo.colorStops[e].color=o.value})),s.addEventListener("input",(t=>{o.value=t.target.value,fo.colorStops[e].color=o.value})),i.addEventListener("input",(t=>{fo.colorStops[e].pos=parseFloat(t.target.value)})),r.addEventListener("click",(()=>{fo.colorStops.splice(e+1,0,{pos:(()=>{if(e===fo.colorStops.length-1){const e=fo.colorStops[fo.colorStops.length-1].pos;return fo.colorStops[fo.colorStops.length-1].pos=(fo.colorStops[fo.colorStops.length-2].pos+e)/2,e}return(fo.colorStops[e].pos+fo.colorStops[e+1].pos)/2})(),color:"#111111"}),qs()})),2===fo.colorStops.length?l.setAttribute("disabled","true"):l.addEventListener("click",(()=>{fo.colorStops.splice(e,1),qs()})),n.removeAttribute("id"),a.appendChild(n)}(t,fo.colorStops[t])})),$t("#new-gradient-bkgd").value=fo.bgColor}async function js(){const e=Mt.value,t=new RegExp("\\.("+be.join("|")+")$","i"),a=new RegExp("\\.("+ve.join("|")+")$","i");if(lo=[],co=[],e==X)try{const e=await fetch(B),n=await e.text();for(const{url:e,file:o}of A(n)){const n=Go(o).baseName;t.test(o)?lo.push({name:n,url:B+e}):a.test(o)&&co.push({name:n,url:B+e})}}catch(e){}else if(e==Y){const e=await(0,P.Jt)(ye);try{if(e)for await(const[n,o]of e.entries())if(o instanceof FileSystemFileHandle){const e=t.test(n),s=a.test(n);if(e||s){const t=await o.getFile(),a=URL.createObjectURL(t);e?lo.push({name:n,url:a}):co.push({name:n,url:a})}}}catch(e){}}if(e!=J){const e=lo.length,t=co.length;ds("Found "+(e+t==0?"no media":e+" image files and "+t+" video")+" files in the backgrounds folder")}Ps()}async function Us(){if(ko>=q)return;const e=Array.from(Ea.children).find((e=>e.dataset.retrieve));if(e){let t=e.dataset.file,a=!1;ko++,delete e.dataset.retrieve;e:{if(e.handle)try{if("granted"!=await e.handle.requestPermission())break e;t=URL.createObjectURL(await e.handle.getFile()),a=!0}catch(e){break e}try{const a=await I.WC(t,{skipPostHeaders:!0});a&&(ns(a,e),hi(e),a.common.picture&&a.common.picture.length||async function(e){const{path:t}=Go(e.dataset.file),{dirHandle:a}=e;if(!Kn||Do(t))return"";if(void 0!==po[t])return po[t];{if(e.handle&&!a)return"";let n="";try{const e=await T(t,a);if(e&&e.cover){const{handle:a,name:o}=e.cover;if(a){const e=await a.getFile();n=URL.createObjectURL(e)}else n=t+o}}catch(e){}return po[t]=n,n}}(e).then((t=>{e.dataset.cover=t,hi(e)})))}catch(e){}a&&URL.revokeObjectURL(t)}ko--,Us()}}function zs(e){const t=e.dataset.cover;Ho(t)&&URL.revokeObjectURL(t)}function Gs(e){if(null!==fo){if(!fo.key||e){let t=e&&fo.key||So(fo.name);fo.key=t;let a=1;for(;Object.keys(bn).some((e=>e===fo.key))&&a<1e3;)fo.key=`${t}-${a}`,a++;for(a=1;Object.keys(bn).some((e=>bn[e].name===fo.name))&&a<1e3;)fo.name+=` (${a})`,a++}bn[fo.key]=fo,Pn.registerGradient(fo.key,fo),Ds(),Rs(),Ws(we),fo=null,location.href="#config"}}function Ws(e){const t=e=>e.map((({value:e,disabled:t})=>({value:e,disabled:t})));if(e&&e!=Le||Ks(Le,t(Ln)),e&&e!=Ee||Ks(Ee,Object.keys(bn).map((e=>({value:e,disabled:bn[e].disabled})))),!e||e==we){const e={};Object.keys(bn).filter((e=>bn[e].key)).forEach((t=>e[t]=bn[t])),Ks(we,e)}if(e&&e!=Se||Ks(Se,t(kn)),!e||e==Re){let e=[];for(const t of[0,1,2])e.push({min:$t(`.min-db[data-preset="${t}"]`).value,max:$t(`.max-db[data-preset="${t}"]`).value,boost:$t(`.linear-boost[data-preset="${t}"]`).value});Ks(Re,e)}if(!e||e==Ce){const e={info:ea.value,track:rn.value,end:Gt.value,covers:Ua.checked,count:ja.checked,osdFontSize:va.value};Ks(Ce,e)}if(!e||e==Te){const e={autoHide:It.checked,bgLocation:Mt.value,bgMaxItems:Nt.value,fsHeight:Xt.value,invertVol:ta.checked,maxFPS:la.value,pipRatio:xa.value,preserveFilenames:Sa.checked,saveDir:Fa.checked,saveQueue:Ma.checked,surround:on.checked};Ks(Te,e)}if(!e||e==Ie){const e={gravity:Qt.value,peakFade:ya.value,peakHold:wa.value};Ks(Ie,e)}if(!e||e==De){const e={background:en.value,color:tn.value,noDimSubs:pa.checked,noDimVideo:ha.checked,position:an.value,posAudio:nn.value,reduceOnSubs:Ia.checked,reduceOnVideo:Pa.checked,videoFill:cn.checked};Ks(De,e)}}function Ks(e,t){localStorage.setItem(e,JSON.stringify(t))}function Vs(e,t,a,n){const o=`User Preset #${e+1}`,s=Gn[e].name||"",i=Pn.isFullscreen;if(!Fo(Gn[e])&&!n&&go!==e)return void(i?(Ys(`Overwrite ${o} - Press again to confirm!`,5),go=e,setTimeout((()=>{go===e&&(go=!1)}),5e3)):F().confirm({text:`Do you really want to overwrite ${o}?<br>${s}`,submitText:"Overwrite",submitCallback:()=>{Vs(e,t,a,!0)},cancelCallback:()=>{F().alert({text:"Canceled!"})}}));if(go=!1,!a||!`${a}`.trim()){if(!i)return void F().input({text:"Give this preset a name or short description",submitText:"Save",value:s,maxlength:40,submitCallback:a=>{Vs(e,t,a.trim()||Ve,!0)},cancelCallback:()=>{F().alert({text:"Save canceled!"})}});a=""}a==Ve&&(a=""),Gn[e]={name:a,options:t},Ks(xe,Gn);const r=`Saved to ${o}`;i?Ys(r,5):F().alert({text:r}),Fs()}function Js(e,t=1){Dn=setTimeout((()=>{ho=e,bs(t)}),200)}function Xs(e){document.documentElement.style.setProperty("--background-image",e?`url('${e.replace(/['()]/g,"\\$&")}')`:"none")}function Ys(e,t=2,a=-1){if(e){const n=performance.now(),o=n+1e3*t;e==+e?(uo.info=e,uo.startTime=n,uo.endTime=Math.max(o,uo.endTime||0),uo.fade=t==1/0?0:t/3*a):(uo.msg=e,2==uo.info&&(uo.info=1),uo.msgTimer=o)}else uo={endTime:0,msgTimer:0}}function Zs(){wo.src=ro[Hn].dataset.cover,Pt.value==W&&Xs(wo.src)}function Qs(e){It.checked=e.autoHide,Mt.value=e.bgLocation,Nt.value=e.bgMaxItems,Xt.value=e.fsHeight,ta.checked=e.invertVol,la.value=e.maxFPS,xa.value=e.pipRatio,Sa.checked=e.preserveFilenames,Fa.checked=e.saveDir,Ma.checked=e.saveQueue,on.checked=e.surround}function ei(e){ea.value=e.info,rn.value=e.track,Gt.value=e.end,va.value=e.osdFontSize,Ua.checked=e.covers,ja.checked=e.count}function ti(){const e=Pt.value[0],t=Bo(Wa)&&!!ro[Hn].querySelector("track").src,a=jo(),n=a||t||e!=z&&e!=G,o=Pa.checked&&a||Ia.checked&&t;for(const e of ro)Qo(e,(a||t)&&e==ro[Hn]);return Pn.overlay=n,Pn.showBgColor=!a&&e==z,jt.style.backgroundImage=a?"none":"var(--background-image)",Qo(ln,e==V&&!a),Qo(zt,!(a&&ha.checked||t&&pa.checked)),At.classList.toggle(se,o),jt.classList.toggle(se,o),n}function ai(e){Qt.value=e.gravity,ya.value=e.peakFade,wa.value=e.peakHold}function ni(e,t=!0){Array.isArray(e)||(e=[e]);const a=()=>Qo(Zt,To(Bt)!=de&&!Bo(sa));for(const n of e){switch(n){case _t:Pn.alphaBars=Bo(_t);break;case Ot:Pn.ansiBands=+To(Ot);break;case It:mi(!0);break;case Pt:const e=Pt.value[0],o=Pt[Pt.selectedIndex].idx,s=ti();if(e==V){Xs();const e=co[void 0===o?Vo(co.length):o].url;try{decodeURIComponent(ln.src).endsWith(decodeURIComponent(e))||(ln.src=e)}catch(t){ln.src=e}}else s&&![z,G].includes(e)?Xs(e==W?wo.src:lo[void 0===o?Vo(lo.length):o].url):Xs();break;case Ht:Yo(ua,To(Ht)),ni(ua,!1);break;case Rt:const i=To(Rt);Pn.barSpace=Pn.isLumiBars||1==i?1.5:i;break;case Ft:const r=Ft.value,l=r==te||r==ae||r==ne;jt.classList.toggle("repeat",r==Q),jt.classList.toggle("cover",r==Z||l),jt.style.backgroundSize="",Qo(un,l),un.classList.toggle("rotating",r==ne),un.classList.toggle("paused",r==te);break;case Dt:zt.style.background=`rgba(0,0,0,${1-Dt.value})`;break;case Mt:Mt.value==Y?window.showDirectoryPicker({startIn:"pictures"}).then((e=>{(0,P.hZ)(ye,e)})).catch((e=>{Mt.value=J,(0,P.yH)(ye)})).finally((()=>js())):((0,P.yH)(ye),js());break;case Nt:Ps();break;case Bt:Pn.channelLayout=To(Bt),a();break;case qt:Pn.colorMode=To(qt);break;case Kt:Pn.fillAlpha=Kt.value;break;case Wt:Pn.fftSize=To(Wt),ds("FFT size is "+Pn.fftSize+" samples");break;case Vt:Pn.showFPS=Bo(Vt);break;case Jt:Pn.frequencyScale=To(Jt),xi(Ht);break;case Xt:At.style.height=`${Xt.value}%`;break;case Yt:case Zt:""===n.value&&(n.selectedIndex=0),Bo(sa)?Pn.gradient=Yt.value=Zt.value=n.value:Pn[n==Yt?"gradientLeft":"gradientRight"]=n.value;break;case aa:Pn.ledBars=Bo(aa);break;case na:Pn.linearAmplitude=+To(na);break;case oa:Pn.lineWidth=oa.value;break;case sa:a(),Bo(sa)&&ni(Yt,!1);break;case ia:Pn.loRes=Bo(ia);break;case ra:Pn.lumiBars=Bo(ra),ni(Rt,!1);break;case la:Pn.maxFPS=la.value;break;case da:Pn.mirror=To(da);break;case ua:const c=To(ua);Pn.mode=c==Me?To(Ht):c,ni(Rt,!1);break;case fa:ki();break;case pa:case ha:ti();break;case va:cs();break;case ba:Pn.outlineBars=Bo(ba);break;case Qt:Pn.gravity=Qt.value;break;case ya:Pn.peakFadeTime=ya.value;break;case wa:Pn.peakHoldTime=wa.value;break;case xa:Mo()&&(Pn.width=Pn.height*xa.value);break;case Sa:Ea.classList.toggle(re,Sa.checked);break;case $a:Pn.radial=Bo($a),ni(Rt,!1);break;case Ta:Pn.radius=To(Ta);break;case _a:const d=_a.value;qn&&(qn=clearInterval(qn)),d>1&&(qn=setInterval(Ns,2500*d));break;case Oa:case Aa:for(;+Aa.value<=+Oa.value;)Aa.selectedIndex++;Pn.setFreqRange(Oa.value,Aa.value);break;case Ia:case Pa:ti();break;case Ha:switch(To(Ha)){case Ze:Pn.reflexRatio=.25,Pn.reflexAlpha=.2;break;case Xe:Pn.reflexRatio=.4,Pn.reflexAlpha=.2;break;case Ye:Pn.reflexRatio=.5,Pn.reflexAlpha=1;break;default:Pn.reflexRatio=0}break;case Da:Pn.roundBars=Bo(Da);break;case Fa:Fa.checked?Jo(g):((0,P.yH)(Ae),Bs(Ae));break;case Ma:Ma.checked?pi(!0):(0,P.yH)(He);break;case Na:Pn.showScaleX=To(Na)!=bt,Pn.noteLabels=To(Na)==gt;break;case Ba:Pn.showScaleY=+To(Ba);break;case qa:const u=To(qa);Pn.setSensitivity($t(`.min-db[data-preset="${u}"]`).value,$t(`.max-db[data-preset="${u}"]`).value),Pn.linearBoost=$t(`.linear-boost[data-preset="${u}"]`).value;break;case za:Pn.showPeaks=To(za)!=ze,Pn.fadePeaks=To(za)==Ge;break;case Wa:si();break;case Ka:Pn.smoothing=Ka.value,ds("smoothingTimeConstant is "+Pn.smoothing);break;case Ya:const f=Ya.checked;t=!1,oi(f,(e=>{f&&e?(Wn=fa.checked,ki(!0)):f||ki(!!Wn),wi()}));break;case Za:Pn.spinSpeed=Za.value;break;case Qa:Pn.splitGradient=Bo(Qa);break;case en:case tn:jt.className=jt.className.replace(new RegExp(`(${xt}|${Lt})\\S*`,"gi"),""),jt.classList.add(xt+en.value,Lt+tn.value);break;case nn:case an:ri();break;case on:gi();break;case cn:jt.classList.toggle(ie,!cn.checked);break;case fn:Pn.weightingFilter=To(fn)}t&&(En.includes(n)?Ws(Te):wn.includes(n)?Ws(Ce):Tn.includes(n)?Ws(Ie):An.includes(n)?Ws(De):wi())}}async function oi(e,t){Ya.checked=e,e?navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{Fn=Pn.audioCtx.createMediaStreamSource(e),No()&&ro[Hn].pause(),Pn.connectInput(Fn),ds("Audio source set to microphone")})).catch((e=>{ds(`Could not change audio source - ${e}`,!0),Ya.checked=!1})).finally((()=>{t&&t(Ya.checked)})):(ds("Cannot access user microphone",!0),Ya.checked=!1,t&&t(!1)):(Fn&&(Pn.disconnectInput(Fn),Fn.mediaStream.getTracks()[0].stop(),Fn=null),ds("Audio source set to built-in player"),t&&t(!0))}function si(){for(const e of ro)e.textTracks[0].mode="hidden",Bo(Wa)&&(e.textTracks[0].mode="showing");ti()}function ii(e){pa.checked=e.noDimSubs,ha.checked=e.noDimVideo,Ia.checked=e.reduceOnSubs,Pa.checked=e.reduceOnVideo,en.value=e.background,tn.value=e.color,an.value=e.position,nn.value=e.posAudio,cn.checked=e.videoFill}function ri(e){const t=e?[e.target]:Tt("track");for(const e of t){let t,a,n=!1;switch((jo(e.parentElement)?an:nn).value){case Et:t="end",a=95;break;case St:t="center",a=50;break;default:t="start",a=1,n=!0}for(const o of e.track.cues)o.line=a,o.snapToLines=n,o.lineAlign=t}}function li(e){dn.dataset.value=e,Pn.volume=e**2.5,dn.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function ci(){let e;jt.addEventListener("mouseenter",(()=>{It.checked&&!Pn.isFullscreen&&(e=setTimeout((()=>mi(!1)),500))})),jt.addEventListener("mouseleave",(()=>clearTimeout(e))),sn.addEventListener("click",(()=>{mi(),sn.blur()})),jt.addEventListener("transitionend",(()=>{if(jt.style.height)for(const e of In)Qo($t(`#${e.value}`),!1);document.body.style.overflowY=window.innerHeight<hn?"scroll":""}));const t=ka.panel;let a;t.forEach((e=>{e.addEventListener("click",(a=>{t.forEach((e=>$t(`#${e.value}`).classList.toggle("active",e==a.target))),mi(!0),"console"==e.value&&(Rn.classList.remove(le),ds())}))})),$t(`#panel-${In[0].value}`).checked=!0,ca.classList.add("active"),$t("#console-clear").addEventListener("click",(()=>ds("Console cleared.",!1,!0))),$t("#console-copy").addEventListener("click",(()=>{let e="";for(const t of Tt("#console-content div"))e+=t.innerText+"\n";navigator.clipboard&&navigator.clipboard.writeText(e).then((()=>ds("Console messages copied to clipboard"))).catch((e=>ds(e,!0)))})),Ut.addEventListener("click",(()=>ds("Debug "+(Ut.checked?"enabled":"disabled")))),Tt(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,ni(e)}))})),Tt("[data-prop]").forEach((e=>{Ro(e)?e.elements[e.dataset.prop].forEach((t=>{t.addEventListener("click",(()=>ni(e)))})):e.addEventListener("input",(()=>{if((e==Kt||e==oa)&&0==Kt.value&&0==oa.value){const t=e==Kt?oa:Kt;t.value=2*t.step,ni(t),xi(t)}ni(e),xi(e),e.blur()}))})),dn.addEventListener("wheel",(e=>{e.preventDefault(),a||(a=setTimeout((()=>a=!1),50),rs(Math.sign(e.deltaY||0)*(ta.checked?-1:1)))})),$t("#btn_play").addEventListener("click",(()=>As())),$t("#btn_stop").addEventListener("click",fi),$t("#btn_shuf").addEventListener("click",di),$t("#btn_prev").addEventListener("mousedown",(()=>Js("m",-1))),$t("#btn_prev").addEventListener("click",(e=>{gs()||ui(!0)})),$t("#btn_next").addEventListener("mousedown",(()=>Js("m"))),$t("#btn_next").addEventListener("click",(()=>{gs()||ui()})),Xa.addEventListener("input",(()=>{const e=ro[Hn],{duration:t}=e;t&&t!=1/0?(e.currentTime=t*Xa.value,Xa.blur()):Xa.value=0})),Ca.addEventListener("input",(()=>{const e=Ca.value;e&&(F().confirm({text:`Load preset ${$o(Ca)}?`,submitText:"LOAD",submitCallback:()=>Es(e)}),Ca.value="")})),$t("#btn_manage_presets").addEventListener("click",(()=>{const e=[];Gn.map(((e,t)=>`<strong>[${t+1}]</strong>&nbsp; ${Fo(e)?'<em class="empty">Empty slot</em>':e.name||Ve}`)).forEach(((t,a)=>{const{name:n,options:o}=Gn[a];e.push({type:1,text:t,handler:()=>Vs(a,_o())},{type:2,text:Fo(o)?"":'<button title="Rename">edit</button>',handler:()=>Vs(a,o,"",!0)},{type:2,text:Fo(o)?"":'<button title="Download">file_save</button>',handler:()=>hs(o,n)},{type:2,text:Fo(o)?"":'<button title="Delete">delete</button>',handler:()=>ms(a)})})),F().select({text:"<strong>Click slot to SAVE - Use buttons to Rename, Download or Delete</strong>",choices:e})}));for(const[e,t]of[[$t("#preset_last"),Ke],[$t("#preset_default"),We]])e.addEventListener("click",(()=>{F().confirm({text:`Restore all options in <strong>Settings</strong> and <strong>Advanced</strong> panels to ${t==We?"defaults":"session start"}?`,submitText:"RESTORE",submitCallback:()=>Es(t)})}));$t("#btn_clear").addEventListener("click",(()=>{!function(){for(;Ea.hasChildNodes();)zs(Ea.removeChild(Ea.firstChild));No()?vi(-1):(vi(0),ls(Hn)),ls(Mn)}(),pi(!0)})),$t("#create_playlist").addEventListener("click",(()=>pi())),$t("#delete_playlist").addEventListener("click",(()=>{return e=La.selectedIndex,void(La[e].value&&F().confirm({text:`Do you really want to DELETE the "${La[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:async()=>{const t=La[e].value,a=Fe+t,n=await(0,P.Jt)(Pe);n&&delete n[t],await(0,P.yH)(a),await(0,P.hZ)(Pe,n),F().alert({text:"Playlist deleted"}),Ss()},cancelCallback:()=>{F().alert({text:"Canceled"})}}));var e})),$t("#load_playlist").addEventListener("click",(()=>{Ls({file:La.value}).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;F().alert({text:t,time:5})}))})),$t("#save_playlist").addEventListener("click",(()=>{var e;(e=La.selectedIndex)?F().confirm({text:`Overwrite "${La[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{pi(La[e].value)},cancelCallback:()=>{F().alert({text:"Canceled"})}}):pi()})),ga.addEventListener("click",(()=>bi()));const n=$t("#btn_toggle_filesystem"),s=()=>n.innerText=zn?"cloud":"hard_drive";(jn||zn)&&Un?(s(),n.addEventListener("click",(async()=>{zn=!zn;const e=zn?await(0,P.Jt)(Ae):xs(Ae);zn&&e&&"granted"!=await e[0].handle.requestPermission()?zn=!1:(w=!w,g=[],f=null,k=[w?i:o],O(e),s(),Ks($e,zn))}))):Qo(n.parentElement,!1);const r=$t("#btn_add_selected"),l=$t("#btn_add_folder");jn||zn?(r.addEventListener("mousedown",(()=>as($(".selected")))),l.addEventListener("click",(()=>as($())))):(Qo(r,!1),Qo(l,!1));const c=$t("#local_file");let d,u;Un?Qo(c.parentElement,!1):c.addEventListener("change",(e=>function(e){const t=e.files[0];if(t){ls();const e=ro[Hn];e.dataset.file=t.name,e.dataset.title=Go(t.name).baseName,ws(t,e,!0).then((e=>I.WC(e))).then((t=>ns(t,e))).catch((e=>{}))}}(e.target))),$t("#btn_load_url").addEventListener("click",(()=>{F().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&(ss({file:e},!0),pi(!0))}})})),$t("#btn_fullscreen").addEventListener("click",vs);const p=$t("#btn_pip");document.pictureInPictureEnabled?p.addEventListener("click",(async()=>{if(xo!==document.pictureInPictureElement){const e=Pn.canvas.captureStream();d=e.getTracks()[0],xo.muted=!0,xo.srcObject=e,await xo.play(),xo.requestPictureInPicture()}else document.exitPictureInPicture()})):p.classList.add("disabled");const h=((e,t=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}})((()=>Pn.setCanvasSize(u.width,u.height)));xo.addEventListener("enterpictureinpicture",(e=>{u=e.pictureInPictureWindow,jt.classList.add("pip"),p.classList.add("active"),Pn.setCanvasSize(u.height*xa.value,u.height),u.addEventListener("resize",h)})),xo.addEventListener("leavepictureinpicture",(()=>{u.removeEventListener("resize",h),xo.pause(),d.stop(),xo.srcObject=d=null,p.classList.remove("active"),jt.classList.remove("pip"),Pn.setCanvasSize()}));const m=navigator.mediaSession;m&&(m.setActionHandler("play",(()=>As())),m.setActionHandler("pause",(()=>As())),m.setActionHandler("previoustrack",(()=>Os())),m.setActionHandler("nexttrack",(()=>_s()))),$t("#add-gradient").addEventListener("click",(()=>Ts())),$t("#btn-save-gradient").addEventListener("click",(()=>Gs())),$t("#btn-save-gradient-copy").addEventListener("click",(()=>Ts(!0))),$t("#btn-delete-gradient").addEventListener("click",(()=>{F().confirm({text:`Do you really want to DELETE <strong>${fo.name}</strong>?<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{fo&&fo.key&&(delete bn[fo.key],0===Object.keys(bn).filter((e=>!bn[e].disabled)).length&&(bn[Object.keys(bn)[0]].disabled=!1),Ds(),Rs(),Ws(we),Ws(Ee),fo=null,location.href="#config")}})})),$t("#btn-export-gradient").addEventListener("click",(()=>hs(fo,`audioMotion-gradient-${fo.key}`)));const b=$t("#import_gradient");b.addEventListener("input",(()=>{const e=b.files[0];b.value="",e.text().then((e=>{try{fo=JSON.parse(e)}catch(e){return void ds(e,!0)}Gs(!0)}))})),$t("#new-gradient-bkgd").addEventListener("input",(e=>{fo.bgColor=e.target.value})),$t("#new-gradient-name").addEventListener("input",(e=>{fo.name=e.target.value})),$t("#new-gradient-horizontal").addEventListener("input",(e=>{fo.dir=e.target.checked?"h":void 0}));const v=Tt("details"),y=e=>v.forEach((e=>e.open=!1));v.forEach((e=>{e.addEventListener("click",(()=>{e.open||y()}))})),$t("#manage_gradients").addEventListener("click",(()=>{location.href="#config",y(),$t("#gradients_management").open=!0})),$t("#export_settings").addEventListener("click",(()=>hs(_o(),"audioMotion-settings")));const x=$t("#import_settings");x.addEventListener("input",(()=>{const e=x.files[0];x.value="",F().confirm({text:"ATTENTION!<br>This will overwrite all current options in the <strong>Settings</strong> and <strong>Advanced</strong> panels!",submitText:"IMPORT",submitCallback:()=>{e.text().then((e=>{try{Es(JSON.parse(e))}catch(e){ds(e,!0)}}))}})}))}function di(){for(let e=Ko()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=Ea.replaceChild(Ea.children[t],Ea.children[e]);Ea.insertBefore(a,Ea.children[t])}Is(0),pi(!0)}function ui(e=!1){(e?Os():_s())||Ys(`Already at ${e?"first":"last"} track`)}function fi(){for(const e of ro)e.pause();Ys(),Cs(0)}async function pi(e,t=!0){const a=1==e;if(!a||Ma.checked)if(0!=Ko()||a)if(e){let n;if(!a&&!t){n=So(e,"_");let t=await(0,P.Jt)(Pe)||{},a=0,o=n;for(;t.hasOwnProperty(n)&&a<1e3;)n=o+"_"+a,a++;t[n]=e,await(0,P.hZ)(Pe,t),Ss(n)}let o=[];for(const e of Ea.childNodes){const{album:t,artist:a,codec:n,duration:s,file:i,title:r}=e.dataset,{handle:l,dirHandle:c}=e;o.push({file:i,handle:l,dirHandle:c,content:{album:t,artist:a,codec:n,duration:s,title:r}})}a?(0,P.hZ)(He,o):(0,P.hZ)(Fe+n,o).then((()=>F().alert({text:"Playlist saved!"})))}else F().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&pi(e,!1)},cancelCallback:()=>{F().alert({text:"Canceled"})}});else F().alert({text:"Queue is empty!"})}function hi(e){for(const t of ro)t.dataset.file==e.dataset.file&&ns(e,t)}function mi(e){if(void 0===e&&(e=!!jt.style.height),window.innerHeight>=hn&&(document.body.style.overflowY="hidden"),e)for(const e of In)Qo($t(`#${e.value}`),!0);jt.style.height=e?"":`calc( 100vh - ${pn}px )`,sn.classList.toggle("closed",!e)}function bi(){uo.endTime<performance.now()&&(uo.info=0),2==uo.info?Ys():Ys(1+(0|uo.info),+ea.value||1/0)}function gi(){const{destination:e}=Pn.audioCtx,{maxChannelCount:t}=e,a=on.checked;if(Nn)if(Pn.disconnectInput(),a)for(const e of bo)Pn.connectInput(e);else Pn.connectInput(Nn);e.channelCount=Math.min(a?6:2,t),ds(`Surround audio output ${a?"enabled":"disabled"}. Device supports ${t} channels; channels in use: ${e.channelCount}`),fs("connected nodes",Pn.connectedSources)}function vi(e){Bn=e;const t=Ea.querySelector(".current"),a=Ea.children[Bn];t&&t.classList.remove("current"),a&&(a.classList.add("current"),a.scrollIntoViewIfNeeded())}function ki(e){void 0!==e?fa.checked=e:e=fa.checked,e?Pn.disconnectOutput():Pn.connectOutput()}function yi(e){const t=e.value,{abs:a,sign:n}=Math;if(e==Ht){const e=To(Jt)==mt;return es((e?["","","half-","1/3rd-","1/4th-","1/6th-","1/8th-","1/12th-","1/24th-"]:["","10","20","30","40","60","80","120","240"])[+t||0]+(e?"octave":"")+" bands")}return e==Rt?0==t?"None":1==t?"Legacy":(100*t|0)+"%":e==Kt?0==t?0:(100*t|0)+"%":e==Za?0==t?"OFF":a(t)+" RPM"+(-1==n(t)?" (CCW)":""):t}function wi(){Ks(_e,{..._o(),micSource:Ya.checked,mute:fa.checked,volume:dn.dataset.value})}function xi(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=yi(e))}!async function(){const e=e=>{const t=_s(!0);fs("audioOnEnded",{mediaEl:e.target.id.slice(-1),isNextSong:t}),t||(fi(),Ys("Queue ended",10),Mo()&&xo.pause())},t=e=>{e.target.attributes.src&&ds("Error loading "+e.target.src,!0)},a=e=>{fs("audioOnPlay",{mediaEl:e.target.id.slice(-1)}),ro[Hn].attributes.src?(Mo()&&xo.play(),ro[Hn].currentTime<.1&&"1"==_a.value&&Ns(!0),Bo(Ga)&&Ys(1,+rn.value||1/0)):Is(Bn)},r=e=>{if(e.target!=ro[Hn])return;const{currentTime:t,duration:a}=ro[Hn];Xa.value=a&&a!=1/0?t/a:0,Ja.innerText=Xo(t,!0),Va.innerHTML=Xo(a?t-a:0,!0).padEnd(6).replaceAll(" ","&nbsp;")};let l=!1;const c="audiomotion.app"!=window.location.hostname,d=new URL(window.location).searchParams,u=d.get("mode"),S=d.get("frontPanel")||d.get("mediaPanel");null!=d.get("debug")&&(Ut.checked=!0,ds("Debug enabled via URL parameter")),Hs(ka,In,"panel"),Rn=$t('label[for="panel-console"]'),window.addEventListener("error",(e=>ds(`Unexpected ${e.error}`,!0))),ds(`audioMotion v${N} initializing...`),ds(`User agent: ${navigator.userAgent}`),$t("#version").innerText=N;const $=xs(Oe),T=$t("#update-banner");let _;null!=$&&$!=N||T.remove(),$!=N&&(Ks(Oe,N),null!=$&&(T.classList.add(Ct),T.addEventListener("click",(()=>T.classList.remove(Ct))),setTimeout((()=>{T.classList.remove(Ct)}),1e4)));try{_=await fetch(vt)}catch(e){}let A=_&&_.ok?await _.text():"";try{A=H.Hh(A)}catch(e){ds(`Error parsing ${vt} - ${e}`,!0),A={}}A={...kt,...A},Un=A.enableLocalAccess&&!!window.showDirectoryPicker;let I=A.enableLocalAccess&&(!c||u==ke||"server"!=u&&xs($e));null===I&&(I=A.defaultAccessMode==ke),(S==je||A.frontPanel==je&&S!=Ue)&&mi(!1),ds(`Instantiating audioMotion-analyzer v${n.A.version}`),Pn=new n.A(At,{bgAlpha:0,fsElement:jt,onCanvasDraw:(e,t)=>{if(!ro.length)return;const a=ro[Hn],n=a.dataset,o=a.duration-a.currentTime,s=+Gt.value,i=Pt.value[0],r=Ft.value,l=mo+1/e.fps,c=Bo(ma),d=e.pixelRatio,{timestamp:u}=t;if(o<l&&No()&&(fs("gapless track skip",{remaining:o,interval:l}),_s()),s>0&&o<=s&&Bo(Ga)&&u>uo.endTime&&No()&&Ys(1,o,1),!(r!=ee&&"4"!=r&&"5"!=r||i!=W&&i!=K)){let t;if(r==ee)t=(70*e.getEnergy()|0)-25;else{const e=a.currentTime/a.duration;t=100*("4"==r?e:1-e)}jt.style.backgroundSize=`auto ${100+t}%`}ga.width|=0;const{endTime:f,startTime:p,msgTimer:h,info:m,msg:b,fade:g}=uo;if(u>f&&u>h)return;const v=(e,t,a,n)=>{c?(yo.strokeText(e,t,a,n),yo.fillText(e,t,a,n)):(yo.shadowOffsetX=yo.shadowOffsetY=3*d,yo.fillText(e,t,a,n),yo.shadowOffsetX=yo.shadowOffsetY=0)};if(yo.lineWidth=4*d,yo.lineJoin="round",yo.font=so,yo.textAlign="center",yo.fillStyle="#fff",yo.strokeStyle=yo.shadowColor="#000",h>u&&(u>f||2!=m)){const e=(h-u)/1e3;yo.globalAlpha=e>1?1:e,v(uo.msg,Xn,Zn)}if(f>u){if(g<0){const e=(f-u)/1e3;yo.globalAlpha=e>-g?1:e/-g}else{const e=Math.max(0,(u-p)/1e3);yo.globalAlpha=e>g?1:e/g}if(2==uo.info&&(v(Po(),Xn,Zn,no),yo.textAlign="left",v($o(To(ua)==Me?Ht:ua),Vn,Zn,no),v(`Randomize: ${$o(_a)}`,Vn,Qn,no),yo.textAlign="right",v($o(qa).toUpperCase()+" sensitivity",Yn,Zn,no),v(`Repeat is ${zo(Ra)}`,Yn,Qn,no)),Ya.checked)yo.textAlign="left",yo.font=io,v("MIC source",Vn,to,oo);else{yo.textAlign="right",v(n.codec,Yn,eo),v(n.quality,Yn,eo+Vn);const e=Ko();e&&ja.checked&&v(`Track ${Bn+1} of ${e}`,Yn,eo-Vn),yo.textAlign="left",v(n.artist.toUpperCase(),Vn,eo,oo),yo.font=`italic ${so}`,v(n.album,Vn,ao,oo),yo.font=io,v(a.src?n.title:"No song loaded",Vn,to,oo),(a.duration||n.duration)&&(n.duration||(n.duration=Xo(a.duration),Ea.children[Bn]&&(Ea.children[Bn].dataset.duration=n.duration)),yo.textAlign="right",v(Xo(a.currentTime)+" / "+n.duration,Yn,ao)),wo.width&&Ua.checked&&yo.drawImage(wo,Vn,eo-1.3*Jn,Jn,Jn)}}},onCanvasResize:(e,t)=>{cs(t);const{canvas:a,fsWidth:n,fsHeight:o,isFullscreen:s,loRes:i,pixelRatio:r}=t;let l;switch(e){case"create":ds(`Display resolution: ${n} x ${o} px (pixelRatio: ${window.devicePixelRatio})`),l="Canvas created";break;case"lores":l=`Lo-res ${i?"ON":"OFF"} (pixelRatio = ${r})`;break;case"fschange":l=(s?"Enter":"Exit")+"ed fullscreen";break;case"user":l=(Mo()?"Resized for":"Closed")+" PIP";break;default:return}ds(`${l||e}. Canvas size is ${a.width} x ${a.height} px`)}});const D=Pn.audioCtx,M=function(e){const t=(e,t)=>{Array.isArray(e)&&e.forEach((e=>{const{value:a,disabled:n}="object"==typeof e?e:{value:e,disabled:!0},o=Array.isArray(t)?t.find((e=>e.value==a)):t[a];o&&(o.disabled=n)}))},a=xs(_e),n=null!==a,o=xs(Te)||{},{fftSize:s,smoothing:i}=o;((e,t)=>{const a=Ao(e);-1!=a&&(mn[a].options=t)})(Ke,{...Oo(We),fftSize:s,smoothing:i,...a}),Gn=xs(xe)||[],Array.isArray(Gn)||(Gn=[{name:"Custom",options:Gn}]);for(let e=0;e<9;e++)void 0===Gn[e]?Gn[e]={}:Fo(Gn[e])||Gn[e].options||(Gn[e]={options:Gn[e]});t(xs(Le),Ln);const r=xs(we);r&&Object.keys(r).forEach((e=>{bn[e]=r[e],bn[e].key=e})),t(xs(Ee),bn),t(xs(Se),kn);const l=Tt(".min-db");l.forEach((e=>Zo(e,-120,-60)));const c=Tt(".max-db");c.forEach((e=>Zo(e,-50,0)));const d=Tt(".linear-boost");d.forEach((e=>Zo(e,1,5,.2))),(xs(Re)||yn).forEach(((e,t)=>{l[t].value=e.min,c[t].value=e.max,d[t].value=e.boost||yn[t].boost})),Ms(xa,$n),Zo(Xt,25,100,5),Ms(la,Cn),Ms(Mt,[[J,"Disable"],[X,"Built-in"],[...Un?[Y,"Local folder"]:[]]]),Zo(Nt,0,1e3),on.disabled=Pn.audioCtx.destination.maxChannelCount<=2;const{preserveFilenames:u}=e;Qs({...Sn,preserveFilenames:u,...o}),Ms(va,[["0","Small"],["1","Medium"],["2","Large"]]),ei({...xn,...xs(Ce)||{}}),Zo(Qt,.01,25,.01),Zo(ya,0,5e3,50),Zo(wa,0,5e3,50),ai({..._n,...xs(Ie)||{}}),Ms(en,[["none","None"],[yt,"Shadow"],["solid","Solid"]]),Ms(tn,[["gold","Gold"],["gray","Gray"],[wt,"White"],["yellow","Yellow"]]);const f=[["top","Top"],[St,"Center"],[Et,"Bottom"]];return Ms(an,f),Ms(nn,f),ii({...On,...o,...xs(De)||{}}),n}(A);Ea.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&(Is(Co(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),vi(0),R.Ay.create(Ea,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{vi(Co(Ea.querySelector(".current"))),0!=e.newIndex||No()?Cs(U):Cs(0),pi(!0)}}),Hn=0,Mn=1,D.createStereoPanner&&(Nn=D.createStereoPanner());for(const n of[0,1])ro[n]=$t(`#player${n}`),ls(n),ro[n].addEventListener("abort",(()=>fs(`mediaEl ${n} load aborted`))),ro[n].addEventListener("canplay",(()=>fs(`mediaEl ${n} can play`))),ro[n].addEventListener("canplaythrough",(()=>fs(`mediaEl ${n} can play through`))),ro[n].addEventListener("pause",(()=>fs(`mediaEl ${n} is paused`))),ro[n].addEventListener("play",a),ro[n].addEventListener("playing",(()=>fs(`mediaEl ${n} is playing`))),ro[n].addEventListener("emptied",(()=>fs(`mediaEl ${n} emptied`))),ro[n].addEventListener("ended",e),ro[n].addEventListener("error",t),ro[n].addEventListener("timeupdate",r),ro[n].querySelector("track").addEventListener("load",ri),Nn?(bo[n]=D.createMediaElementSource(ro[n]),bo[n].connect(Nn)):Pn.connectInput(ro[n]);Zo(Xa,0,1,.001),Xa.value=0,Ja.innerText=Va.innerText=Xo(0,!0),function(){var e,t,a,n,o;e=$t("#enabled_bgfit"),t="enabledBgFit",n=Ft,o=Le,(a=Ln).forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),Tt(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return F().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;const s=a.find((t=>t.value==e.dataset.option));s&&(s.disabled=!e.checked,Ms(n,a),Ws(o))}))}));const s=$t("#enabled_gradients");Object.keys(bn).forEach((e=>{s.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${bn[e].disabled?"":"checked"}> ${bn[e].name}</label>`})),Rs();const i=$t("#random_properties");kn.forEach((e=>{i.innerHTML+=`<label${e.value==dt?' class="colspan-3"':""}><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),Tt(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{kn.find((t=>t.value==e.value)).disabled=!e.checked,Ws(Se)}))})),Tt("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{const t=e.dataset.preset;$t(`.min-db[data-preset="${t}"]`).value=yn[t].min,$t(`.max-db[data-preset="${t}"]`).value=yn[t].max,$t(`.linear-boost[data-preset="${t}"]`).value=yn[t].boost,Tt(`[data-preset="${t}"]`).forEach((e=>{e.classList.remove("field-error")})),e.dataset.preset==To(qa)&&ni(qa,!1),Ws(Re)})):e.addEventListener("change",(()=>{qo(e)&&(e.dataset.preset==To(qa)&&ni(qa,!1),Ws(Re)),e.classList.toggle("field-error",!qo(e))}))}));for(const e of[...wn,...En,...Tn,...An])e.addEventListener("change",(()=>{qo(e)&&ni(e),e.classList.toggle("field-error",!qo(e))}));$t("#reset_osd").addEventListener("click",(()=>{ei(xn),ni(wn)})),$t("#reset_general").addEventListener("click",(()=>{Qs(Sn),ni(En)})),$t("#reset_peak").addEventListener("click",(()=>{ai(_n),ni(Tn)})),$t("#reset_subs").addEventListener("click",(()=>{ii(On),ni(An)}))}(),Fs();for(const e of[16,20,25,30,40,50,60,100,250,500,1e3,2e3])Oa[Oa.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,2e4,22e3])Aa[Aa.options.length]=new Option(e/1e3+"kHz",e);Hs(ua,gn),Hs(Bt,vn),Hs(qa,[["0","Low"],["1","Medium"],["2","High"]]),Ms(_a,[["0","OFF"],["1","On track change"],["2","every 5 seconds"],["6","every 15 seconds"],["12","every 30 seconds"],["24","every minute"],["48","every 2 minutes"],["120","every 5 minutes"]]),Hs(Ha,[[Je,"Off"],[Ze,"25%"],[Xe,"40%"],[Ye,"Mirror"]]),Ms(Ft,Ln),Hs(da,[["-1","Left"],["0","Off"],["1","Right"]]),Hs(Jt,[["bark","Bark"],["linear","Linear"],[mt,"Log"],["mel","Mel"]]),Hs(fn,[["","Off"],["A","A"],["B","B"],["C","C"],["D","D"],["468","468"]]),Hs(qt,[[ue,"Gradient"],[fe,"Index"],[pe,"Level"]]),Hs(za,[[ze,"Off"],[1,"Drop"],[Ge,"Fade"]]),Hs(Na,[[bt,"Off"],[1,"Freqs"],[gt,"Notes"]]),Hs(Ba,[[bt,"Off"],[1,"On"]]),Hs(Ot,[[0,"Tempered"],[1,"ANSI/IEC"]]),Hs(na,[[0,"Decibels"],[1,"Linear"]]);let B=[];for(let e=10;e<16;e++){const t=2**e;B.push([t,(t/1024|0)+"k"])}Hs(Wt,B),Zo(Ht,1,8),Zo(Rt,0,1,.05),Zo(Dt,.1,1,.05),Zo(Kt,0,1,.05),Zo(oa,0,3,.5),Zo(Ta,0,1,.05),Zo(Ka,0,.95,.05),Zo(Za,-10,10,1),Ys(),Object.keys(bn).forEach((e=>{const{bgColor:t,dir:a,colorStops:n}=bn[e];n&&Pn.registerGradient(e,{bgColor:t,dir:a,colorStops:n})})),Ds();const q=function(e,t={}){let a;var n;return m=document.createElement("ul"),m.className="breadcrumb",e.append(m),b=document.createElement("ul"),b.className="filelist",e.append(b),a=setTimeout((()=>{m.innerHTML="Waiting for server..."}),5e3),m.innerHTML="Initializing... please wait...",m.addEventListener("click",(async function(e){e.target&&"LI"==e.target.nodeName&&function(e){let t;for(;e>0;)t=g.pop(),e--;const a=g[g.length-1];a&&a.handle&&(f=a.handle,t=null),E(t,t&&t.scrollTop)}(e.target.dataset.depth)})),b.addEventListener("click",(async function(e){const t=e.target;if(t&&"LI"==t.nodeName)if("dir"==t.dataset.type)E(t.handle||t.dataset.path);else if("mount"==t.dataset.type)if(w)try{f=await window.showDirectoryPicker({startIn:"music"}),g=[],E(f)}catch(e){}else g=[],E(t.dataset.path)})),b.addEventListener("dblclick",(function(e){const t=e.target;t&&"LI"==t.nodeName&&p&&["file","list"].includes(t.dataset.type)&&p({file:C(t.dataset.path),handle:t.handle,dirHandle:t.dirHandle,subs:t.subs},e)})),"function"==typeof t.onDblClick&&(p=t.onDblClick),"function"==typeof t.onEnterDir&&(h=t.onEnterDir),t.fileExtensions&&(n=t.fileExtensions,v=new RegExp("\\.("+n.join("|")+")$","i")),new Promise((e=>{fetch(".",{method:"HEAD"}).then((async n=>{clearTimeout(a),x=!0,k=[t.rootPath||o],y=await E(k[0]),(t.forceFileSystemAPI&&s||!y)&&(g=[],s?(k=[i],w=!0):k=[],L()),e({webServer:x,useFileSystemAPI:w,serverHasMedia:y,filelist:b})})).catch((t=>{clearTimeout(a),s?(k=[i],w=!0):k=[],L(),e({webServer:x,useFileSystemAPI:w,filelist:b})}))}))}($t("#file_explorer"),{onDblClick:(e,t)=>{as([e],!0),t.target.classList.remove("selected","sortable-chosen")},onEnterDir:e=>{Fa.checked&&l&&Jo(e)},fileExtensions:[...me,...ge,...ve],forceFileSystemAPI:I}).then((e=>{Kn=e.webServer,jn=e.serverHasMedia,zn=e.useFileSystemAPI;const{filelist:t}=e;jn||ds(Kn?"Cannot access music directory on server":"No server found",!0),zn&&ds("Accessing files from local device via File System Access API."),!Un&&A.enableLocalAccess&&ds('No browser support for File System Access API. Cannot access files from local device. <a href="https://audiomotion.app/docs/#/known-issues?id=file-system-access-api" target="_blank">Learn more...</a>',I),Ks($e,I&&Un),Ss(),(zn||jn)&&R.Ay.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{if("playlist"==e.to.id){let t=e.items.length?e.items:[e.item],a=[];t.forEach((e=>{const{handle:t,dirHandle:n,subs:o}=e;a.push(ss({file:C(e.dataset.path),handle:t,dirHandle:n,subs:o})),e.remove()})),Promise.all(a).then((()=>pi(!0)))}}}),ci()}));if(window.addEventListener("keydown",ks),window.addEventListener("keyup",ks),F().setOptions({positions:{alert:"bottom"}}),window.ResizeObserver){let e;new ResizeObserver((()=>{e||(e=setTimeout((()=>{cs(),e=0}),60))})).observe(jt)}Promise.all([js(),q]).then((async()=>{const e=()=>{a&&O(a),Ma.checked&&Ls({file:!0})},t=async()=>{!(o&&"granted"!=await n.requestPermission()||s&&"granted"!=await a[0].handle.requestPermission())&&(ca.classList.remove("locked"),window.removeEventListener("click",t),o&&js(),e())},a=zn?await(0,P.Jt)(Ae):xs(Ae),n=await(0,P.Jt)(ye),o=Un&&n&&"granted"!=await n.queryPermission(),s=zn&&Array.isArray(a)&&a[0]&&"granted"!=await a[0].handle.queryPermission();ds(`Loading ${M?"last session":"default"} settings`),Es(Ke,!1,!0),o||s?(ca.classList.add("locked"),window.addEventListener("click",t)):e(),ni([Xt,Sa,on,cn,...An],!1),mo=(D.outputLatency||0)+D.baseLatency,ds(`AudioContext sample rate is ${D.sampleRate}Hz; Total latency is ${1e3*mo|0}ms`),fs({PANEL_MIN_HEIGHT:pn,WINDOW_MIN_HEIGHT:hn}),ds("Initialization complete!"),l=!0}))}()},6216:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),n=parseInt(a.getPropertyValue("border-top-width")),o=parseInt(a.getPropertyValue("border-left-width")),s=this.offsetTop-t.offsetTop<t.scrollTop,i=this.offsetTop-t.offsetTop+this.clientHeight-n>t.scrollTop+t.clientHeight,r=this.offsetLeft-t.offsetLeft<t.scrollLeft,l=this.offsetLeft-t.offsetLeft+this.clientWidth-o>t.scrollLeft+t.clientWidth,c=s&&!i;(s||i)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-n+this.clientHeight/2),(r||l)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-o+this.clientWidth/2),(s||i||r||l)&&!e&&this.scrollIntoView(c)})}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,a,o,s)=>{if(!a){var i=1/0;for(d=0;d<e.length;d++){for(var[a,o,s]=e[d],r=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(n.O).every((e=>n.O[e](a[l])))?a.splice(l--,1):(r=!1,s<i&&(i=s));if(r){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,o,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[i,r,l]=a,c=0;if(i.some((t=>0!==e[t]))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var d=l(n)}for(t&&t(a);c<i.length;c++)s=i[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[96],(()=>n(6965)));o=n.O(o)})();