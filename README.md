audioMotion.js
==============

[![GitHub release](https://img.shields.io/github/release/hvianna/audioMotion.js.svg) ![GitHub Release Date](https://img.shields.io/github/release-date/hvianna/audioMotion.js.svg)](https://github.com/hvianna/audioMotion.js/releases/latest)

A real-time graphic spectrum analyzer and audio player built with the *Web Audio* and *Canvas* JavaScript APIs.

## Features

* Beautiful high-resolution (retina / HiDPI ready) graphic spectrum analyzer with fullscreen display
* Customizable logarithmic frequency scale, for improved visualization of specific ranges
* Customizable WebAudio API parameters (FFT size, sensitivity and time-smoothing)
* Audio player with playlist support
* Visualize audio input from your microphone (or "stereo mix", if your soundcard supports it)
* Written entirely in vanilla JavaScript (ES5) — runs right out of the box in any modern browser

## Demo

https://hvianna.github.io/audioMotion.js/

## Basic usage

You can load individual songs from your PC using the **Load a song** option. This allows for quick visualization of any song, but won't let you enqueue several songs for playback.

For a more practical listening / visualization session, the idea is that you use pre-defined playlists. You can load a playlist by selecting it from the list and clicking the **LOAD** button.
This will **add** the selected playlist's content into the current playlist, which is shown under **Playlist**.

You can then use the player controls to play, pause and skip through songs in the playlist.

The **SHUFFLE** button will shuffle the contents of the current playlist. **CLEAR** clears the current playlist.

The **Repeat** option, when active, will make the player loop back to the first song after playing the last song on the playlist.

The **Display** option toggles the display of song information on screen on every track change.

You can also make audioMotion "listen" to your microphone, by selecting *Microphone* in the **AUDIO SOURCE** setting.
If your sound card supports *Stereo mix* mode, you should be able to select it as the input device when requested to allow access to your microphone.
The *Stereo mix* input allows audioMotion to receive audio generated by other programs running in your PC. Please note that the graphic visualization from this source might suffer a slight delay.

## Using your own playlists

Due to browsers' security policies, JavaScript can only read files via the HTTP protocol, to prevent websites from having access to files in your PC.
So, in order to use your own playlists and get the best out of audioMotion, you'll need to set up a local web server to allow HTTP access to your music folder.<br>
<sub>Note: on Firefox (tested with version 63), you *may be* able to open the index.html file on your PC and load playlists and music files stored *inside audioMotion's folder*. Try with the demo playlists - if it works, you can add your own files.</sub>

The easiest way to setup your web server is by using [Docker](https://www.docker.com/). Once you have Docker installed and running, simply open a command prompt in the folder where you downloaded audioMotion to (if you haven't yet, you can download the package from the [Releases page](https://github.com/hvianna/audioMotion.js/releases/latest)), and run:

`docker-compose up -d`

and you should be able to access audioMotion by entering `localhost:8000` in your browser.

The provided configuration file maps the folder "music" in your user directory to the web server document root, so audioMotion can access files inside it as "music/song.mp3", for example.
This should work for the default "Music" folder on Windows. If you want to map a different folder or drive, edit the line below in `docker-compose.yml`:

```
    - ~/music:/usr/local/apache2/htdocs/music/
```

and change `~/music` for your desired local path, for example `j:\media\music` or `/j/media/music`. On Windows, if you're using a drive other than C: you might need to add it to the shared drives in Docker's configuration.

## Playlists

The `playlists.cfg` file is where you register all the playlists you want available inside audioMotion. This is a plain text file with one playlist per line, in the format `playlist title | playlist path and filename` (that's a "pipe" character between the title and the path). You can edit the playlists.cfg file in any plain text editor, like Windows' Notepad.

Example of playlists.cfg contents:

```
Pink Floyd albums | music/Rock/Pink Floyd/all-albums.m3u
Soundtrack mix | music/OST/best.m3u
Vince Guaraldi | music/jazz/vince guaraldi/playlist.m3u
Herbie Hancock | music/jazz/herbie hancock/playlist.m3u
```

Playlists themselves are also plain text files, containing one song per line. File extension must be `.m3u` or `.m3u8` for audioMotion.js to recognize it as a playlist. The [Extended M3U](https://en.wikipedia.org/wiki/M3U#Extended_M3U) #EXTINF directive is also supported to provide track information (artist and song name).

You can use a music player software that supports M3U playlists, like [foobar2000](https://www.foobar2000.org/) or [VLC](https://www.videolan.org/vlc/), to arrange your songs more easily and generate the playlist. On foobar2000, as of version 1.4.1, EXTM3U support can be enabled via *Preferences* > *Advanced* > *Tools* > *Write EXTM3U playlists*.

Make sure playlist entries do not contain absolute paths or drive letters - all paths should be relative to the location of the playlist file itself. And remember all files must be located below your mapped "music" folder so audioMotion can read them.

Example of an m3u playlist file:

```
(1971) Meddle\05 Seamus.flac
(1971) Meddle\06 Echoes.flac
(1973) The Dark Side of the Moon\01 Speak To Me - Breathe.flac
(1973) The Dark Side of the Moon\02 On The Run.flac
(1973) The Dark Side of the Moon\03 Time.flac
```

Note that you can use either Windows-style backslashes `\` or Linux-style forward slashes `/` in your pathnames. See the provided playlist files inside the `demo` folder for more examples.

As for the audio files themselves, audioMotion.js should be able to play most mainstream formats, like mp3, ogg, m4a and flac, but codec support may vary, depending on your web browser and operating system.

## Configuration Presets

The **Logarithmic** and **Linear** presets adjust the FFT size, frequency range and smoothing configurations to recommended values for best visualization in logarithmic and linear frequency scale.

You can tweak any options and save a favorite configuration by clicking the **Save** button. You can later revert to this configuration by selecting the **Custom** preset.

Additionally, your last used configuration will be automatically saved to the **Last session** preset and restored the next time your open audioMotion.
You can also select the **Last session** preset to undo any changes made during the current session.

## Configuration options

![config-bar](img/configuration-bar.png "Analyzer configuration options")

Below you'll find a brief description of each configuration option.

### FFT Size

The number of samples used for the FFT performed by the analyzer. Larger values will provide greater detail of lower frequencies, but will require more CPU power.

### Range

The lowest and highest frequencies you want to see in the graphic spectrum analyzer. You can use this to zoom in a specific frequency range.

### Smoothing

Average constant used to smooth values between analysis frames. Lower values make the analyzer react faster to changes, and may look better with faster tempo songs. Increase it if the animation looks too "jumpy".

### LOG switch

This option toggles between logarithmic (when on) and linear (when off) distribution of frequencies in the horizontal axis.

The logarithmic scale allocates more canvas space for lower frequencies, resulting in improved visualization of beats, bass and vocals.

The linear scale works better with a narrower frequency range, so the low frequencies don't get condensed too much.
And if you select a smaller FFT size you'll have a more classic-looking analyzer, with wider bars.

You can load the **Logarithmic** and **Linear** presets for suggested configurations for both scales.

### SCALE switch

This option toggles the display of the frequency scale.

Clicking on the canvas will also toggle the scale on and off. Useful when you're on fullscreen mode.

### SENS switch

When on, analyzer sensitivity is increased, improving visualization of songs too quiet.

### PEAK switch

When on, the analyzer shows volume peaks for each frequency.

### Gradient

Several options of color gradients for the analyzer bars.

### BLACK switch

Turn this option on to use a black background for the analyzer, instead of the background color defined by each gradient.
This should improve the contrast for some gradients.

### CYCLE switch

When on, every track change will select the next gradient, cycling through the available options.

## Fullscreen mode and keyboard shortcuts

Click the **Fullscreen Analyzer** button to display the spectrum analyzer in fullscreen.

You can use the keyboard shortcuts below to control the player and some display settings without leaving fullscreen mode:

| key | action |
|-----|--------|
**left arrow**<br>or **J** | play previous song
**right arrow**<br>or **K** | play next song
**Space** | play / pause
**up arrow**<br>or **I** | select previous gradient
**down arrow**<br>or **M** | select next gradient
**B** | toggle black background (see BLACK switch above)
**D** | display current song information on screen
**S** | toggle frequency scale display on/off (see SCALE switch above)

## Screenshots

audioMotion.js user interface
![screenshot1](img/screenshot1.png "audioMotion.js user interface")

Full screen view: Linear scale, 20Hz-4KHz, 2048-sample FFT, "Miami" gradient, with on-screen information
![screenshot2](img/screenshot2.png "Full screen view: Linear scale, 20Hz-4KHz, 2048-sample FFT, 'Miami' gradient, with on-screen information")

Full screen view: Logarithmic scale, 20Hz-16KHz, 8192-sample FFT, "Classic" gradient
![screenshot3](img/screenshot3.png "Full screen view: Logarithmic scale, 20Hz-16KHz, 8192-sample FFT, 'Classic' gradient")

## References and acknowledgments

* audioMotion.js was largely inspired by the aesthetics of [Soniq Viewer for iOS](https://itunes.apple.com/us/app/soniq-viewer/id448343005), by Yuji Koike
* [Web Audio API documentation @MDN](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)
* [Web Audio API Specification](https://webaudio.github.io/web-audio-api/)
* [HTML Canvas Reference @W3Schools](https://www.w3schools.com/tags/ref_canvas.asp)
* [What does the FFT data in the Web Audio API correspond to?](https://stackoverflow.com/a/14789992/2370385)
* [HTML5 check if audio is playing?](https://stackoverflow.com/a/46117824/2370385)
* [Unlocking Web Audio — the smarter way](https://hackernoon.com/unlocking-web-audio-the-smarter-way-8858218c0e09)
* [localStorage polyfill](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Local_storage)
* Icons by [icons8](https://icons8.com) licensed under [Creative Commons Attribution-NoDerivs 3.0 Unported](https://creativecommons.org/licenses/by-nd/3.0/)
* Gradients [*Candy*](https://gradienthunt.com/gradient/172), [*Miami*](https://gradienthunt.com/gradient/950), [*Outrun*](https://gradienthunt.com/gradient/317) and [*Tie Dye*](https://gradienthunt.com/gradient/969) from [Gradient Hunt](https://gradienthunt.com)
* Gradients *Pacific Dream*, *Shahabi*, *Summer* and *Sunset* from [uiGradients](https://uigradients.com)
* Gradients used in the UI buttons from [ColorZilla's Ultimate CSS Gradient Generator](http://www.colorzilla.com/gradient-editor/)

## Song credits

Songs included in the demo playlists:

* Albinoni — Adagio in G minor, Arr for alto saxophone and piano by David Hernando Vitores ([source](https://commons.wikimedia.org/wiki/File:Tomaso_Giovanni_Albinoni_-_Adagio_in_G_minor_-_Arr_for_alto_saxophone_and_piano_-_David_Hernando_Vitores.ogg))<br>Licensed under [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/deed.en)
* Brazilian National Anthem - Choral ([source](http://www.dominiopublico.gov.br/pesquisa/DetalheObraForm.do?select_action=&co_obra=2480)) - Public domain
* "The Factory" by Multifaros ([source](https://archive.org/details/The_Factory-3613)) - Licensed under [CC BY 3.0](http://creativecommons.org/licenses/by/3.0/)
* "Funky Chunk" by Kevin MacLeod ([incompetech.com](https://incompetech.com)) - Licensed under [CC BY 3.0](http://creativecommons.org/licenses/by/3.0/)
* "Spell" by Rolemusic ([source](https://archive.org/details/Straw_Fields-8753)) - Licensed under [CC BY-NC-SA 3.0 US](http://creativecommons.org/licenses/by-nc-sa/3.0/us/)
* "We Come Together" by LukHash ([source](https://archive.org/details/ShMusic-DigitalMemories/)) - Licensed under [CC BY-NC-ND 3.0](http://creativecommons.org/licenses/by-nc-nd/3.0/)
* Test tones created with [Audacity](https://www.audacityteam.org/).

## License

audioMotion.js copyright (c) 2018-2019 Henrique Vianna<br>
Licensed under the [GNU Affero General Public License, version 3 or later](https://www.gnu.org/licenses/agpl.html).